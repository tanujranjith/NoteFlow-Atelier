<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoteFlow Atelier</title>
    <link rel="icon" href="assets/NoteFlow%20Atelier%20favicon-64.png" type="image/png">
    
    <!-- Editorial Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;600;700&family=Fira+Sans:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;600&family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600;700&family=Playfair+Display:wght@400;600;700&family=Roboto:wght@400;500;700&family=Source+Sans+3:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google API -->
    <script src="https://apis.google.com/js/api.js" async></script>

    
    
    
    <link rel="stylesheet" href="styles.css">
    <style id="view-visibility-fallback">
        .view { display: none; }
        .view.active { display: block; }
    </style>
    <script src="select-enhancer.js" defer></script>
    <script src="date-enhancer.js" defer></script>
    <script src="emoji-keywords.generated.js" defer></script>
    <!-- Mobile-first overrides to declutter and improve usability on small screens -->
    <style>
        /* Hide mobile-only elements by default */
        .view-tabs-toggle { display: none; }

        /* Make toolbar scrollable horizontally and remove extra scroll buttons on mobile */
        @media (max-width: 1024px) {
            .toolbar-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; padding-bottom: 6px; }
            .toolbar-scroll-btn { display: none !important; }

            /* Reduce density of top nav */
            .top-nav { padding: 10px; gap: 8px; }
            .nav-right { display: none !important; }
            .brand-sub { display: none; }
            .brand-label { font-size: 16px; }
            .nav-divider { margin: 0 4px; }

            /* Compact sidebar and hide non-essential sidebar widgets
               Make the sidebar fixed and overlapping so it appears above
               all floating chrome on mobile. */
            .sidebar {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                bottom: 0 !important;
                width: 78% !important;
                max-width: 360px !important;
                padding: 12px !important;
                z-index: 5000 !important; /* sit above everything */
                background: var(--neumo-bg) !important;
            }
            /* Hard-hide sidebar when closed to prevent partial sliver artifacts */
            body:not(.sidebar-open) .sidebar,
            .sidebar.collapsed {
                transform: translateX(-110%) !important;
                width: 0 !important;
                min-width: 0 !important;
                max-width: 0 !important;
                padding: 0 !important;
                border: 0 !important;
                box-shadow: none !important;
                opacity: 0 !important;
                visibility: hidden !important;
                pointer-events: none !important;
                overflow: hidden !important;
            }
            body:not(.sidebar-open) .sidebar > *,
            .sidebar.collapsed > * {
                display: none !important;
            }
            body.sidebar-open .sidebar:not(.collapsed) {
                transform: translateX(0) !important;
                width: 78% !important;
                max-width: 360px !important;
                padding: 12px !important;
                opacity: 1 !important;
                visibility: visible !important;
                pointer-events: auto !important;
            }
            .sidebar .focus-timer, .sidebar-tags-filter { display: none !important; }
            
            /* Ensure sidebar contents remain clickable above the overlay */
            .sidebar .pages-list, 
            .sidebar .page-item,
            .sidebar .new-page-btn,
            .sidebar .search-input { 
                position: relative; 
                z-index: 1; 
                pointer-events: auto !important; 
            }

            /* Editor adjustments: reduce padding and let editor take full height */
            .editor-container { padding: calc(var(--top-nav-height-mobile) + 72px) 12px 90px 12px !important; }
            .page-title-input { font-size: 18px; padding: 10px; width: calc(100% - 20px); }
            .editor { min-height: 60vh; padding: 12px; }

            /* Compact storage/taskbar: icons-only on small screens */
            .storage-options { right: 12px; left: auto; bottom: 12px; padding: 8px; gap: 8px; border-radius: 12px; display: flex; align-items: center; }
            .storage-options .btn-text { display: none; }

            /* Move chatbot button above storage bar - fixed position regardless of sidebar state */
            .chatbot-btn { 
                right: 12px !important; 
                left: auto !important;
                bottom: 180px !important; 
                width: 48px; 
                height: 48px; 
                z-index: 1200; 
            }
            .chatbot-panel {
                right: 12px;
                left: 12px;
                top: calc(var(--top-nav-height-mobile, 64px) + 8px);
                bottom: calc(env(safe-area-inset-bottom, 0px) + 90px);
                width: auto;
                max-height: none;
                height: auto;
            }

            /* Allow theme panel to open on mobile - optimized for small screens */
            .theme-panel {
                display: none; /* controlled by .active class */
            }
            .theme-panel.active {
                display: block !important;
                position: fixed !important;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
                right: auto !important;
                width: calc(100% - 32px) !important;
                max-width: 400px !important;
                max-height: 80vh !important;
                overflow-y: auto;
                z-index: 2000 !important;
            }
            .emoji-picker, .chatbot-info { display: none !important; }

            /* Reduce box-shadows for better performance on mobile */
            .glass-panel, .neumo-card, .editorial-card { box-shadow: none !important; border: 1px solid rgba(0,0,0,0.04) !important; }

            /* Note: We no longer hide top-nav/toolbar/chatbot when sidebar opens,
               so that page switching and UI remain accessible. */

            /* Slightly soften overlay so user still sees context but focus remains on sidebar.
               Ensure overlay sits under the sidebar so the sidebar remains on top. */
            .sidebar-overlay { z-index: 4200; }
            .sidebar-overlay.active { background: rgba(0,0,0,0.38) !important; }

            /* When the sidebar is open, hide the top-brand so it doesn't overlap the sidebar */
            .sidebar:not(.collapsed) ~ .main-content .top-nav .app-brand,
            .sidebar:not(.collapsed) ~ .main-content .top-nav .app-title {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
            }

            /* Ensure the theme switcher is completely hidden while the sidebar is open on mobile.
               Use a body-level class (`sidebar-open`) because the theme button is outside the
               sidebar's DOM, so sibling selectors may not match in all layouts. */
            .sidebar:not(.collapsed) ~ .theme-switcher-btn {
                display: none !important;
                visibility: hidden !important;
            }
            .sidebar-open .theme-switcher-btn {
                display: none !important;
                visibility: hidden !important;
            }

            /* Tighter toolbar buttons on mobile to reduce visual weight */
            .toolbar .toolbar-btn { padding: 8px 10px; min-width: 40px; border-radius: 10px; }
            .toolbar .toolbar-separator { display: none; }

            /* Tab switcher: collapsed by default on mobile, show toggle.
               When expanded, render as a vertical dropdown that fits the viewport. */
            .view-tabs { display: none; }
            .view-tabs.expanded {
                display: flex;
                position: absolute;
                /* place under the top-nav and anchor to the right (matches new toggle position) */
                top: calc(var(--top-nav-height-mobile, 64px) + 12px);
                right: 12px;
                left: auto;
                width: min(320px, calc(100% - 32px));
                flex-direction: column;
                gap: 8px;
                padding: 10px;
                border-radius: 12px;
                background: var(--neumo-bg);
                box-shadow: 0 18px 40px rgba(0,0,0,0.18);
                z-index: 1400;
                max-height: calc(100vh - (var(--top-nav-height-mobile, 64px) + 36px));
                overflow-y: auto;
                align-items: stretch;
            }
            /* Move the toggle to the right edge of the top-nav on mobile */
            .view-tabs-toggle { display: inline-flex; align-items: center; gap: 6px; padding: 8px 12px; border-radius: 999px; background: var(--neumo-bg); border: 1px solid rgba(255,255,255,0.06); box-shadow: 4px 4px 10px var(--neumo-shadow-dark); color: var(--text-primary); cursor: pointer; position: absolute; right: 16px; top: 50%; transform: translateY(-50%); z-index: 1300; }
            
            /* Reposition theme switcher to avoid overlapping the view tabs toggle */
            .theme-switcher-btn {
                top: 10px !important;
                right: 160px !important;
                width: 40px !important;
                height: 40px !important;
                /* Keep theme switcher below the sidebar (sidebar z-index = 5000) */
                z-index: 4100 !important;
            }

            /* Keep sidebar toggle visible without covering section content */
            .sidebar-toggle-btn {
                top: calc(var(--top-nav-height-mobile, 64px) + 8px) !important;
                width: 40px !important;
                height: 40px !important;
                /* Ensure the floating sidebar toggle sits above the sidebar */
                z-index: 5200 !important;
            }

            .view-tabs-toggle i { transition: transform 200ms ease; }
            .view-tabs-toggle[aria-expanded="true"] i { transform: rotate(180deg); }
            .view-tabs-toggle .view-tabs-current { font-weight: 600; font-size: 13px; }

            /* Prevent horizontal scrolling in the Progress view on mobile
               by forcing vertical stacking and allowing inner wrapping. */
            .view-progress { overflow-x: hidden; }
            .stats-grid {
                grid-template-columns: 1fr !important;
                grid-auto-rows: auto !important;
                margin: 8px auto 40px !important;
                padding: 0 12px !important;
                max-width: 100% !important;
            }
            .stats-grid .glass-card { min-width: 0 !important; box-sizing: border-box; }
            .card-content { flex-wrap: wrap !important; align-items: flex-start; }
            .donut-placeholder { margin-right: 8px; flex: 0 0 auto; }
            .legend { min-width: 0; }
        }

        /* Further small-screen tweaks */
        @media (max-width: 480px) {
            .sidebar { width: 86%; }
            body.sidebar-open .sidebar:not(.collapsed) { width: 86% !important; }
            .page-title-input { font-size: 16px; }
            .editor { padding: 10px; }
        }
    </style>
    <style>
        /* ── Homework panel styles ── */
        .hw-setup-overlay{position:fixed;inset:0;z-index:8000;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;opacity:1;transition:opacity .4s ease;}
        .hw-setup-overlay.fade-out{opacity:0;pointer-events:none;}
        .hw-setup-card{background:var(--neumo-bg,#181614);border:1px solid var(--glass-border);border-radius:18px;padding:32px 28px;width:min(520px,92vw);max-height:86vh;overflow-y:auto;box-shadow:0 24px 60px rgba(0,0,0,.45);animation:hw-pop .35s cubic-bezier(.22,1,.36,1) both;}
        @keyframes hw-pop{from{transform:scale(.92) translateY(18px);opacity:0}to{transform:none;opacity:1}}
        .hw-setup-card h2{margin:0 0 6px;font-family:var(--font-heading);font-size:1.6rem;}
        .hw-setup-card p{margin:0 0 18px;color:var(--text-secondary);font-size:.95rem;}
        .hw-setup-card label{display:block;font-weight:600;margin-bottom:6px;font-size:.85rem;letter-spacing:.04em;text-transform:uppercase;color:var(--text-secondary);}
        .hw-chip-input{display:flex;flex-wrap:wrap;gap:8px;padding:10px;border:1px solid var(--glass-border);border-radius:12px;background:rgba(255,255,255,.03);min-height:48px;margin-bottom:18px;}
        .hw-chip{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:999px;background:var(--accent-soft);color:var(--text-primary);font-size:.85rem;font-weight:600;}
        .hw-chip button{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:14px;padding:0 2px;}
        .hw-chip-input input{border:none;background:none;outline:none;color:var(--text-primary);flex:1;min-width:120px;font-size:.9rem;}
        .hw-setup-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:8px;}

        .hw-table-wrap{width:100%;overflow-x:auto;overflow-y:hidden;scrollbar-gutter:stable both-edges;animation:hw-fade-in .45s ease both;border:1px solid var(--glass-border);border-radius:12px;background:var(--neumo-bg);}
        @keyframes hw-fade-in{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
        .hw-data-table{width:100%;max-width:100%;table-layout:fixed;border-collapse:collapse;border-spacing:0;}
        .hw-data-table th{padding:10px 12px;text-align:left;font-size:.74rem;letter-spacing:.07em;text-transform:uppercase;color:var(--text-muted);border:1px solid var(--glass-border);position:sticky;top:0;background:var(--neumo-bg);z-index:1;}
        .hw-data-table td{padding:10px 12px;border:1px solid var(--glass-border);vertical-align:top;color:var(--text-primary);}
        .hw-data-table th:nth-child(1), .hw-data-table td:nth-child(1){width:14%;}
        .hw-data-table th:nth-child(2), .hw-data-table td:nth-child(2){width:36%;}
        .hw-data-table th:nth-child(3), .hw-data-table td:nth-child(3){width:14%;}
        .hw-data-table th:nth-child(4), .hw-data-table td:nth-child(4){width:36%;}
        .hw-data-table tr:hover td{background:rgba(255,255,255,.018);}
        .hw-data-table .hw-course-name{font-weight:700;white-space:normal;word-break:break-word;}
        .hw-course-row{display:flex;align-items:center;justify-content:space-between;gap:8px;min-width:0;}
        .hw-course-title{min-width:0;white-space:normal;overflow-wrap:break-word;word-break:break-word;line-height:1.28;}
        .hw-course-empty{background:rgba(255,255,255,.01);}
        .hw-course-remove{background:none;border:1px solid rgba(255,255,255,.1);color:var(--text-muted);cursor:pointer;font-size:12px;border-radius:999px;line-height:1;padding:1px 6px;flex:0 0 auto;}
        .hw-course-remove:hover{color:var(--text-primary);border-color:rgba(255,255,255,.2);}
        .hw-data-table .hw-misc-badge{display:inline-block;margin-left:6px;font-size:.65rem;padding:2px 7px;border-radius:999px;background:var(--accent-soft);color:var(--accent);font-weight:700;vertical-align:middle;}
        .hw-task-cell{padding:8px 10px;}
        .hw-task-cell-empty{background:rgba(255,255,255,.01);}
        .hw-task-list{list-style:none;padding:0;margin:0;display:grid;gap:10px;}
        .hw-task-item{display:grid;gap:10px;padding:10px;border:1px solid rgba(255,255,255,.16);border-left:3px solid var(--accent);border-radius:10px;background:rgba(255,255,255,.04);box-shadow:inset 0 0 0 1px rgba(255,255,255,.02);}
        .hw-task-item.done .hw-task-text{text-decoration:line-through;color:var(--text-muted);}
        .hw-task-main{display:grid;grid-template-columns:auto minmax(0,1fr);gap:8px;align-items:start;}
        .hw-task-text{display:block;font-size:.9rem;line-height:1.34;overflow-wrap:break-word;word-break:break-word;}
        .hw-task-badge{display:inline-flex;align-items:center;justify-content:center;font-size:.6rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase;padding:3px 7px;border-radius:999px;background:rgba(255,124,139,.15);border:1px solid rgba(255,124,139,.35);color:var(--accent);}
        .hw-task-meta{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:8px;align-items:end;}
        .hw-task-control{display:grid;gap:4px;min-width:0;}
        .hw-task-control span,.hw-task-label{font-size:.62rem;letter-spacing:.06em;text-transform:uppercase;color:var(--text-secondary);font-weight:700;}
        .hw-task-control select{width:100%;min-width:0;padding:4px 8px;border-radius:7px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.03);color:var(--text-primary);font-size:.75rem;}
        .hw-task-due-wrap{display:grid;gap:4px;min-width:0;}
        .hw-task-due{display:flex;align-items:center;min-height:32px;padding:4px 8px;border-radius:7px;border:1px dashed rgba(255,255,255,.22);font-size:.75rem;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .hw-task-actions{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:6px;align-items:stretch;}
        .hw-task-actions button{width:100%;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.1);color:var(--text-muted);cursor:pointer;font-size:12px;padding:5px 8px;border-radius:7px;}
        .hw-task-actions button:hover{color:var(--text-primary);background:rgba(255,255,255,.06);}
        .hw-inline-add{display:grid;grid-template-columns:minmax(0,1fr) 118px 92px 92px 34px;gap:6px;margin-top:8px;padding:8px;border:1px dashed rgba(255,255,255,.12);border-radius:10px;background:rgba(255,255,255,.02);}
        .hw-inline-add input{width:100%;min-width:0;padding:6px 8px;border-radius:7px;border:1px solid rgba(255,255,255,.1);background:transparent;color:var(--text-primary);font-size:.83rem;}
        .hw-inline-add input[type="text"]{grid-column:1 / 2;}
        .hw-inline-add button{padding:5px 0;border-radius:7px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text-primary);cursor:pointer;font-size:.88rem;font-weight:700;line-height:1;}
        .hw-inline-add button:hover{background:rgba(255,255,255,.08);}
        .hw-header-bar{display:flex;gap:10px;justify-content:space-between;align-items:center;flex-wrap:wrap;margin-bottom:14px;}
        .hw-header-bar h2{margin:0;}
        .hw-btn{padding:8px 14px;border-radius:999px;border:1px solid var(--glass-border);background:var(--neumo-bg);color:var(--text-primary);cursor:pointer;font-size:.85rem;font-weight:600;box-shadow:4px 4px 10px var(--neumo-shadow-dark,rgba(0,0,0,.12)),-4px -4px 10px var(--neumo-shadow-light,rgba(255,255,255,.04));}
        .hw-btn i{font-size:.82rem;margin-right:6px;}
        .hw-btn:hover{transform:translateY(-1px);}
        .hw-btn-accent{background:var(--accent-soft);border-color:var(--accent);}
        @media (max-width: 1500px){
            .hw-inline-add{grid-template-columns:minmax(0,1fr) 106px 82px 82px 34px;}
            .hw-task-meta{grid-template-columns:repeat(2,minmax(0,1fr));}
            .hw-task-actions{grid-column:1 / -1;}
        }
        @media (max-width: 1200px){
            .hw-table-wrap{overflow-x:hidden;}
            .hw-data-table{min-width:0;width:100%;}
            .hw-inline-add{grid-template-columns:minmax(0,1fr) 110px 1fr 1fr 34px;}
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Mobile Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
        <!-- Sidebar Toggle Button -->
        <button class="sidebar-toggle-btn neumo-btn" id="sidebarToggle" onclick="toggleSidebar()" title="Toggle Sidebar">
            <i class="fas fa-chevron-left"></i>
        </button>
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="app-title">
                    <i class="fas fa-layer-group" style="color: var(--accent);"></i>
                    <span>NoteFlow Atelier</span>
                </div>
            </div>
            
            <div class="sidebar-search">
                <input type="text" class="search-input neumo-input" id="searchInput" placeholder="Search pages..." oninput="filterPages()">
            </div>
            
            <!-- Focus Timer (compact) -->
            <div class="focus-timer neumo-card" id="focusTimer">
                <div class="timer-top" onclick="toggleTimerSettings()">
                    <div class="timer-left">
                        <div class="timer-mode-badge" id="timerMode">Timer</div>
                        <div class="timer-display" id="timerDisplay">25:00</div>
                    </div>
                    <div class="timer-controls" onclick="event.stopPropagation()">
                        <button id="timerStartBtn" class="icon-btn primary" title="Start" aria-label="Start timer"><i class="fas fa-play"></i></button>
                        <button id="timerPauseBtn" class="icon-btn" title="Pause" aria-label="Pause timer" style="display:none;"><i class="fas fa-pause"></i></button>
                        <button id="timerResetBtn" class="icon-btn" title="Reset" aria-label="Reset timer"><i class="fas fa-redo"></i></button>
                        <button id="timerSettingsBtn" class="icon-btn" title="Settings" aria-label="Timer settings"><i class="fas fa-cog"></i></button>
                    </div>
                </div>
                <div class="timer-settings" id="timerSettings" onclick="event.stopPropagation()">
                    <div class="timer-presets">
                        <button class="preset-btn" onclick="setTimerPreset(15)">15m</button>
                        <button class="preset-btn" onclick="setTimerPreset(25)">25m</button>
                        <button class="preset-btn" onclick="setTimerPreset(50)">50m</button>
                    </div>
                    <div class="timer-custom-input">
                        <label class="timer-field"><span>H</span><input id="hoursInput" type="number" min="0" value="0"></label>
                        <label class="timer-field"><span>M</span><input id="minutesInput" type="number" min="0" max="59" value="25"></label>
                        <label class="timer-field"><span>S</span><input id="secondsInput" type="number" min="0" max="59" value="0"></label>
                    </div>
                    <div class="timer-audio-settings">
                        <label class="timer-field timer-field--wide" for="timerRingtoneSelect">
                            <span>Ringtone</span>
                            <select id="timerRingtoneSelect">
                                <option value="classic">Classic Bell</option>
                                <option value="digital">Digital Beep</option>
                                <option value="soft">Soft Chime</option>
                                <option value="zen">Zen Bowl</option>
                                <option value="sonar">Sonar Pulse</option>
                                <option value="arcade">Arcade Alert</option>
                                <option value="crystal">Crystal Ping</option>
                            </select>
                        </label>
                        <label class="timer-field timer-field--wide" for="timerVolumeInput">
                            <span>Alarm Volume</span>
                            <div class="timer-volume-row">
                                <input id="timerVolumeInput" type="range" min="0" max="100" step="1" value="60">
                                <output id="timerVolumeValue" for="timerVolumeInput">60%</output>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="timer-progress"><div class="timer-progress-bar" id="timerProgress"></div></div>
            </div>
            
            <!-- Tags Filter -->
            <div class="sidebar-tags-filter" id="sidebarTagsFilter" style="display: none;">
                <div class="sidebar-tags-filter-title">Filter by tags</div>
                <div class="sidebar-tags-list" id="sidebarTagsList"></div>
            </div>
            
            <div class="pages-list" id="pagesList"></div>
            
            <button class="new-page-btn" onclick="createNewPage()">
                <i class="fas fa-plus"></i> New Page
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-nav glass-panel">
                <div class="nav-left">
                    <div class="app-brand">
                        <div class="brand-label">NoteFlow Atelier</div>
                        <div class="brand-sub">Offline-first workspace</div>
                    </div>
                    <div class="nav-divider"></div>
                                        <div class="tabs-shell">
                                            <div class="view-tabs" role="tablist">
                                                    <button class="view-tab active" data-view="today">Today</button>
                                                    <button class="view-tab" data-view="timeline">Timeline</button>
                                                    <button class="view-tab" data-view="notes">Notes</button>
                                                    <button class="view-tab" data-view="collegeapp">College</button>
                                                    <button class="view-tab" data-view="life">Life</button>
                                                    <button id="tabHomework" class="view-tab" data-view="homework">Homework</button>
                                                    <button class="view-tab" data-view="settings">Settings</button>
                                                    <div class="toolbar-time-elegant tab-clock-embed" role="group" aria-label="Clock widget">
                                                        <span class="tab-clock-main">
                                                            <i class="fas fa-clock tab-clock-icon"></i>
                                                            <span class="toolbar-time-widget" id="toolbarTimeWidget"></span>
                                                            <button id="toolbarTimeGear" class="tab-clock-gear" aria-label="Clock settings">
                                                                <i class="fas fa-cog"></i>
                                                            </button>
                                                        </span>
                                                        <span id="toolbarTimeControls" class="tab-clock-controls" style="display:none;">
                                                            <select id="timeFormatSelect">
                                                                <option value="12">12h</option>
                                                                <option value="24">24h</option>
                                                            </select>
                                                            <select id="showSecondsSelect">
                                                                <option value="true">Sec</option>
                                                                <option value="false">No Sec</option>
                                                            </select>
                                                        </span>
                                                    </div>
                                                    <div class="quick-app-launchers" id="quickAppLaunchers" role="group" aria-label="Quick launch apps">
                                                        <button type="button" class="quick-app-btn spotify" onclick="openQuickLaunchTarget('spotify')" title="Open Spotify">
                                                            <i class="fab fa-spotify" aria-hidden="true"></i>
                                                            <span>Spotify</span>
                                                        </button>
                                                        <button type="button" class="quick-app-btn chatgpt" onclick="openQuickLaunchTarget('chatgpt')" title="Open ChatGPT">
                                                            <i class="fa-brands fa-openai" aria-hidden="true"></i>
                                                            <span>ChatGPT</span>
                                                        </button>
                                                    </div>
                                            </div>
                                            <!-- Mobile toggle: shows current tab and expands the tab list when tapped -->
                                            <button class="view-tabs-toggle" aria-expanded="false" aria-label="Toggle views" title="Toggle views">
                                                <span class="view-tabs-current">Today</span>
                                                <i class="fas fa-chevron-down" aria-hidden="true" style="margin-left:8px"></i>
                                            </button>
                                        </div>
                </div>
                <div class="nav-right">
                    <input type="search" class="global-search neumo-input" id="globalSearch" placeholder="Search notes and tasks">
                </div>
            </div>

            <section id="view-today" class="view view-today active dashboard-today">
                <div class="view-header">
                    <div>
                        <div class="eyebrow">Today</div>
                        <h2 id="todayLabel">Tuesday, Jan 2</h2>
                    </div>
                    <div class="today-header-actions">
                        <button id="toggleAllTasksBtn" class="neumo-btn" title="Show tasks">All Tasks</button>
                        <button id="topAddTaskBtn" class="neumo-btn" title="Add task">+ Add Task</button>
                        <div class="streak-pill" id="todayStreakPill">Streak: 0 days</div>
                    </div>
                </div>
                <div class="today-dashboard-surface">
                <div class="summary-grid">
                    <div class="glass-card summary-card">
                        <div class="summary-label">Current Streak</div>
                        <div class="summary-value" id="globalStreak">0</div>
                        <div class="summary-meta" id="globalBest">Best: 0</div>
                    </div>
                    <div class="glass-card summary-card">
                        <div class="summary-label">Committed Days</div>
                        <div class="summary-value" id="weekCommitDays">0</div>
                        <div class="summary-meta">This week</div>
                    </div>
                    <div class="glass-card summary-card">
                        <div class="summary-label">Weekly Completions</div>
                        <div class="summary-value" id="weekCompletions">0</div>
                        <div class="summary-meta">Tasks done</div>
                    </div>
                    <div class="glass-card summary-card">
                        <div class="summary-label">Freezes Left</div>
                        <div class="summary-value" id="freezeLeft">2</div>
                        <div class="summary-meta">This week</div>
                    </div>
                </div>
                <div class="today-grid">
                    <div class="glass-card today-panel today-panel-committed">
                        <div class="panel-header">
                            <h3>Committed Today</h3>
                            <span class="neumo-chip" id="commitCount">(0/3)</span>
                        </div>
                        <div id="today-committed-list" class="task-list"></div>
                        <div id="today-committed-empty" class="empty-state">
                            <div class="empty-title">No tasks committed</div>
                            <div class="empty-subtitle">Pick 1-3 tasks to focus on today.</div>
                        </div>
                    </div>
                    <div class="glass-card today-panel today-panel-due">
                        <div class="panel-header">
                            <h3>Due Today</h3>
                            <span class="neumo-chip" id="dueCount">0 due</span>
                        </div>
                        <div id="today-due-list" class="task-list"></div>
                        <div id="today-due-empty" class="empty-state">
                            <div class="empty-title">Nothing due today</div>
                            <div class="empty-subtitle">Add a streak or one-off task.</div>
                        </div>
                    </div>
                    <div class="glass-card today-panel today-panel-completed">
                        <div class="panel-header">
                            <h3>Completed Today</h3>
                            <span class="neumo-chip" id="completedCount">0 done</span>
                        </div>
                        <div id="today-completed-list" class="task-list"></div>
                        <div id="today-completed-empty" class="empty-state">
                            <div class="empty-title">No completed tasks yet</div>
                            <div class="empty-subtitle">Complete a task, then use Undo here if needed.</div>
                        </div>
                    </div>
                    <div class="glass-card today-panel today-panel-habits">
                        <div class="panel-header">
                            <h3>Habit Tracker</h3>
                            <span class="neumo-chip" id="habitTodayCount">0 done</span>
                        </div>
                        <div class="habit-add-row">
                            <input
                                id="habitNameInput"
                                class="neumo-input"
                                type="text"
                                placeholder="Add a habit..."
                                onkeydown="if(event.key==='Enter'){event.preventDefault();addHabitFromInput();}"
                            />
                            <button class="neumo-btn" id="addHabitBtn" onclick="addHabitFromInput()">Add</button>
                        </div>
                        <div id="habitList" class="task-list"></div>
                        <div id="habitEmpty" class="empty-state">
                            <div class="empty-title">No habits yet</div>
                            <div class="empty-subtitle">Add daily or weekly habits and check them off here.</div>
                        </div>
                    </div>
                    <!-- All Tasks panel moved to a collapsible drawer for minimal layout -->
                    <!-- Quick Actions removed -->
                </div>
                </div>

                <section class="today-academic-section" aria-labelledby="todayAcademicHeading">
                    <div class="view-header today-academic-header">
                        <div>
                            <div class="eyebrow">Academic Planner</div>
                            <h2 id="todayAcademicHeading">Deadlines + Coursework</h2>
                        </div>
                        <div class="academic-header-actions">
                            <button class="neumo-btn" id="todayAcademicToggleDeadlineFormBtn" type="button"><i class="fas fa-plus"></i> Deadline</button>
                            <button class="neumo-btn" id="todayAcademicAddExtracurricularBtn" type="button"><i class="fas fa-plus"></i> Activity</button>
                        </div>
                    </div>

                    <div class="academic-summary-grid summary-grid today-academic-summary-grid">
                        <div class="glass-card summary-card">
                            <div class="summary-label">Upcoming Deadlines (7 days)</div>
                            <div class="summary-value" id="todayAcademicUpcomingCount">0</div>
                            <div class="summary-meta">Assignments + exams + extracurricular meetings</div>
                        </div>
                    </div>

                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>Upcoming Deadlines + Filters</h3>
                        </div>
                        <div class="academic-filter-grid">
                            <div class="academic-filter-field">
                                <label for="todayAcademicFilterStatus">Status</label>
                                <select id="todayAcademicFilterStatus" class="college-select" data-academic-filter="status">
                                    <option value="all">All Statuses</option>
                                    <option value="not_started">Not Started</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="done">Done</option>
                                    <option value="scheduled">Scheduled</option>
                                    <option value="studying">Studying</option>
                                    <option value="completed">Completed</option>
                                    <option value="active">Active</option>
                                    <option value="planned">Planned</option>
                                    <option value="paused">Paused</option>
                                </select>
                            </div>
                            <div class="academic-filter-field">
                                <label for="todayAcademicFilterClass">Class</label>
                                <select id="todayAcademicFilterClass" class="college-select" data-academic-filter="className">
                                    <option value="all">All Classes</option>
                                </select>
                            </div>
                            <div class="academic-filter-field">
                                <label for="todayAcademicFilterPriority">Priority</label>
                                <select id="todayAcademicFilterPriority" class="college-select" data-academic-filter="priority">
                                    <option value="all">All Priorities</option>
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            <div class="academic-filter-field">
                                <label for="todayAcademicSortBy">Sort By</label>
                                <select id="todayAcademicSortBy" class="college-select" data-academic-filter="sortBy">
                                    <option value="dueDate">Due Date</option>
                                    <option value="priority">Priority</option>
                                    <option value="class">Class</option>
                                    <option value="status">Status</option>
                                </select>
                            </div>
                            <div class="academic-filter-field">
                                <label for="todayAcademicSortDirection">Direction</label>
                                <select id="todayAcademicSortDirection" class="college-select" data-academic-filter="sortDirection">
                                    <option value="asc">Ascending</option>
                                    <option value="desc">Descending</option>
                                </select>
                            </div>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Item</th>
                                        <th>Class</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="todayAcademicUpcomingTableBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="today-academic-module-stack">
                        <div class="glass-card academic-module-card">
                            <div class="academic-module-head">
                                <h3>Assignments + Exams</h3>
                                <button class="neumo-btn" id="todayAcademicToggleDeadlineFormBtnSecondary" type="button">+ Add Deadline</button>
                            </div>
                            <form id="todayAcademicDeadlineForm" class="today-academic-add-form" hidden novalidate>
                                <div class="today-academic-add-grid">
                                    <div class="academic-filter-field">
                                        <label for="todayAcademicNewType">Type</label>
                                        <select id="todayAcademicNewType" class="college-select">
                                            <option value="assignment">Assignment</option>
                                            <option value="exam">Exam</option>
                                        </select>
                                    </div>
                                    <div class="academic-filter-field">
                                        <label for="todayAcademicNewTitle">Title</label>
                                        <input id="todayAcademicNewTitle" class="college-input" type="text" placeholder="Name">
                                    </div>
                                    <div class="academic-filter-field">
                                        <label for="todayAcademicNewClass">Class</label>
                                        <input id="todayAcademicNewClass" class="college-input" type="text" placeholder="Class">
                                    </div>
                                    <div class="academic-filter-field">
                                        <label for="todayAcademicNewDate">Date</label>
                                        <input id="todayAcademicNewDate" class="college-input" type="date">
                                    </div>
                                    <div class="academic-filter-field" id="todayAcademicNewTimeWrap">
                                        <label for="todayAcademicNewTime">Time (Exam)</label>
                                        <input id="todayAcademicNewTime" class="college-input" type="time">
                                    </div>
                                    <div class="academic-filter-field">
                                        <label for="todayAcademicNewPriority">Priority</label>
                                        <select id="todayAcademicNewPriority" class="college-select">
                                            <option value="high">High</option>
                                            <option value="medium" selected>Medium</option>
                                            <option value="low">Low</option>
                                        </select>
                                    </div>
                                    <div class="academic-filter-field">
                                        <label for="todayAcademicNewStatus">Status</label>
                                        <select id="todayAcademicNewStatus" class="college-select">
                                            <option value="not_started">Not Started</option>
                                            <option value="in_progress">In Progress</option>
                                            <option value="done">Done</option>
                                        </select>
                                    </div>
                                    <div class="academic-filter-field today-academic-add-notes">
                                        <label for="todayAcademicNewNotes">Notes</label>
                                        <textarea id="todayAcademicNewNotes" class="college-textarea" rows="2" placeholder="Details"></textarea>
                                    </div>
                                </div>
                                <div class="today-academic-add-actions">
                                    <button class="neumo-btn" id="todayAcademicCreateDeadlineBtn" type="button">Add</button>
                                    <button class="neumo-btn" id="todayAcademicCancelDeadlineBtn" type="button">Cancel</button>
                                </div>
                            </form>
                            <div class="college-table-wrap">
                                <table class="college-table">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>Item</th>
                                            <th>Class</th>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Priority</th>
                                            <th>Status</th>
                                            <th>Notes</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="todayAcademicDeadlineTableBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="glass-card academic-module-card">
                            <div class="academic-module-head">
                                <h3>Extracurricular Tracker</h3>
                                <button class="neumo-btn" id="todayAcademicAddExtracurricularBtnSecondary" type="button">+ Add Activity</button>
                            </div>
                            <div class="college-table-wrap">
                                <table class="college-table">
                                    <thead>
                                        <tr>
                                            <th>Activity</th>
                                            <th>Role</th>
                                            <th>Meeting Date</th>
                                            <th>Status</th>
                                            <th>Notes</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="todayAcademicExtracurricularTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Progress content merged into Today view -->
                <div class="today-analytics-section">
                <div class="view-header today-analytics-header">
                    <div>
                        <div class="eyebrow">Progress</div>
                        <h2>Your moment at a glance</h2>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="glass-card card-weekly">
                        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                            <h4>Weekly Completions</h4>
                            <div class="neumo-chip" id="weeklyChange">+0%</div>
                        </div>
                        <div class="card-content">
                            <div class="sparkline" id="sparklineWeekly" aria-hidden="true">[sparkline]</div>
                            <div class="card-stat" id="weeklyTotal">0</div>
                            <div class="card-meta">Tasks completed this week</div>
                        </div>
                    </div>

                    <div class="glass-card card-monthly">
                        <h4>Monthly Overview</h4>
                        <div class="card-content">
                            <div class="heatmap-placeholder" id="monthlyHeatmap">[calendar heatmap]</div>
                            <div class="card-meta">Activity over the last 30 days</div>
                        </div>
                    </div>

                    <div class="glass-card card-categories">
                        <h4>Category Breakdown</h4>
                        <div class="card-content" style="display:flex; gap:12px; align-items:center;">
                            <div class="donut-placeholder" id="categoryDonut">[donut]</div>
                            <div class="legend" id="categoryLegend">
                                <!-- categories populated by JS -->
                                <div class="legend-item"><span class="legend-color" style="background:var(--accent)"></span> Work <span class="legend-value">0</span></div>
                                <div class="legend-item"><span class="legend-color" style="background:#6c5ce7"></span> Personal <span class="legend-value">0</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card card-streaks">
                        <h4>Streak Stats</h4>
                        <div class="card-content" style="display:flex; flex-direction:column; gap:6px;">
                            <div class="streak-large" id="streakCurrent" style="font-size:36px; font-weight:700;">0</div>
                            <div class="streak-meta">Current streak</div>
                            <div style="display:flex; gap:12px; align-items:center;">
                                <div class="streak-small">
                                    <div class="small-label">Best</div>
                                    <div id="streakBest">0</div>
                                </div>
                                <div class="streak-small">
                                    <div class="small-label">Longest</div>
                                    <div id="streakLongest">0</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                </div>

                    <!-- Floating Add Task FAB (only visible on Today view) -->
                    <div class="fab-container" aria-hidden="false">
                        <button id="addTaskBtn" class="fab-add-task" title="New task" aria-label="New task">
                            <i class="fas fa-plus"></i>
                        </button>
                        <span class="fab-label">New task</span>
                    </div>

            </section>

            <!-- TIMELINE VIEW (TimeTile) -->
            <section id="view-timeline" class="view view-timeline">
                <div class="view-header">
                    <div>
                        <div class="eyebrow">Timeline</div>
                        <h2 id="timelineHeading">Your Day at a Glance</h2>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <select id="timelineViewModeSelect" class="neumo-input" style="width:auto; padding:6px 10px;">
                            <option value="day">Day</option>
                            <option value="week">Week</option>
                            <option value="month">Month</option>
                            <option value="year">Year</option>
                        </select>
                        <input id="timelineDateInput" type="date" class="neumo-input" style="width:auto; padding:6px 10px;" />
                        <span class="mode-badge" id="timeModeBadge">Morning</span>
                        <select id="timeModeSelect" class="neumo-input" style="width:auto; padding:6px 10px;">
                            <option value="">Auto</option>
                            <option value="morning">Morning</option>
                            <option value="afternoon">Afternoon</option>
                            <option value="evening">Evening</option>
                            <option value="night">Night</option>
                        </select>
                        <button class="neumo-btn" id="addBlockBtn">+ Add Block</button>
                    </div>
                </div>

                <div class="timeline-wrapper glass-panel">
                    <div class="timeline-container">
                        <div class="timeline-scale" id="timelineScale"></div>
                        <div class="timeline-blocks" id="timelineBlocks"></div>
                    </div>
                    <div class="timeline-calendar-view" id="timelineCalendarView" style="display:none;"></div>
                </div>

                <!-- Current block quick info -->
                <div class="glass-card current-block-card" id="currentBlockCard" style="margin-top:20px;">
                    <div class="panel-header">
                        <h3>Current Block</h3>
                        <span class="neumo-chip" id="blockCountdown">--:--</span>
                    </div>
                    <div id="currentBlockInfo">No active block right now</div>
                    <div class="progress-bar" style="margin-top:12px;">
                        <div class="progress-fill" id="blockProgressFill" style="width:0%"></div>
                    </div>
                </div>
            </section>

            <section id="view-notes" class="view view-notes">
            <!-- Toolbar -->
            <div class="toolbar-wrapper">
                <button class="toolbar-scroll-btn left" id="toolbarScrollLeft" onclick="scrollToolbar(-200)" title="Scroll left">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="toolbar" id="toolbar">
                <button class="toolbar-btn" onclick="formatText('bold')">
                    <i class="fas fa-bold"></i>
                </button>
                <button class="toolbar-btn" onclick="formatText('italic')">
                    <i class="fas fa-italic"></i>
                </button>
                <button class="toolbar-btn" onclick="formatText('strikeThrough')" title="Strikethrough">
                    <i class="fas fa-strikethrough"></i>
                </button>
                <button class="toolbar-btn" onclick="formatText('underline')">
                    <i class="fas fa-underline"></i>
                </button>
                
                <div class="toolbar-separator"></div>
                
                <button class="toolbar-btn" onclick="formatBlock('h1')">
                    H1
                </button>
                <button class="toolbar-btn" onclick="formatBlock('h2')">
                    H2
                </button>
                <button class="toolbar-btn" onclick="formatBlock('h3')">
                    H3
                </button>
                
                <div class="toolbar-separator"></div>
                
                <button class="toolbar-btn" onclick="formatText('insertUnorderedList')">
                    <i class="fas fa-list-ul"></i>
                </button>
                <button class="toolbar-btn" onclick="formatText('insertOrderedList')">
                    <i class="fas fa-list-ol"></i>
                </button>
                <button class="toolbar-btn" onclick="formatBlock('blockquote')">
                    <i class="fas fa-quote-left"></i>
                </button>
                
                <div class="toolbar-separator"></div>
                
                <button class="toolbar-btn" onclick="insertLink()">
                    <i class="fas fa-link"></i>
                </button>
                <button class="toolbar-btn" onclick="clearFormatting()" title="Clear formatting">
                    <i class="fas fa-eraser"></i>
                </button>
                <button class="toolbar-btn" onclick="formatBlock('pre')">
                    <i class="fas fa-code"></i>
                </button>
                <button class="toolbar-btn" onclick="insertTable()" title="Insert Table">
                    <i class="fas fa-table"></i>
                </button>
                <button class="toolbar-btn" onclick="insertImage()" title="Insert Image">
                    <i class="fas fa-image"></i>
                </button>
                <button class="toolbar-btn" onclick="insertVideo()" title="Insert Video">
                    <i class="fas fa-video"></i>
                </button>
                <button class="toolbar-btn" onclick="insertAudio()" title="Insert Audio">
                    <i class="fas fa-music"></i>
                </button>
                <button class="toolbar-btn" onclick="insertEmbed()" title="Embed Web Content">
                    <i class="fas fa-globe"></i>
                </button>
                <button class="toolbar-btn" onclick="insertChecklist()" title="Insert Checklist">
                    <i class="fas fa-tasks"></i>
                </button>
                <button class="toolbar-btn" onclick="insertCollapsible()" title="Insert Collapsible Section">
                    <i class="fas fa-chevron-down"></i>
                </button>
                <button class="toolbar-btn" onclick="insertPageLink()" title="Link to Page">
                    <i class="fas fa-file-alt"></i>
                </button>
                
                <div class="toolbar-separator"></div>
                
                <div class="word-count-display" id="wordCountDisplay">
                    0 words
                </div>
                
                <!-- Font Settings Dropdown -->
                <div class="toolbar-dropdown" style="position: relative; margin-left: 8px;">
                    <button class="toolbar-btn" id="fontPanelBtn" onclick="toggleFontPanel()" title="Font & Display Settings" style="display: flex; align-items: center; gap: 4px;">
                        <i class="fas fa-font"></i>
                        <i class="fas fa-caret-down" style="font-size: 10px;"></i>
                    </button>
                </div>
                </div>
                <button class="toolbar-scroll-btn right" id="toolbarScrollRight" onclick="scrollToolbar(200)" title="Scroll right">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Editor -->
            <div class="editor-container">
                <div class="breadcrumbs" id="breadcrumbs"></div>
                <input type="text" class="page-title-input" id="pageTitle" placeholder="Untitled" />
                <div class="tags-container" id="tagsContainer">
                    <button class="add-tag-btn" onclick="showAddTagInput()">
                        <i class="fas fa-plus"></i> Add tag
                    </button>
                </div>
                <!-- Linked tasks feature removed -->
                <div class="editor" id="editor" contenteditable="true" placeholder="Start typing..."></div>
            </div>

            <!-- Status Bar removed - save indicator moved to bottom save bar (taskbar) -->
            </section>

            <!-- Progress view merged into Today view above -->

            <section id="view-collegeapp" class="view view-collegeapp">

                <!-- ===== DASHBOARD (main landing) ===== -->
                <div id="collegeappDashboard" class="collegeapp-dashboard">
                    <div class="view-header">
                        <div>
                            <div class="eyebrow">College App</div>
                            <h2>Applications End-to-End</h2>
                        </div>
                        <div class="collegeapp-header-actions">
                            <button class="neumo-btn" id="collegeAppQuickAddTrackerBtn" type="button"><i class="fas fa-plus"></i> College</button>
                            <button class="neumo-btn" id="collegeAppQuickAddEssayBtn" type="button"><i class="fas fa-plus"></i> Essay</button>
                            <button class="neumo-btn" id="collegeAppQuickAddScholarshipBtn" type="button"><i class="fas fa-plus"></i> Scholarship</button>
                        </div>
                    </div>

                    <!-- Summary cards -->
                    <div class="collegeapp-summary-grid summary-grid">
                        <div class="glass-card summary-card">
                            <div class="summary-label">Application Completion</div>
                            <div class="summary-value" id="collegeAppCompletionValue">0%</div>
                            <div class="summary-meta">Submitted or final-status schools</div>
                        </div>
                        <div class="glass-card summary-card">
                            <div class="summary-label">Upcoming Deadlines (30 days)</div>
                            <div class="summary-value" id="collegeAppUpcomingValue">0</div>
                            <div class="summary-meta">College + scholarship deadlines</div>
                        </div>
                        <div class="glass-card summary-card">
                            <div class="summary-label">Scholarship Pipeline</div>
                            <div class="summary-value" id="collegeAppScholarshipValue">$0</div>
                            <div class="summary-meta">Submitted / won value tracked</div>
                        </div>
                    </div>

                    <!-- Navigation grid buttons -->
                    <div class="collegeapp-nav-grid">
                        <button class="collegeapp-nav-btn" data-collegeapp-page="tracker">
                            <i class="fas fa-university"></i>
                            <span>College Tracker</span>
                        </button>
                        <button class="collegeapp-nav-btn" data-collegeapp-page="essays">
                            <i class="fas fa-pen-fancy"></i>
                            <span>College Essay Organizer</span>
                        </button>
                        <button class="collegeapp-nav-btn" data-collegeapp-page="scores">
                            <i class="fas fa-chart-bar"></i>
                            <span>Score Tracker</span>
                        </button>
                        <button class="collegeapp-nav-btn" data-collegeapp-page="awards">
                            <i class="fas fa-trophy"></i>
                            <span>Award / Honors Tracker</span>
                        </button>
                        <button class="collegeapp-nav-btn" data-collegeapp-page="scholarships">
                            <i class="fas fa-hand-holding-usd"></i>
                            <span>Scholarship Tracker</span>
                        </button>
                        <button class="collegeapp-nav-btn" data-collegeapp-page="decision">
                            <i class="fas fa-balance-scale"></i>
                            <span>Decision Matrix</span>
                        </button>
                        <button class="collegeapp-nav-btn" data-collegeapp-page="sheets">
                            <i class="fas fa-table"></i>
                            <span>Application Sheets</span>
                        </button>
                    </div>
                </div>

                <!-- ===== SUB-PAGES (hidden by default) ===== -->

                <!-- Application Sheets (merged from College tab) -->
                <div id="collegeappPage-sheets" class="collegeapp-subpage" style="display:none;">
                    <button class="collegeapp-back-btn" data-collegeapp-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="view-header">
                        <div>
                            <h3>Application Sheets</h3>
                        </div>
                        <div class="college-header-actions">
                            <button class="neumo-btn" id="collegeAddRowBtn" type="button"><i class="fas fa-plus"></i> Add Row</button>
                            <button class="neumo-btn" id="collegeClearSheetBtn" type="button"><i class="fas fa-eraser"></i> Clear Sheet</button>
                        </div>
                    </div>

                    <div class="college-summary-grid">
                        <div class="glass-card summary-card">
                            <div class="summary-label">Schools Tracked</div>
                            <div class="summary-value" id="collegeSummarySchools">0</div>
                            <div class="summary-meta">Across all sheets</div>
                        </div>
                        <div class="glass-card summary-card">
                            <div class="summary-label">Apps Submitted</div>
                            <div class="summary-value" id="collegeSummarySubmitted">0</div>
                            <div class="summary-meta">Checklist completed</div>
                        </div>
                        <div class="glass-card summary-card">
                            <div class="summary-label">Upcoming (14 days)</div>
                            <div class="summary-value" id="collegeSummaryUpcoming">0</div>
                            <div class="summary-meta">Application deadlines</div>
                        </div>
                        <div class="glass-card summary-card">
                            <div class="summary-label">Essays Complete</div>
                            <div class="summary-value" id="collegeSummaryEssays">0/0</div>
                            <div class="summary-meta">Final drafts done</div>
                        </div>
                        <div class="glass-card summary-card">
                            <div class="summary-label">Acceptances</div>
                            <div class="summary-value" id="collegeSummaryAcceptances">0</div>
                            <div class="summary-meta">Decision updates</div>
                        </div>
                    </div>

                    <div class="glass-card college-tracker-shell">
                        <div class="college-sheet-tabs" role="tablist" aria-label="College tracker sheets">
                            <button class="college-sheet-tab active" data-college-tab="research" type="button">Research</button>
                            <button class="college-sheet-tab" data-college-tab="checklist" type="button">Checklist</button>
                            <button class="college-sheet-tab" data-college-tab="deadlines" type="button">Deadlines</button>
                            <button class="college-sheet-tab" data-college-tab="essays" type="button">Essay Plan</button>
                            <button class="college-sheet-tab" data-college-tab="prompts" type="button">Essay Prompts</button>
                        </div>

                        <div class="college-sheet-panel active" data-college-panel="research">
                            <div class="college-table-wrap">
                                <table class="college-table">
                                    <thead>
                                        <tr>
                                            <th>College</th>
                                            <th>Decision</th>
                                            <th>System</th>
                                            <th>Student Body</th>
                                            <th>Ratio</th>
                                            <th>City</th>
                                            <th>Avg GPA</th>
                                            <th>Test Optional</th>
                                            <th>Letters</th>
                                            <th>Likelihood</th>
                                            <th>Acceptance %</th>
                                            <th>Essays</th>
                                            <th>Notes</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="collegeResearchTableBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="college-sheet-panel" data-college-panel="checklist">
                            <div class="college-table-wrap">
                                <table class="college-table">
                                    <thead>
                                        <tr>
                                            <th>College</th>
                                            <th>Common App</th>
                                            <th>Transcript</th>
                                            <th>Counselor Letter</th>
                                            <th>Teacher Letters</th>
                                            <th>CSS Profile</th>
                                            <th>ED/EA</th>
                                            <th>Regular</th>
                                            <th>FAFSA</th>
                                            <th>CSS Deadline</th>
                                            <th>App Submitted</th>
                                            <th>Transcript Sent</th>
                                            <th>Recs Sent</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="collegeChecklistTableBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="college-sheet-panel" data-college-panel="deadlines">
                            <div class="college-table-wrap">
                                <table class="college-table">
                                    <thead>
                                        <tr>
                                            <th>College</th>
                                            <th>Essays Done By</th>
                                            <th>Submit By</th>
                                            <th>App Deadline</th>
                                            <th>Submitted</th>
                                            <th>Decision Date</th>
                                            <th>Notes</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="collegeDeadlinesTableBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="college-sheet-panel" data-college-panel="essays">
                            <div class="college-table-wrap">
                                <table class="college-table">
                                    <thead>
                                        <tr>
                                            <th>Essay</th>
                                            <th>1st Draft By</th>
                                            <th>Draft Done</th>
                                            <th>Review By</th>
                                            <th>Review Submitted</th>
                                            <th>Revision By</th>
                                            <th>Revision Submitted</th>
                                            <th>Final By</th>
                                            <th>Final Draft</th>
                                            <th>Word Limit</th>
                                            <th>Notes</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="collegeEssayTableBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="college-sheet-panel" data-college-panel="prompts">
                            <div class="college-table-wrap">
                                <table class="college-table">
                                    <thead>
                                        <tr>
                                            <th>School/System</th>
                                            <th>Prompt</th>
                                            <th>Target Words</th>
                                            <th>Draft Location</th>
                                            <th>Done</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="collegePromptTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- College Tracker page -->
                <div id="collegeappPage-tracker" class="collegeapp-subpage" style="display:none;">
                    <button class="collegeapp-back-btn" data-collegeapp-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>College Tracker</h3>
                            <button class="neumo-btn" id="collegeAppAddTrackerBtn" type="button">+ Add College</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>School</th>
                                        <th>Deadline</th>
                                        <th>Status</th>
                                        <th>Checklist</th>
                                        <th>Next Date</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="collegeAppTrackerTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- College Essay Organizer page -->
                <div id="collegeappPage-essays" class="collegeapp-subpage" style="display:none;">
                    <button class="collegeapp-back-btn" data-collegeapp-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>College Essay Organizer</h3>
                            <button class="neumo-btn" id="collegeAppAddEssayBtn" type="button">+ Add Essay</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>School</th>
                                        <th>Prompt</th>
                                        <th>Draft Status</th>
                                        <th>Version Notes</th>
                                        <th>Due</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="collegeAppEssayTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Score Tracker page -->
                <div id="collegeappPage-scores" class="collegeapp-subpage" style="display:none;">
                    <button class="collegeapp-back-btn" data-collegeapp-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>Score Tracker (SAT/ACT/AP)</h3>
                            <button class="neumo-btn" id="collegeAppAddScoreBtn" type="button">+ Add Score</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>Test Type</th>
                                        <th>Date</th>
                                        <th>Total</th>
                                        <th>Breakdown</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="collegeAppScoreTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Awards / Honors page -->
                <div id="collegeappPage-awards" class="collegeapp-subpage" style="display:none;">
                    <button class="collegeapp-back-btn" data-collegeapp-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>Awards / Honors Tracker</h3>
                            <button class="neumo-btn" id="collegeAppAddAwardBtn" type="button">+ Add Award</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>Award</th>
                                        <th>Level</th>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="collegeAppAwardTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Scholarship Tracker page -->
                <div id="collegeappPage-scholarships" class="collegeapp-subpage" style="display:none;">
                    <button class="collegeapp-back-btn" data-collegeapp-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>Scholarship Tracker</h3>
                            <button class="neumo-btn" id="collegeAppAddScholarshipBtn" type="button">+ Add Scholarship</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>Scholarship</th>
                                        <th>Amount</th>
                                        <th>Deadline</th>
                                        <th>Status</th>
                                        <th>Notes</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="collegeAppScholarshipTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Decision Matrix page -->
                <div id="collegeappPage-decision" class="collegeapp-subpage" style="display:none;">
                    <button class="collegeapp-back-btn" data-collegeapp-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>

                    <!-- Hero: Top Pick -->
                    <div class="dm-hero" id="dmHero">
                        <div class="dm-hero-badge"><i class="fas fa-crown"></i></div>
                        <div class="dm-hero-body">
                            <div class="dm-hero-label">TOP PICK</div>
                            <div class="dm-hero-name" id="dmHeroName">&mdash;</div>
                            <div class="dm-hero-score" id="dmHeroScore">0.00</div>
                        </div>
                        <div class="dm-hero-bar-wrap"><div class="dm-hero-bar" id="dmHeroBar" style="width:0%"></div></div>
                    </div>

                    <!-- Actions -->
                    <div class="dm-actions">
                        <button class="neumo-btn" id="collegeAppAddCriterionBtn" type="button"><i class="fas fa-plus"></i> Criterion</button>
                        <button class="neumo-btn" id="collegeAppAddDecisionCollegeBtn" type="button"><i class="fas fa-plus"></i> College</button>
                    </div>

                    <!-- Two-panel layout -->
                    <div class="dm-layout">
                        <!-- Criteria Panel -->
                        <div class="dm-panel dm-criteria-panel">
                            <div class="dm-panel-head">
                                <h4><i class="fas fa-sliders-h"></i> Criteria &amp; Weights</h4>
                                <button class="dm-criteria-toggle-btn" id="dmCriteriaToggle" type="button"><i class="fas fa-chevron-down"></i></button>
                            </div>
                            <div class="dm-criteria-list" id="collegeAppDecisionCriteriaBody"></div>
                        </div>

                        <!-- Score Cards -->
                        <div class="dm-panel dm-scores-panel">
                            <div class="dm-panel-head">
                                <h4><i class="fas fa-th"></i> Score Matrix</h4>
                            </div>
                            <div class="dm-college-cards" id="collegeAppDecisionCollegesBody"></div>
                            <!-- Hidden elements kept for backward compatibility -->
                            <table class="dm-scores-table" style="display:none;">
                                <thead><tr id="collegeAppDecisionCollegesHeader"></tr></thead>
                            </table>
                        </div>
                    </div>

                    <!-- Ranking Podium -->
                    <div class="dm-ranking-section">
                        <div class="dm-panel-head">
                            <h4><i class="fas fa-trophy"></i> Final Rankings</h4>
                        </div>
                        <div id="collegeAppDecisionRankingList" class="dm-ranking-grid"></div>
                    </div>
                </div>

            </section>

            <section id="view-life" class="view view-life">

                <!-- ===== DASHBOARD (main landing) ===== -->
                <div id="lifeDashboard" class="life-dashboard">
                    <div class="view-header">
                        <div>
                            <div class="eyebrow">Life</div>
                            <h2>Goals, Habits, and Personal Growth</h2>
                        </div>
                        <div class="life-header-actions">
                            <button class="neumo-btn" id="lifeQuickAddGoalBtn" type="button"><i class="fas fa-plus"></i> Goal</button>
                            <button class="neumo-btn" id="lifeQuickAddHabitBtn" type="button"><i class="fas fa-plus"></i> Habit</button>
                            <button class="neumo-btn" id="lifeQuickJournalTopBtn" type="button"><i class="fas fa-book"></i> Quick Journal</button>
                        </div>
                    </div>

                    <!-- Summary cards -->
                    <div class="life-summary-grid summary-grid">
                        <div class="glass-card summary-card">
                            <div class="summary-label">Habit Consistency</div>
                            <div class="summary-value" id="lifeHabitConsistencyValue">0%</div>
                            <div class="summary-meta">Completed checks in last 7 days</div>
                        </div>
                        <div class="glass-card summary-card">
                            <div class="summary-label">SMART Goal Progress</div>
                            <div class="summary-value" id="lifeGoalsProgressValue">0%</div>
                            <div class="summary-meta">Average progress across goals</div>
                        </div>
                        <div class="glass-card summary-card">
                            <div class="summary-label">Monthly Spend</div>
                            <div class="summary-value" id="lifeMonthlySpendValue">$0.00</div>
                            <div class="summary-meta">Current month total</div>
                        </div>
                    </div>

                    <!-- Navigation grid buttons -->
                    <div class="life-nav-grid">
                        <button class="life-nav-btn" data-life-page="goals">
                            <i class="fas fa-bullseye"></i>
                            <span>SMART Goals Tracker</span>
                        </button>
                        <button class="life-nav-btn" data-life-page="habits">
                            <i class="fas fa-check-double"></i>
                            <span>Habit Tracker</span>
                        </button>
                        <button class="life-nav-btn" data-life-page="skills">
                            <i class="fas fa-brain"></i>
                            <span>Skills Tracker</span>
                        </button>
                        <button class="life-nav-btn" data-life-page="fitness">
                            <i class="fas fa-dumbbell"></i>
                            <span>Fitness Tracker</span>
                        </button>
                        <button class="life-nav-btn" data-life-page="books">
                            <i class="fas fa-book-open"></i>
                            <span>Book Tracker</span>
                        </button>
                        <button class="life-nav-btn" data-life-page="spending">
                            <i class="fas fa-wallet"></i>
                            <span>Spending Tracker</span>
                        </button>
                        <button class="life-nav-btn" data-life-page="journal">
                            <i class="fas fa-journal-whills"></i>
                            <span>Daily Journal</span>
                        </button>
                    </div>
                </div>

                <!-- ===== SUB-PAGES (hidden by default) ===== -->

                <!-- SMART Goals page -->
                <div id="lifePage-goals" class="life-subpage" style="display:none;">
                    <button class="life-back-btn" data-life-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>SMART Goals Tracker</h3>
                            <button class="neumo-btn" id="lifeAddGoalBtn" type="button">+ Add Goal</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>Goal</th>
                                        <th>Specific</th>
                                        <th>Measurable</th>
                                        <th>Achievable</th>
                                        <th>Relevant</th>
                                        <th>Time-bound</th>
                                        <th>Target Date</th>
                                        <th>Progress %</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="lifeGoalsTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Habit Tracker page -->
                <div id="lifePage-habits" class="life-subpage" style="display:none;">
                    <button class="life-back-btn" data-life-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>Habit Tracker</h3>
                            <button class="neumo-btn" id="lifeAddHabitBtn" type="button">+ Add Habit</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>Habit</th>
                                        <th>Category</th>
                                        <th>Target / Week</th>
                                        <th>Done Today</th>
                                        <th>Current Streak</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="lifeHabitsTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Skills Tracker page -->
                <div id="lifePage-skills" class="life-subpage" style="display:none;">
                    <button class="life-back-btn" data-life-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>Skills Tracker</h3>
                            <button class="neumo-btn" id="lifeAddSkillBtn" type="button">+ Add Skill</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>Skill</th>
                                        <th>Level</th>
                                        <th>Hours</th>
                                        <th>Next Milestone</th>
                                        <th>Status</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="lifeSkillsTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Fitness Tracker page -->
                <div id="lifePage-fitness" class="life-subpage" style="display:none;">
                    <button class="life-back-btn" data-life-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>Fitness Tracker</h3>
                            <button class="neumo-btn" id="lifeAddFitnessBtn" type="button">+ Add Fitness Entry</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Activity</th>
                                        <th>Duration (min)</th>
                                        <th>Intensity</th>
                                        <th>Notes</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="lifeFitnessTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Book Tracker page -->
                <div id="lifePage-books" class="life-subpage" style="display:none;">
                    <button class="life-back-btn" data-life-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>Book Tracker</h3>
                            <button class="neumo-btn" id="lifeAddBookBtn" type="button">+ Add Book</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Author</th>
                                        <th>Status</th>
                                        <th>Pages Read</th>
                                        <th>Total Pages</th>
                                        <th>Rating</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="lifeBooksTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Spending Tracker page -->
                <div id="lifePage-spending" class="life-subpage" style="display:none;">
                    <button class="life-back-btn" data-life-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>

                    <!-- Spending summary stats row -->
                    <div class="spending-stats-row">
                        <div class="spending-stat-card">
                            <div class="spending-stat-label">This Month</div>
                            <div class="spending-stat-value" id="spendingStatMonth">$0.00</div>
                        </div>
                        <div class="spending-stat-card">
                            <div class="spending-stat-label">Transactions</div>
                            <div class="spending-stat-value" id="spendingStatCount">0</div>
                        </div>
                        <div class="spending-stat-card">
                            <div class="spending-stat-label">Avg / Transaction</div>
                            <div class="spending-stat-value" id="spendingStatAvg">$0.00</div>
                        </div>
                        <div class="spending-stat-card">
                            <div class="spending-stat-label">Top Category</div>
                            <div class="spending-stat-value spending-stat-value-sm" id="spendingStatTopCat">&mdash;</div>
                        </div>
                    </div>

                    <!-- Category breakdown -->
                    <div class="glass-card academic-module-card spending-breakdown-card">
                        <div class="academic-module-head">
                            <h3>Category Breakdown <span class="spending-breakdown-period" id="spendingBreakdownPeriod"></span></h3>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table spending-breakdown-table">
                                <thead>
                                    <tr>
                                        <th>Category</th>
                                        <th class="spending-col-right">Amount</th>
                                        <th class="spending-col-right">% of Total</th>
                                        <th>Distribution</th>
                                    </tr>
                                </thead>
                                <tbody id="spendingBreakdownBody"></tbody>
                                <tfoot id="spendingBreakdownFoot"></tfoot>
                            </table>
                        </div>
                    </div>

                    <!-- Transaction ledger -->
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>Transaction Ledger</h3>
                            <button class="neumo-btn" id="lifeAddSpendingBtn" type="button">+ Add Entry</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table spending-ledger-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Category</th>
                                        <th class="spending-col-right">Amount</th>
                                        <th>Note</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="lifeSpendingTableBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Legacy summary container (kept for renderLifeSpendingSummary compat) -->
                    <div id="lifeSpendingSummary" style="display:none;"></div>
                </div>

                <!-- Daily Journal page -->
                <div id="lifePage-journal" class="life-subpage" style="display:none;">
                    <button class="life-back-btn" data-life-back><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                    <div class="glass-card academic-module-card">
                        <div class="academic-module-head">
                            <h3>Daily Journal</h3>
                            <button class="neumo-btn" id="lifeQuickJournalBtn" type="button">Quick Create Today</button>
                        </div>
                        <div class="college-table-wrap">
                            <table class="college-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Title</th>
                                        <th>Mood</th>
                                        <th>Entry</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="lifeJournalTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </section>

            <section id="view-settings" class="view view-settings">
                <div class="view-header">
                    <div>
                        <div class="eyebrow">Settings</div>
                        <h2>Appearance and data controls</h2>
                    </div>
                </div>
                <div class="settings-grid">
                    <div class="settings-main-stack settings-main-stack-top">
                        <div class="glass-card settings-card">
                            <h3>Appearance</h3>
                            <div class="settings-row">
                                <span>Theme</span>
                                <div class="settings-actions">
                                    <button class="neumo-btn" data-theme="light">Light</button>
                                    <button class="neumo-btn" data-theme="dark">Dark</button>
                                </div>
                            </div>
                            <div class="settings-row">
                                <label class="settings-toggle">
                                    <input type="checkbox" id="motionToggle">
                                    <span>Reduce motion</span>
                                </label>
                            </div>
                            <div class="settings-row">
                                <label class="settings-toggle">
                                    <input type="checkbox" id="quickAppsToggle">
                                    <span>Enable Spotify/ChatGPT popup buttons</span>
                                </label>
                            </div>
                            <div class="settings-row">
                                <span>Task ordering</span>
                                <select class="modal-input" id="taskOrderStrategySelect" style="max-width:220px; margin:0;">
                                    <option value="urgent_first">Urgency first</option>
                                    <option value="easy_first">Easy-first momentum</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="settings-feature-rail">
                        <div class="glass-card settings-card">
                            <h3>Feature Tabs</h3>
                            <p class="settings-help">Choose which workspace tabs are visible. Settings always stays available.</p>
                            <div class="feature-toggle-list" id="featureToggleListSettings">
                                <label class="feature-toggle-item feature-toggle-card" data-feature-card="today">
                                    <input type="checkbox" class="feature-toggle-input" data-feature-view="today" aria-label="Show Today tab">
                                    <span class="feature-toggle-icon"><i class="fas fa-sun" aria-hidden="true"></i></span>
                                    <span class="feature-toggle-copy">
                                        <span class="feature-toggle-title">Today</span>
                                        <span class="feature-toggle-description">Daily tasks, streaks, and quick focus view.</span>
                                    </span>
                                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                                </label>
                                <label class="feature-toggle-item feature-toggle-card" data-feature-card="timeline">
                                    <input type="checkbox" class="feature-toggle-input" data-feature-view="timeline" aria-label="Show Timeline tab">
                                    <span class="feature-toggle-icon"><i class="fas fa-calendar-days" aria-hidden="true"></i></span>
                                    <span class="feature-toggle-copy">
                                        <span class="feature-toggle-title">Timeline / Calendar</span>
                                        <span class="feature-toggle-description">Plan blocks, track events, and review by date.</span>
                                    </span>
                                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                                </label>
                                <label class="feature-toggle-item feature-toggle-card" data-feature-card="notes">
                                    <input type="checkbox" class="feature-toggle-input" data-feature-view="notes" aria-label="Show Notes tab">
                                    <span class="feature-toggle-icon"><i class="fas fa-note-sticky" aria-hidden="true"></i></span>
                                    <span class="feature-toggle-copy">
                                        <span class="feature-toggle-title">Notes</span>
                                        <span class="feature-toggle-description">Rich editor, pages, and workspace docs.</span>
                                    </span>
                                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                                </label>
                                <label class="feature-toggle-item feature-toggle-card" data-feature-card="collegeapp">
                                    <input type="checkbox" class="feature-toggle-input" data-feature-view="collegeapp" aria-label="Show College App tab">
                                    <span class="feature-toggle-icon"><i class="fas fa-university" aria-hidden="true"></i></span>
                                    <span class="feature-toggle-copy">
                                        <span class="feature-toggle-title">College</span>
                                        <span class="feature-toggle-description">Application tracker, essays, scores, scholarships, decision matrix, and research sheets.</span>
                                    </span>
                                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                                </label>
                                <label class="feature-toggle-item feature-toggle-card" data-feature-card="life">
                                    <input type="checkbox" class="feature-toggle-input" data-feature-view="life" aria-label="Show Life tab">
                                    <span class="feature-toggle-icon"><i class="fas fa-seedling" aria-hidden="true"></i></span>
                                    <span class="feature-toggle-copy">
                                        <span class="feature-toggle-title">Life</span>
                                        <span class="feature-toggle-description">SMART goals, habits, skills, spending, books, fitness, and journal.</span>
                                    </span>
                                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                                </label>

                                <label class="feature-toggle-item feature-toggle-card" data-feature-card="homework">
                                    <input type="checkbox" class="feature-toggle-input" data-feature-view="homework" aria-label="Show Homework tab">
                                    <span class="feature-toggle-icon"><i class="fas fa-book-open" aria-hidden="true"></i></span>
                                    <span class="feature-toggle-copy">
                                        <span class="feature-toggle-title">Homework</span>
                                        <span class="feature-toggle-description">Classes, assignments, and school planning board.</span>
                                    </span>
                                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-main-stack settings-main-stack-bottom">
                        <div class="glass-card settings-card">
                            <h3>Workspace Data</h3>
                            <div class="settings-row">
                                <button class="neumo-btn" id="exportWorkspaceBtn" onclick="exportToFile()">Export Workspace</button>
                                <button class="neumo-btn" id="importWorkspaceBtn" onclick="importFromFile()">Import Workspace / Docs</button>
                            </div>
                            <p class="settings-help">Exports include notes, tasks, streaks, and settings.</p>
                        </div>
                        <div class="glass-card settings-card">
                            <h3>Calendar Sync</h3>
                            <div class="settings-row">
                                <button class="neumo-btn" id="exportCalendarIcsBtn" onclick="exportCalendarIcs()">Export Calendar (.ics)</button>
                                <button class="neumo-btn" id="importCalendarIcsBtn" onclick="triggerCalendarIcsImport()">Import Calendar (.ics)</button>
                                <button class="neumo-btn" id="clearCalendarImportsBtn" onclick="clearCalendarImports()">Clear Imported Calendar Data</button>
                            </div>
                            <div class="settings-row settings-row-calendar-sync">
                                <input type="text" class="modal-input" id="googleCalendarIdInput" placeholder="Calendar ID (default: primary)" onchange="saveGoogleCalendarControlSettings()" />
                                <select class="modal-input" id="googleCalendarIntervalSelect" onchange="saveGoogleCalendarControlSettings()">
                                    <option value="1">Auto-sync every 1 minute</option>
                                    <option value="5">Auto-sync every 5 minutes</option>
                                    <option value="10">Auto-sync every 10 minutes</option>
                                    <option value="15">Auto-sync every 15 minutes</option>
                                    <option value="30">Auto-sync every 30 minutes</option>
                                    <option value="60">Auto-sync every 60 minutes</option>
                                </select>
                                <label class="settings-toggle">
                                    <input type="checkbox" id="googleCalendarAutoSyncToggle" onchange="onGoogleCalendarAutoSyncToggle()">
                                    <span>Auto-sync</span>
                                </label>
                            </div>
                            <div class="settings-row">
                                <button class="neumo-btn" id="googleCalendarConnectBtn" onclick="connectGoogleCalendar()">Link Google Calendar</button>
                                <button class="neumo-btn" id="googleCalendarSyncNowBtn" onclick="syncGoogleCalendarNow(true)">Sync Now</button>
                                <button class="neumo-btn" id="googleCalendarDisconnectBtn" onclick="disconnectGoogleCalendar()">Unlink</button>
                            </div>
                            <p class="settings-help" id="googleCalendarSyncStatus">Not linked. Add Google credentials in Drive Settings, then link your calendar.</p>
                            <p class="settings-help">Import events into Timeline blocks and export tasks/timeline as an ICS calendar file. Google Calendar sync is read-only.</p>
                        </div>
                        <div class="glass-card settings-card">
                            <h3>Guided Tutorial</h3>
                            <p class="settings-help" id="tutorialStatusText">Take a full product walkthrough covering navigation, pages &amp; templates, task system, timeline scheduling, College App dashboard &amp; sub-pages, Life dashboard (Goals, Habits, Skills, Fitness, Books, Spending, Journal), add-item modal, college tracker sheets, notes editor &amp; embeds, theming (dark/light), timer audio controls, calendar sync, homework, backup/import/export, quick app launchers, and Flow Assistant.</p>
                            <div class="settings-row">
                                <button class="neumo-btn" id="startTutorialBtn">Start Interactive Tutorial</button>
                            </div>
                            <p class="settings-help">You can rerun this any time after finishing.</p>
                        </div>
                        <div class="glass-card settings-card">
                            <h3>Backup</h3>
                            <p class="settings-help">Use your own Google Drive for optional backups.</p>
                            <button class="neumo-btn" id="driveSettingsBtn" onclick="openDriveSettings()">Google Drive Settings</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Homework view (embedded into main-content) -->
            <section id="view-homework" class="view view-homework" style="display:none;">
                <!-- Setup popup (shown when no courses exist) -->
                <div id="hwSetupOverlay" class="hw-setup-overlay" style="display:none;">
                    <div class="hw-setup-card">
                        <h2>Set Up Your Classes</h2>
                        <p>Add your classes below. Press Enter or comma after each name. You can always add more later.</p>
                        <label>Classes</label>
                        <div class="hw-chip-input" id="hwClassChips">
                            <input id="hwClassInput" placeholder="Type a class and press Enter" />
                        </div>
                        <label>Extracurriculars / Misc</label>
                        <div class="hw-chip-input" id="hwMiscChips">
                            <input id="hwMiscInput" placeholder="Clubs, activities, misc…" />
                        </div>
                        <div class="hw-setup-actions">
                            <button id="hwSetupSkip" class="hw-btn">Cancel for now</button>
                            <button id="hwSetupDone" class="hw-btn hw-btn-accent">Get Started -></button>
                        </div>
                    </div>
                </div>

                <!-- Main homework table -->
                <div id="hwMainArea" style="padding:16px;">
                    <div class="hw-header-bar">
                        <div>
                            <div class="eyebrow">Homework</div>
                            <h2>Homework Organizer</h2>
                        </div>
                        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
                            <button id="hwAddClassBtn" class="hw-btn">+ Add Class</button>
                            <button id="hwAddMiscBtn" class="hw-btn">+ Add Misc</button>
                            <button id="hwExportBtn" class="hw-btn">Export</button>
                            <label class="hw-btn" style="cursor:pointer;">Import <input id="hwImportFile" type="file" accept="application/json" style="display:none"></label>
                            <button id="hwResetBtn" class="hw-btn" title="Re-run setup"><i class="fas fa-rotate-right" aria-hidden="true"></i>Setup</button>
                        </div>
                    </div>
                    <div class="hw-table-wrap">
                        <table class="hw-data-table" id="hwDataTable">
                            <thead>
                                <tr>
                                    <th>Class</th>
                                    <th>Assignments / Tasks</th>
                                    <th>Activity</th>
                                    <th>Notes / Tasks</th>
                                </tr>
                            </thead>
                            <tbody id="hwTableBody"></tbody>
                        </table>
                    </div>
                </div>
                <script src="homework.js"></script>
            </section>

        </div>
    </div>

    <div id="featureSetupOverlay" class="feature-setup-overlay" aria-hidden="true">
        <div class="feature-setup-backdrop"></div>
        <div class="feature-setup-card glass-card" role="dialog" aria-modal="true" aria-labelledby="featureSetupTitle">
            <h2 id="featureSetupTitle">Choose your starting tabs</h2>
            <p>Select the features you want to use right now. You can change this any time in Settings.</p>
            <div class="feature-toggle-list feature-toggle-list-onboarding" id="featureToggleListOnboarding">
                <label class="feature-toggle-item feature-toggle-card" data-feature-card="today">
                    <input type="checkbox" class="feature-toggle-input" data-feature-view="today" aria-label="Enable Today tab for startup">
                    <span class="feature-toggle-icon"><i class="fas fa-sun" aria-hidden="true"></i></span>
                    <span class="feature-toggle-copy">
                        <span class="feature-toggle-title">Today</span>
                        <span class="feature-toggle-description">Daily tasks, streaks, and quick focus view.</span>
                    </span>
                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                </label>
                <label class="feature-toggle-item feature-toggle-card" data-feature-card="timeline">
                    <input type="checkbox" class="feature-toggle-input" data-feature-view="timeline" aria-label="Enable Timeline tab for startup">
                    <span class="feature-toggle-icon"><i class="fas fa-calendar-days" aria-hidden="true"></i></span>
                    <span class="feature-toggle-copy">
                        <span class="feature-toggle-title">Timeline / Calendar</span>
                        <span class="feature-toggle-description">Plan blocks, track events, and review by date.</span>
                    </span>
                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                </label>
                <label class="feature-toggle-item feature-toggle-card" data-feature-card="notes">
                    <input type="checkbox" class="feature-toggle-input" data-feature-view="notes" aria-label="Enable Notes tab for startup">
                    <span class="feature-toggle-icon"><i class="fas fa-note-sticky" aria-hidden="true"></i></span>
                    <span class="feature-toggle-copy">
                        <span class="feature-toggle-title">Notes</span>
                        <span class="feature-toggle-description">Rich editor, pages, and workspace docs.</span>
                    </span>
                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                </label>
                <label class="feature-toggle-item feature-toggle-card" data-feature-card="collegeapp">
                    <input type="checkbox" class="feature-toggle-input" data-feature-view="collegeapp" aria-label="Enable College App tab for startup">
                    <span class="feature-toggle-icon"><i class="fas fa-university" aria-hidden="true"></i></span>
                    <span class="feature-toggle-copy">
                        <span class="feature-toggle-title">College App</span>
                        <span class="feature-toggle-description">College tracker, essays, scores, scholarships, and decision matrix.</span>
                    </span>
                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                </label>
                <label class="feature-toggle-item feature-toggle-card" data-feature-card="life">
                    <input type="checkbox" class="feature-toggle-input" data-feature-view="life" aria-label="Enable Life tab for startup">
                    <span class="feature-toggle-icon"><i class="fas fa-seedling" aria-hidden="true"></i></span>
                    <span class="feature-toggle-copy">
                        <span class="feature-toggle-title">Life</span>
                        <span class="feature-toggle-description">SMART goals, habits, skills, spending, books, fitness, and journal.</span>
                    </span>
                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                </label>
                <label class="feature-toggle-item feature-toggle-card" data-feature-card="homework">
                    <input type="checkbox" class="feature-toggle-input" data-feature-view="homework" aria-label="Enable Homework tab for startup">
                    <span class="feature-toggle-icon"><i class="fas fa-book-open" aria-hidden="true"></i></span>
                    <span class="feature-toggle-copy">
                        <span class="feature-toggle-title">Homework</span>
                        <span class="feature-toggle-description">Classes, assignments, and school planning board.</span>
                    </span>
                    <span class="feature-toggle-switch" aria-hidden="true"><span class="feature-toggle-switch-handle"></span></span>
                </label>
            </div>
            <p class="feature-setup-note">Settings is always available.</p>
            <div class="feature-setup-actions">
                <button class="neumo-btn" id="featureSetupContinueBtn" type="button">Continue</button>
            </div>
        </div>
    </div>

    <div id="tutorialOverlay" class="tutorial-overlay" aria-hidden="true">
        <div class="tutorial-backdrop"></div>
        <div id="tutorialSpotlight" class="tutorial-spotlight" aria-hidden="true"></div>
        <div id="tutorialCard" class="tutorial-card" role="dialog" aria-modal="true" aria-live="polite">
            <div class="tutorial-step" id="tutorialStepCounter">Step 1 of 1</div>
            <h3 id="tutorialTitle">Welcome</h3>
            <p id="tutorialBody">This walkthrough highlights the full Atelier feature set.</p>
            <div class="tutorial-actions">
                <button class="neumo-btn" id="tutorialPrevBtn" type="button">Back</button>
                <button class="neumo-btn" id="tutorialActionBtn" type="button">Run Action</button>
                <button class="neumo-btn" id="tutorialSkipBtn" type="button">Skip</button>
                <button class="neumo-btn" id="tutorialNextBtn" type="button">Next</button>
            </div>
        </div>
    </div>

    <!-- Theme Switcher Button -->
    <button class="theme-switcher-btn" onclick="toggleThemePanel()">
        <i class="fas fa-palette"></i>
    </button>

    <!-- Theme Panel -->
    <div class="theme-panel" id="themePanel">
        <div class="theme-panel-header">
            <h3 class="theme-panel-title">🎨 Theme Settings</h3>
            
            <div class="apply-mode-toggle">
                <button class="mode-btn active" onclick="setApplyMode('current', event)">
                    Current Page Only
                </button>
                <button class="mode-btn" onclick="setApplyMode('all', event)">
                    All Pages
                </button>
                <button class="mode-btn" onclick="setApplyMode('custom', event)">
                    Select Pages
                </button>
            </div>

            <div class="page-selector" id="pageSelector">
                <div class="page-selector-title">Select pages to apply theme:</div>
                <div id="pageSelectorList"></div>
            </div>
        </div>

        <div class="theme-presets">
            <div class="preset-title">Preset Themes</div>
            <div class="preset-grid">
                <div class="preset-card active" onclick="applyPresetTheme('default')" data-theme="default">
                    <div class="preset-preview">
                        <div class="preset-color" style="background: #ffffff"></div>
                        <div class="preset-color" style="background: #f5f7fa"></div>
                        <div class="preset-color" style="background: #b8860b"></div>
                    </div>
                    <div class="preset-name">Light</div>
                </div>

                <div class="preset-card" onclick="applyPresetTheme('dark')" data-theme="dark">
                    <div class="preset-preview">
                        <div class="preset-color" style="background: #0f0e0c"></div>
                        <div class="preset-color" style="background: #171513"></div>
                        <div class="preset-color" style="background: #d2a74d"></div>
                    </div>
                    <div class="preset-name">Dark</div>
                </div>
            </div>
        </div>

        <div class="custom-colors">
            <div class="preset-title">Custom Colors</div>
            <div class="color-input-group">
                <div class="color-input-item">
                    <label>Background</label>
                    <input type="color" id="customBgPrimary" onchange="applyCustomColors()">
                </div>
                <div class="color-input-item">
                    <label>Secondary</label>
                    <input type="color" id="customBgSecondary" onchange="applyCustomColors()">
                </div>
                <div class="color-input-item">
                    <label>Text</label>
                    <input type="color" id="customTextPrimary" onchange="applyCustomColors()">
                </div>
                <div class="color-input-item">
                    <label>Accent</label>
                    <input type="color" id="customAccent" onchange="applyCustomColors()">
                </div>
            </div>
        </div>

        <div class="font-settings">
            <div class="preset-title">Font Settings</div>
            <div class="font-input-group">
                <div class="font-input-item">
                    <label>Editor Font</label>
                    <select id="fontFamilySelect" onchange="applyFontSettings()">
                        <option value="'Source Sans 3', sans-serif" selected>Source Sans 3 (Default)</option>
                        <option value="'Inter', sans-serif">Inter</option>
                        <option value="'Comfortaa', cursive">Comfortaa</option>
                        <option value="'Roboto', sans-serif">Roboto</option>
                        <option value="'Fira Sans', sans-serif">Fira Sans</option>
                        <option value="'Montserrat', sans-serif">Montserrat</option>
                        <option value="'Source Sans Pro', sans-serif">Source Sans Pro</option>
                        <option value="'Open Sans', sans-serif">Open Sans</option>
                        <option value="'IBM Plex Mono', monospace">IBM Plex Mono</option>
                        <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
                        <option value="'Georgia', serif">Georgia</option>
                        <option value="'Times New Roman', serif">Times New Roman</option>
                        <option value="'Arial', sans-serif">Arial</option>
                        <option value="'Helvetica', sans-serif">Helvetica</option>
                        <option value="'Courier New', monospace">Courier New</option>
                        <option value="'Verdana', sans-serif">Verdana</option>
                        <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                        <option value="'Palatino', 'Palatino Linotype', serif">Palatino</option>
                        <option value="-apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', sans-serif">SF Pro (Mac)</option>
                        <option value="'Playfair Display', serif">Playfair Display</option>
                    </select>
                </div>
                <div class="font-input-item">
                    <label>Font Size</label>
                    <select id="fontSizeSelect" onchange="applyFontSettings()">
                        <option value="14px">Small (14px)</option>
                        <option value="16px" selected>Normal (16px)</option>
                        <option value="18px">Large (18px)</option>
                        <option value="20px">X-Large (20px)</option>
                        <option value="22px">XX-Large (22px)</option>
                    </select>
                </div>
                <div class="font-input-item">
                    <label>Line Height</label>
                    <select id="lineHeightSelect" onchange="applyFontSettings()">
                        <option value="1.4">Compact (1.4)</option>
                        <option value="1.6" selected>Normal (1.6)</option>
                        <option value="1.8">Relaxed (1.8)</option>
                        <option value="2.0">Spacious (2.0)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="animation-settings">
            <div class="preset-title">Animations</div>
            <div class="animation-toggle">
                <label class="toggle-switch">
                    <input type="checkbox" id="animationsToggle" checked onchange="toggleAnimations()">
                    <span class="toggle-slider"></span>
                </label>
                <span>Enable Animations</span>
            </div>
        </div>

        <div class="theme-actions">
            <button class="reset-theme-btn" onclick="resetTheme()">
                <i class="fas fa-undo"></i> Reset to Default
            </button>
        </div>
    </div>

    <!-- Font Settings Panel (Fixed Position) -->
    <div id="fontSettingsPanel" style="display: none; position: fixed; top: 60px; right: 20px; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; padding: 15px; min-width: 220px; box-shadow: 0 4px 20px rgba(0,0,0,0.25); z-index: 10000;">
        <div style="margin-bottom: 12px;">
            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px; color: var(--text-secondary);">
                <i class="fas fa-font" style="margin-right: 5px;"></i>Font Family
            </label>
            <select id="fontFamilySelectToolbar" onchange="applyFontSettingsFromToolbar()" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px;">
                <option value="'Source Sans 3', sans-serif">Source Sans 3 (Default)</option>
                <option value="'Inter', sans-serif">Inter</option>
                <option value="'Comfortaa', cursive">Comfortaa</option>
                <option value="'Roboto', sans-serif">Roboto</option>
                <option value="'Fira Sans', sans-serif">Fira Sans</option>
                <option value="'Montserrat', sans-serif">Montserrat</option>
                <option value="'Source Sans Pro', sans-serif">Source Sans Pro</option>
                <option value="'Open Sans', sans-serif">Open Sans</option>
                <option value="'IBM Plex Mono', monospace">IBM Plex Mono</option>
                <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
                <option value="'Georgia', serif">Georgia</option>
                <option value="'Times New Roman', serif">Times New Roman</option>
                <option value="'Arial', sans-serif">Arial</option>
                <option value="'Helvetica', sans-serif">Helvetica</option>
                <option value="'Courier New', monospace">Courier New</option>
                <option value="'Verdana', sans-serif">Verdana</option>
                <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                <option value="'Palatino', 'Palatino Linotype', serif">Palatino</option>
                <option value="-apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', sans-serif">SF Pro (Mac)</option>
                <option value="'Playfair Display', serif">Playfair Display</option>
            </select>
        </div>
        <div style="margin-bottom: 12px;">
            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px; color: var(--text-secondary);">
                <i class="fas fa-text-height" style="margin-right: 5px;"></i>Font Size
            </label>
            <select id="fontSizeSelectToolbar" onchange="applyFontSettingsFromToolbar()" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px;">
                <option value="14px">Small (14px)</option>
                <option value="16px">Normal (16px)</option>
                <option value="18px">Large (18px)</option>
                <option value="20px">X-Large (20px)</option>
                <option value="22px">XX-Large (22px)</option>
            </select>
        </div>
        <div style="margin-bottom: 12px;">
            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px; color: var(--text-secondary);">
                <i class="fas fa-arrows-alt-v" style="margin-right: 5px;"></i>Line Spacing
            </label>
            <select id="lineHeightSelectToolbar" onchange="applyFontSettingsFromToolbar()" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px;">
                <option value="1.4">Compact (1.4)</option>
                <option value="1.6">Normal (1.6)</option>
                <option value="1.8">Relaxed (1.8)</option>
                <option value="2.0">Spacious (2.0)</option>
            </select>
        </div>
        <div style="margin-bottom: 12px;">
            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px; color: var(--text-secondary);">
                <i class="fas fa-palette" style="margin-right: 5px"></i>Text Color
            </label>
            <select id="textColorSelectToolbar" onchange="applyTextColorFromToolbar()" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px;">
                <option value="default">Default</option>
                <option value="#ffffff">White</option>
                <option value="#000000">Black</option>
                <option value="#37352f">Dark</option>
                <option value="#616161">Gray</option>
                <option value="#d32f2f">Red</option>
                <option value="#f57c00">Orange</option>
                <option value="#fbc02d">Yellow</option>
                <option value="#2e7d32">Green</option>
                <option value="#1565c0">Blue</option>
                <option value="#6a1b9a">Purple</option>
                <option value="#c2185b">Pink</option>
            </select>
        </div>
        <div style="margin-bottom: 12px;">
            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px; color: var(--text-secondary);">
                <i class="fas fa-highlighter" style="margin-right: 5px"></i>Highlight
            </label>
            <select id="textHighlightSelectToolbar" onchange="applyHighlightFromToolbar()" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px;">
                <option value="none">None</option>
                <option value="#fff59d">Yellow</option>
                <option value="#a5d6a7">Green</option>
                <option value="#90caf9">Blue</option>
                <option value="#f8bbd0">Pink</option>
                <option value="#ffe0b2">Orange</option>
            </select>
        </div>
        <div style="display: flex; align-items: center; justify-content: space-between; padding-top: 8px; border-top: 1px solid var(--border);">
            <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary); display: flex; align-items: center; gap: 5px;">
                <i class="fas fa-magic"></i>Animations
            </label>
            <label class="toggle-switch">
                <input type="checkbox" id="animationsToggleToolbar" checked onchange="toggleAnimationsFromToolbar()">
                <span class="toggle-slider"></span>
            </label>
        </div>
    </div>

    <!-- Toggle Sidebar Button -->
    <button class="toggle-sidebar" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Bottom storage/taskbar -->
    <div class="storage-options" id="storageOptions">
        <div class="taskbar-save-status saved" id="taskbarSaveStatus">
            <i class="fas fa-check-circle"></i>
            <span>Saved</span>
        </div>
        <div class="taskbar-divider"></div>
        <button class="storage-btn primary" id="saveLocalBtn" onclick="saveToLocal()" title="Save to browser storage">
            <i class="fas fa-save"></i>
            <span class="btn-text">Save Locally</span>
        </button>
        <button class="storage-btn" id="exportFileBtn" onclick="exportToFile()" title="Export as JSON file">
            <i class="fas fa-upload"></i>
            <span class="btn-text">Export</span>
        </button>
        <button class="storage-btn" id="importFileBtn" onclick="importFromFile()" title="Import workspace or document file">
            <i class="fas fa-download"></i>
            <span class="btn-text">Import</span>
        </button>
        <button class="storage-btn" id="saveDriveBtn" onclick="saveToGoogleDrive()" title="Sync with Google Drive">
            <i class="fab fa-google-drive"></i>
            <span class="btn-text">Save to Drive</span>
        </button>
    </div>

    <!-- Modal for adding items (College App + Life) -->
    <div class="modal" id="addItemModal">
        <div class="modal-content add-item-modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="addItemModalTitle">Add Item</h3>
            </div>
            <div class="modal-body" id="addItemModalBody">
                <!-- Fields are dynamically injected -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="addItemModalCancel" type="button">Cancel</button>
                <button class="btn btn-primary" id="addItemModalSave" type="button"><i class="fas fa-plus"></i> Add</button>
            </div>
        </div>
    </div>

    <!-- Modal for new page -->
    <div class="modal" id="newPageModal">
        <div class="modal-content new-page-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Page</h3>
            </div>
            <div class="modal-body">
                <input type="text" class="modal-input" id="newPageName" placeholder="Enter page name (use :: for hierarchy)..." />
                <div style="margin-top: 15px;">
                    <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 8px; color: var(--text-secondary);">
                        <i class="fas fa-file-alt" style="margin-right: 5px;"></i>Start from Template (optional)
                    </label>
                    <select id="newPageTemplate" class="modal-input" style="cursor: pointer;">
                        <option value="blank">Blank Page</option>
                        <option value="meeting">Meeting Notes</option>
                        <option value="project">Project Plan</option>
                        <option value="todo">To-Do List</option>
                        <option value="journal">Daily Journal</option>
                        <option value="weekly">Weekly Review</option>
                        <option value="notes">Study Notes</option>
                        <option value="sprint">Sprint Planner</option>
                        <option value="client">Client Brief</option>
                        <option value="decision">Decision Log</option>
                    </select>
                </div>
                <div class="template-preview-panel" id="templatePreviewPanel" aria-live="polite">
                    <div class="template-preview-head">
                        <div class="template-preview-title-wrap">
                            <span class="template-preview-icon" id="templatePreviewIcon">&#128196;</span>
                            <div>
                                <div class="template-preview-title" id="templatePreviewName">Blank Page</div>
                                <p class="template-preview-description" id="templatePreviewDescription">Start from an empty page.</p>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary template-suggest-btn" id="templateUseNameBtn" onclick="applyTemplateSuggestedName()">Use Suggested Title</button>
                    </div>
                    <div class="template-preview-section">
                        <span class="template-preview-label">Includes</span>
                        <div class="template-preview-tags" id="templatePreviewSections">
                            <span class="template-preview-tag">No starter blocks</span>
                        </div>
                    </div>
                    <div class="template-preview-task-row" id="templateTaskOptions">
                        <div class="template-task-toggle-copy">
                            <span class="template-preview-label">Create starter tasks</span>
                            <span class="template-task-summary" id="templateTaskSummary">No linked tasks for this template.</span>
                        </div>
                        <label class="toggle-switch" title="Create linked tasks in Today view">
                            <input type="checkbox" id="newPageCreateTasks">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('newPageModal')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmNewPage()">Create</button>
            </div>
        </div>
    </div>

    <!-- Modal for renaming page -->
    <div class="modal" id="renamePageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Rename Page</h3>
            </div>
            <div class="modal-body">
                <input type="text" class="modal-input" id="renamePageName" placeholder="Enter new page name..." />
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('renamePageModal')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmRename()">Save</button>
            </div>
        </div>
    </div>

    <!-- Modal for Google Drive Settings -->
    <div class="modal" id="driveSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Google Drive Settings</h3>
            </div>
            <div class="modal-body">
                <div class="info-box" style="background: var(--bg-secondary); padding: 12px; border-radius: 6px; margin-bottom: 15px; font-size: 13px; color: var(--text-secondary); border: 1px solid var(--border);">
                    <div style="display: flex; gap: 8px; margin-bottom: 8px; color: var(--text-primary); font-weight: 500; align-items: center;">
                        <i class="fas fa-info-circle" style="color: var(--accent);"></i>
                        <span>Why do I need this?</span>
                    </div>
                    <p style="line-height: 1.4;">NoteFlow is a privacy-first, local-only app. We don't have servers to store your data. To sync across devices, you use your own Google Drive, ensuring you maintain 100% ownership and control of your data.</p>
                </div>

                <p style="margin-bottom: 15px; font-size: 14px; color: var(--text-secondary);">
                    Enter your Google Cloud credentials to enable Drive backup.
                </p>
                <div style="margin-bottom: 10px;">
                    <label style="display:block; margin-bottom:5px; font-size:13px;">Client ID</label>
                    <input type="text" class="modal-input" id="driveClientId" placeholder="Enter Client ID" />
                </div>
                <div style="margin-bottom: 10px;">
                    <label style="display:block; margin-bottom:5px; font-size:13px;">API Key</label>
                    <input type="text" class="modal-input" id="driveApiKey" placeholder="Enter API Key" />
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('driveSettingsModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveDriveSettings()">Save & Connect</button>
            </div>
        </div>
    </div>

    <!-- Modal for Time Blocks -->
    <div class="modal" id="blockModal">
        <div class="modal-content glass-modal">
            <div class="modal-header">
                <h3 class="modal-title" id="blockModalTitle">Add Time Block</h3>
            </div>
            <div class="modal-body">
                <label style="display:block; margin-bottom:6px; font-size:13px;">Block Name</label>
                <input type="text" class="modal-input" id="blockNameInput" placeholder="e.g., Deep Work, Exercise, Lunch..." />
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top:12px;">
                    <div>
                        <label style="display:block; margin-bottom:6px; font-size:13px;">Start Time</label>
                        <input type="time" class="modal-input" id="blockStartInput" value="09:00" />
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:6px; font-size:13px;">End Time</label>
                        <input type="time" class="modal-input" id="blockEndInput" value="10:00" />
                    </div>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top:12px;">
                    <div>
                        <label style="display:block; margin-bottom:6px; font-size:13px;">Category</label>
                        <select class="modal-input" id="blockCategoryInput">
                            <option value="default">Default</option>
                            <option value="work">Work</option>
                            <option value="health">Health</option>
                            <option value="personal">Personal</option>
                            <option value="learning">Learning</option>
                            <option value="break">Break</option>
                        </select>
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:6px; font-size:13px;">Color</label>
                        <input type="color" class="modal-input" id="blockColorInput" value="#b8860b" style="height:38px; padding:4px;" />
                    </div>
                </div>
                <div style="margin-top:12px;">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">Recurrence</label>
                    <select class="modal-input" id="blockRecurrenceInput">
                        <option value="none">One-time</option>
                        <option value="daily">Daily</option>
                        <option value="weekdays">Weekdays</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
                <div style="margin-top:12px;">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">Date (for one-time blocks)</label>
                    <input type="date" class="modal-input" id="blockDateInput" />
                </div>
                <div style="margin-top:12px;">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">Reference URL (Google Doc, etc.)</label>
                    <input type="url" class="modal-input" id="blockReferenceInput" placeholder="https://docs.google.com/..." />
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="deleteBlockBtn" style="margin-right:auto; display:none;">Delete</button>
                <button class="btn btn-secondary" onclick="closeBlockModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveBlockFromModal()">Save Block</button>
            </div>
        </div>
    </div>

    <!-- Modal for Tasks -->
    <div class="modal" id="taskModal">
        <div class="modal-content glass-modal">
            <div class="modal-header">
                <h3 class="modal-title" id="taskModalTitle">Add Task</h3>
            </div>
            <div class="modal-body">
                <label style="display:block; margin-bottom:6px; font-size:13px;">Title</label>
                <input type="text" class="modal-input" id="taskTitleInput" placeholder="What do you need to do?" />
                <label style="display:block; margin:12px 0 6px; font-size:13px;">Notes</label>
                <textarea class="modal-input" id="taskNotesInput" rows="3" placeholder="Optional details..."></textarea>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top:12px;">
                    <div>
                        <label style="display:block; margin-bottom:6px; font-size:13px;">Schedule</label>
                        <select class="modal-input" id="taskScheduleInput">
                            <option value="once">One-off</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Custom days</option>
                        </select>
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:6px; font-size:13px;">Due date</label>
                        <input type="date" class="modal-input" id="taskDueDateInput" />
                    </div>
                </div>
                <div id="taskWeeklyDays" style="display:none; margin-top:12px;">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">Repeat on</label>
                    <div class="weekday-selector">
                        <label><input type="checkbox" value="1">Mon</label>
                        <label><input type="checkbox" value="2">Tue</label>
                        <label><input type="checkbox" value="3">Wed</label>
                        <label><input type="checkbox" value="4">Thu</label>
                        <label><input type="checkbox" value="5">Fri</label>
                        <label><input type="checkbox" value="6">Sat</label>
                        <label><input type="checkbox" value="0">Sun</label>
                    </div>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top:12px;">
                    <div>
                        <label style="display:block; margin-bottom:6px; font-size:13px;">Category</label>
                        <select class="modal-input" id="taskCategoryInput">
                            <option value="none">None</option>
                            <option value="work">Work</option>
                            <option value="health">Health</option>
                            <option value="personal">Personal</option>
                            <option value="learning">Learning</option>
                        </select>
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:6px; font-size:13px;">Attach to note</label>
                        <select class="modal-input" id="taskNoteInput">
                            <option value="">No note</option>
                        </select>
                    </div>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top:12px;">
                    <div>
                        <label style="display:block; margin-bottom:6px; font-size:13px;">Urgency</label>
                        <select class="modal-input" id="taskPriorityInput">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:6px; font-size:13px;">Difficulty</label>
                        <select class="modal-input" id="taskDifficultyInput">
                            <option value="easy">Easy</option>
                            <option value="medium" selected>Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                </div>
                <div style="margin-top:12px;">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">Reference URL (Google Doc, etc.)</label>
                    <input type="url" class="modal-input" id="taskReferenceInput" placeholder="https://docs.google.com/..." />
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTaskModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveTaskFromModal()">Save Task</button>
            </div>
        </div>
    </div>


    <!-- Import Dropzone Modal -->
    <div class="modal" id="importDropModal">
        <div class="modal-content glass-modal import-drop-modal">
            <div class="modal-header">
                <h3 class="modal-title">Import Workspace or Document</h3>
            </div>
            <div class="modal-body">
                <div class="import-drop-zone" id="importDropZone">
                    <i class="fas fa-file-import" aria-hidden="true"></i>
                    <div class="import-drop-title">Drag and drop your file here</div>
                    <div class="import-drop-subtitle">Supports JSON, PDF, DOCX, DOC, XLSX, PPTX, EPUB, Markdown, and more.</div>
                    <button type="button" class="btn btn-primary" id="importDropBrowseBtn">Choose File</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="importDropCloseBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" style="display: none;" accept=".json,.txt,.md,.markdown,.html,.htm,.csv,.tsv,.rtf,.pdf,.docx,.doc,.odt,.xlsx,.xls,.pptx,.epub,.xml,.yaml,.yml,.log" />
    <input type="file" id="calendarIcsInput" style="display: none;" accept=".ics,text/calendar" onchange="handleCalendarIcsSelected(event)" />

    <!-- Toast notification -->
    <div class="toast" id="toast"></div>
    <div class="timer-done-popup" id="timerDonePopup" role="alert" aria-live="assertive">
        <div class="timer-done-title">Timer Finished</div>
        <div class="timer-done-message">Focus session complete. Alarm will keep ringing until you stop it.</div>
        <button class="timer-done-btn" onclick="hideTimerDonePopup()">Stop Alarm</button>
    </div>

    <!-- Slash Commands Menu -->
    <div class="slash-menu" id="slashMenu">
        <div class="slash-menu-header">Basic Blocks</div>
        <div id="slashMenuItems"></div>
    </div>

    <!-- Emoji Picker -->
    <div class="emoji-modal-overlay" id="emojiModalOverlay" onclick="hideEmojiPicker()"></div>
    <div class="emoji-picker" id="emojiPicker" onclick="event.stopPropagation()">
        <div class="emoji-picker-header">
            <div class="emoji-header-left">
                <span class="emoji-picker-title">Choose Icon</span>
                <span class="emoji-picker-subtitle">Set a visual icon for this page</span>
            </div>
            <div class="emoji-header-actions">
                <button type="button" class="emoji-remove-btn" onclick="removePageIcon();hideEmojiPicker();">Remove</button>
                <button type="button" class="emoji-close-btn" onclick="hideEmojiPicker()" title="Close" aria-label="Close emoji picker">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="emoji-picker-grid" id="emojiGrid"></div>
    </div>

    <!-- Link Tooltip -->
    <div class="link-tooltip" id="linkTooltip">
        <a href="#" target="_blank" rel="noopener noreferrer" id="linkTooltipUrl">Open Link</a>
        <div style="width: 1px; height: 16px; background: var(--border); margin: 0 4px;"></div>
        <button onclick="editLink()" title="Edit Link" aria-label="Edit link"><i class="fas fa-pencil-alt"></i></button>
        <button onclick="removeLink()" title="Remove Link" aria-label="Remove link"><i class="fas fa-unlink"></i></button>
    </div>

    

    <!-- Small Chatbot (local-only, uses user's own provider API keys) -->
    <style>
        .chatbot-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            /* frosted circular button similar to other UI elements */
            background: var(--glass-01, rgba(255,255,255,0.08));
            -webkit-backdrop-filter: blur(12px) saturate(160%);
            backdrop-filter: blur(12px) saturate(160%);
            border: 1px solid var(--glass-border, rgba(0,0,0,0.08));
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            cursor: pointer;
            z-index: 2200;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: right 0.18s ease, left 0.18s ease, bottom 0.18s ease, transform 0.18s ease;
        }
        .chatbot-btn img { width: 48px; height: 48px; border-radius: 50%; display: block; }

        .chatbot-panel {
            position: fixed;
            bottom: 108px;
            right: 16px;
            width: min(560px, calc(100vw - 24px));
            height: min(74vh, 760px);
            max-height: calc(100dvh - 96px);
            background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.03));
            background-color: rgba(255,255,255,0.04);
            -webkit-backdrop-filter: blur(16px) saturate(145%);
            backdrop-filter: blur(16px) saturate(145%);
            border: 1px solid rgba(255,255,255,0.07);
            border-radius: 14px;
            box-shadow: 0 16px 40px rgba(0,0,0,0.32);
            z-index: 2200;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        .chatbot-header {
            display:flex; align-items:center; gap:8px; padding:10px 12px;
            background: var(--glass-02, rgba(255,255,255,0.04));
            -webkit-backdrop-filter: blur(12px) saturate(150%);
            backdrop-filter: blur(12px) saturate(150%);
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        .chatbot-header img { width:34px; height:34px; border-radius:8px; flex: 0 0 auto; }
        .chatbot-title { font-weight:700; flex:1; min-width:0; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        /* icon buttons in the header */
        .chatbot-actions { display:flex; gap:6px; align-items:center; }
        .chatbot-actions button {
            min-width:36px; height:32px; padding:0 10px; display:inline-flex; align-items:center; justify-content:center;
            background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.04); color:var(--text-secondary);
            border-radius:8px; cursor:pointer; font-weight:700; font-size:12px;
        }
        .chatbot-actions button:hover { background: rgba(255,255,255,0.05); color:var(--text-primary); }
        .chatbot-actions button:focus { outline:2px solid rgba(0,0,0,0.08); }

        /* fullscreen state */
        .chatbot-panel.fullscreen {
            top: 10px; left: 10px; right: 10px; bottom: 10px; width: auto; max-height: none; height: auto; z-index: 9999;
            border-radius: 12px; display:flex;
        }
        .chatbot-panel.fullscreen .chatbot-messages { max-height: none; }

        .chatbot-messages { flex:1; min-height:220px; padding:12px; overflow:auto; background: rgba(0,0,0,0.08); }
        .chatbot-messages:empty::before {
            content: "Start a chat with Flow. Your latest message only is sent by default.";
            display: block;
            color: var(--text-muted);
            font-size: 12px;
            line-height: 1.5;
            padding: 8px;
            border: 1px dashed rgba(255,255,255,0.14);
            border-radius: 8px;
            background: rgba(255,255,255,0.02);
        }
        .chatbot-msg { margin-bottom:10px; display:block; }
        .chatbot-msg.user { text-align:right; }
        .chatbot-msg .bubble { display:inline-block; padding:10px 12px; border-radius:10px; max-width:90%; line-height:1.45; font-size:13px; word-wrap:break-word; }
        .chatbot-msg.user .bubble { background: var(--accent); color: #fff; border-bottom-right-radius: 4px; }
        .chatbot-msg.assistant .bubble { background: rgba(255,255,255,0.08); color: var(--text-primary); border-bottom-left-radius: 4px; }

        .chatbot-input { display:grid; grid-template-columns:minmax(0,1fr) auto; gap:8px; padding:10px; border-top:1px solid rgba(255,255,255,0.06); }
        .chatbot-input textarea { min-height:46px; max-height:128px; resize:vertical; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.1); color:var(--text-primary); line-height:1.4; }
        .chatbot-input button { min-width:86px; border-radius:10px; border:none; background:var(--accent); color:#fff; cursor:pointer; font-weight:700; padding:0 14px; }

        .chat-settings-shell {
            margin: 0 10px 10px;
            border: 1px dashed rgba(255,255,255,0.12);
            border-radius: 10px;
            background: rgba(255,255,255,0.02);
            overflow: visible;
        }
        .chat-settings-shell summary {
            list-style: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            padding: 9px 10px;
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 700;
            letter-spacing: 0.02em;
        }
        .chat-settings-shell summary::-webkit-details-marker { display: none; }
        .chat-settings-shell[open] summary { border-bottom: 1px dashed rgba(255,255,255,0.1); }
        .chat-settings-hint { font-size: 11px; color: var(--text-muted); font-weight: 600; }

        .chatbot-settings {
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: stretch;
        }
        .chat-settings-shell[open] .chatbot-settings {
            max-height: 40vh;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .chat-settings-row {
            display: grid;
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) auto;
            gap: 8px;
            align-items: center;
        }
        .chat-settings-row .nf-select {
            width: 100%;
            min-width: 0;
        }
        .chatbot-panel .nf-select {
            width: 100%;
            min-width: 0;
            z-index: 1;
        }
        .chatbot-panel .nf-select.open {
            z-index: 3500;
        }
        .chatbot-panel .nf-select-menu {
            max-height: min(40vh, 280px);
        }
        .chat-settings-row button { min-width: 42px; }
        .chatbot-settings select,
        .chatbot-settings input {
            width: 100%;
            min-width: 0;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.06);
            background: transparent;
            color: var(--text-primary);
        }
        .chatbot-settings button {
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.06);
            background: transparent;
            color: var(--text-primary);
            cursor: pointer;
        }
        .chatbot-settings button i { pointer-events: none; }
        .chatbot-settings button.is-loading i { animation: chat-spin .9s linear infinite; }
        @keyframes chat-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .chat-keys-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
        }
        .chat-key-item {
            display: grid;
            grid-template-columns: 96px minmax(0, 1fr);
            gap: 8px;
            align-items: center;
        }
        .chat-key-item label {
            font-size: 12px;
            color: var(--text-secondary);
            letter-spacing: 0.03em;
            text-transform: uppercase;
        }
        .chat-settings-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        /* Info modal */
        .chatbot-info { position: fixed; bottom: 220px; right: 380px; width: 360px; max-width: calc(100% - 40px); background-color: var(--glass-01, rgba(255,255,255,0.06));
            -webkit-backdrop-filter: blur(18px) saturate(160%); backdrop-filter: blur(18px) saturate(160%);
            border:1px solid var(--glass-border, rgba(255,255,255,0.08)); border-radius:10px; padding:12px; box-shadow:0 20px 60px rgba(0,0,0,0.4); z-index:2300; display:none; }
        .chatbot-info h4 { margin:0 0 6px 0; }
        .chatbot-info p { margin:0 0 8px 0; color:var(--text-secondary); font-size:13px; line-height:1.4; }
        .chatbot-info pre { background: rgba(0,0,0,0.06); padding:8px; border-radius:6px; overflow:auto; font-size:12px; }
    .assistant-actions { margin-top:6px; display:flex; gap:6px; }
    .assistant-actions button { padding:6px 8px; border-radius:6px; border:1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.02); color:var(--text-primary); cursor:pointer; }
    .assistant-actions button:hover { background: rgba(255,255,255,0.035); }
        .chatbot-disclaimer { font-size:11px; color:var(--text-secondary); padding:6px 12px 8px; text-align:center; border-top:1px solid rgba(255,255,255,0.04); }

        @media (max-width: 480px) {
            .chatbot-panel { right: 8px; left: 8px; width: auto; bottom: calc(env(safe-area-inset-bottom, 0px) + 90px); top: calc(var(--top-nav-height-mobile, 64px) + 8px); height: auto; max-height: none; }
            .chatbot-info { right: 12px; left: 12px; bottom: 260px; }
            .chatbot-title { font-size: 14px; }
            .chatbot-header img { width: 30px; height: 30px; }
            .chatbot-actions button { min-width: 34px; height: 30px; padding: 0 8px; font-size: 11px; }
            .chatbot-messages { min-height: 0; }
            .chatbot-input { grid-template-columns: minmax(0, 1fr) 82px; }
            .chat-settings-row { grid-template-columns: 1fr; }
            .chat-settings-row button { width: 100%; min-height: 40px; }
            .chatbot-panel .nf-select-menu { max-height: min(34vh, 240px); }
            .chat-key-item { grid-template-columns: 1fr; gap: 4px; }
            .chat-settings-actions { justify-content: stretch; }
            .chat-settings-actions button { width: 100%; }
        }
        /* Mobile adjustments to avoid overlapping the storage/save stack */
        @media (max-width: 768px) {
            /* If the sidebar is open (not collapsed) position the chatbot button to the right of the sidebar
               so it doesn't overlap the vertical save/storage stack that floats on the right. */
            .sidebar:not(.collapsed) ~ .chatbot-btn {
                right: auto !important;
                left: calc(var(--sidebar-width, 280px) + 12px) !important;
                bottom: 24px !important;
                transform: translateY(0);
            }

            /* If the sidebar is collapsed keep the chatbot on the right edge. */
            .sidebar.collapsed ~ .chatbot-btn,
            body:has(.sidebar.collapsed) .chatbot-btn {
                right: 12px !important;
                bottom: 20px !important;
                left: auto !important;
            }

            .chat-settings-row {
                grid-template-columns: 1fr;
            }
            .chat-settings-row button {
                width: 100%;
                min-height: 40px;
            }

            .chatbot-input {
                grid-template-columns: minmax(0, 1fr) 82px;
            }

            .chat-settings-shell[open] .chatbot-settings {
                max-height: 34vh;
            }

            .chatbot-panel .nf-select-menu {
                max-height: min(34vh, 240px);
            }
        }
    </style>

    <button class="chatbot-btn" id="chatbotBtn" title="Chat with Flow">
        <img src="assets/Mascot-320.png" alt="Flow mascot" />
    </button>

        <div class="chatbot-panel" id="chatbotPanel" aria-hidden="true">
        <div class="chatbot-header">
            <img src="assets/Mascot-320.png" alt="Flow" />
            <div class="chatbot-title">Flow Assistant</div>
            <div class="chatbot-actions">
                <button id="chatInfoBtn" type="button" title="About this assistant" aria-label="About">Info</button>
                <button id="chatFullBtn" type="button" title="Expand" aria-label="Expand">Full</button>
                <button id="chatCloseBtn" type="button" title="Close" aria-label="Close">X</button>
            </div>
        </div>
        <div class="chatbot-messages" id="chatbotMessages"></div>
        <div class="chatbot-disclaimer">Note: chats are stateless by default (only your latest message is sent) to save tokens.</div>
        <div class="chatbot-input">
            <textarea id="chatInput" rows="2" placeholder="Ask Flow..."></textarea>
            <button id="chatSendBtn">Send</button>
        </div>
        <details class="chat-settings-shell" id="chatSettingsShell">
            <summary>
                <span>Provider, Model, and API Keys</span>
                <span class="chat-settings-hint" id="chatSettingsCurrent">Groq</span>
            </summary>
            <div class="chatbot-settings">
                <div class="chat-settings-row">
                    <select id="chatProviderSelect" aria-label="AI provider">
                        <option value="groq">Groq</option>
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                        <option value="gemini">Google Gemini</option>
                        <option value="openrouter">OpenRouter</option>
                    </select>
                    <select id="chatModelSelect" aria-label="Model"></select>
                    <button id="refreshChatModelsBtn" type="button" title="Refresh models" aria-label="Refresh models"><i class="fas fa-rotate-right" aria-hidden="true"></i></button>
                </div>
                <input id="chatCustomModelInput" type="text" placeholder="Optional custom model id (overrides dropdown)">
                <div class="chat-keys-grid">
                    <div class="chat-key-item">
                        <label for="groqApiKeyInput">Groq</label>
                        <input id="groqApiKeyInput" type="password" placeholder="Groq API key">
                    </div>
                    <div class="chat-key-item">
                        <label for="openaiApiKeyInput">OpenAI</label>
                        <input id="openaiApiKeyInput" type="password" placeholder="OpenAI API key">
                    </div>
                    <div class="chat-key-item">
                        <label for="anthropicApiKeyInput">Anthropic</label>
                        <input id="anthropicApiKeyInput" type="password" placeholder="Anthropic API key">
                    </div>
                    <div class="chat-key-item">
                        <label for="geminiApiKeyInput">Gemini</label>
                        <input id="geminiApiKeyInput" type="password" placeholder="Google AI Studio API key">
                    </div>
                    <div class="chat-key-item">
                        <label for="openrouterApiKeyInput">OpenRouter</label>
                        <input id="openrouterApiKeyInput" type="password" placeholder="OpenRouter API key">
                    </div>
                </div>
                <div class="chat-settings-actions">
                    <button id="saveChatKeysBtn" type="button">Save Keys</button>
                </div>
            </div>
        </details>
    </div>
<div class="chatbot-info" id="chatbotInfo">
        <h4>Why you need an API key</h4>
        <p>NoteFlow is a local-first, privacy-focused app. We do not run model servers. Your requests are sent directly from your browser to your selected AI provider.</p>
        <p style="margin-top:8px;"><strong>Supported providers in this panel:</strong></p>
        <ol style="margin:6px 0 0 18px;color:var(--text-secondary); font-size:13px; line-height:1.6;">
            <li><a href="https://console.groq.com" target="_blank" rel="noopener noreferrer" style="color:var(--accent);">Groq</a></li>
            <li><a href="https://platform.openai.com" target="_blank" rel="noopener noreferrer" style="color:var(--accent);">OpenAI</a></li>
            <li><a href="https://console.anthropic.com" target="_blank" rel="noopener noreferrer" style="color:var(--accent);">Anthropic</a></li>
            <li><a href="https://aistudio.google.com" target="_blank" rel="noopener noreferrer" style="color:var(--accent);">Google AI Studio (Gemini)</a></li>
            <li><a href="https://openrouter.ai" target="_blank" rel="noopener noreferrer" style="color:var(--accent);">OpenRouter</a></li>
        </ol>
        <p style="font-size:12px;color:var(--text-secondary);margin-top:10px;">API keys are stored only in localStorage on this device. We do not upload or store your keys.</p>
        <div style="display:flex;justify-content:flex-end;margin-top:8px;"><button onclick="closeChatInfo()">Got it</button></div>
    </div>

    <style id="mobile-global-override">
        @media (max-width: 1024px) {
            html, body {
                overflow-x: hidden;
            }

            .main-content,
            .view,
            .glass-panel,
            .glass-card,
            .task-card,
            .today-panel,
            .settings-card,
            .timeline-wrapper,
            .modal-content {
                min-width: 0;
                box-sizing: border-box;
            }

            .view {
                padding: 8px 10px calc(126px + env(safe-area-inset-bottom, 0px)) !important;
            }

            .view-header {
                gap: 10px !important;
            }

            .view-header h2 {
                font-size: clamp(21px, 5.6vw, 30px) !important;
                line-height: 1.12;
            }

            .theme-switcher-btn {
                top: 10px !important;
                right: 10px !important;
                width: 40px !important;
                height: 40px !important;
            }

            .tabs-shell {
                width: 100%;
                min-width: 0;
                padding-right: 56px;
            }

            .view-tabs {
                max-width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }

            .view-tabs::-webkit-scrollbar {
                display: none;
            }

            .quick-app-launchers {
                gap: 6px !important;
                margin-left: 0 !important;
            }

            .quick-app-btn {
                padding: 7px 9px !important;
                min-height: 38px;
            }

            .quick-app-btn span {
                display: none;
            }

            .storage-options {
                left: 8px !important;
                right: 8px !important;
                bottom: calc(env(safe-area-inset-bottom, 0px) + 8px) !important;
                gap: 6px !important;
                padding: 8px 10px !important;
                z-index: 3000 !important;
                border-radius: 12px !important;
            }

            .storage-options .taskbar-save-status {
                width: 100%;
                justify-content: center;
                font-size: 12px;
                margin-bottom: 2px;
            }

            .storage-options .taskbar-divider {
                display: none;
            }

            .storage-options .storage-btn {
                flex: 1 1 calc(33.333% - 6px);
                min-width: 0;
                justify-content: center;
                min-height: 38px;
            }

            .chatbot-btn {
                right: 10px !important;
                bottom: calc(env(safe-area-inset-bottom, 0px) + 96px) !important;
                width: 46px !important;
                height: 46px !important;
            }

            .chatbot-panel {
                left: 8px !important;
                right: 8px !important;
                width: auto !important;
                max-width: none !important;
                top: calc(var(--top-nav-height-mobile, 64px) + 8px) !important;
                bottom: calc(env(safe-area-inset-bottom, 0px) + 92px) !important;
                max-height: none !important;
                height: auto !important;
            }

            .chatbot-info {
                left: 8px !important;
                right: 8px !important;
                width: auto !important;
                max-width: none !important;
                bottom: calc(env(safe-area-inset-bottom, 0px) + 214px) !important;
            }

            .chatbot-input {
                display: grid;
                grid-template-columns: minmax(0, 1fr) 86px;
                align-items: end;
            }

            .chatbot-settings {
                flex-direction: column;
                align-items: stretch;
            }

            .chat-settings-row {
                grid-template-columns: 1fr;
            }

            .chat-settings-actions button {
                width: 100%;
            }

            #view-today .panel-header {
                flex-wrap: wrap;
                gap: 8px;
            }

            #view-today .task-card {
                grid-template-columns: 1fr !important;
                gap: 10px;
            }

            #view-today .task-actions {
                justify-content: flex-start !important;
                gap: 8px;
            }

            #view-today .task-actions .neumo-btn {
                flex: 1 1 calc(50% - 8px);
                min-width: 118px;
            }

            #view-today .today-panel {
                min-height: 230px !important;
            }

            #view-timeline {
                padding-bottom: calc(126px + env(safe-area-inset-bottom, 0px)) !important;
            }

            #view-timeline .view-header {
                align-items: flex-start !important;
            }

            #view-timeline .view-header > div:last-child {
                width: 100%;
                display: grid !important;
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 8px !important;
                align-items: stretch !important;
            }

            #view-timeline .view-header > div:last-child > * {
                width: 100% !important;
                min-width: 0 !important;
            }

            #view-timeline #addBlockBtn {
                grid-column: span 2;
            }

            #view-timeline .timeline-wrapper {
                padding: 10px;
                border-radius: 14px;
                overflow: hidden;
            }

            #view-timeline .timeline-container {
                grid-template-columns: 44px 1fr;
            }

            #view-timeline .timeline-scale {
                font-size: 11px;
            }

            #view-timeline .timeline-block {
                border-radius: 10px;
                padding: 8px 10px;
            }

            #view-timeline .current-block-card {
                margin-top: 12px !important;
            }

            #view-notes {
                padding: 0 8px calc(126px + env(safe-area-inset-bottom, 0px)) !important;
            }

            #view-notes .toolbar-wrapper {
                left: 8px !important;
                right: 8px !important;
                width: auto !important;
                max-width: none !important;
                border-radius: 12px !important;
            }

            #view-notes .toolbar {
                padding: 7px 8px !important;
                overflow-x: auto;
                white-space: nowrap;
                scrollbar-width: none;
            }

            #view-notes .toolbar::-webkit-scrollbar {
                display: none;
            }

            #view-notes .editor-container {
                padding: calc(var(--top-nav-height-mobile) + 68px) 8px calc(130px + env(safe-area-inset-bottom, 0px)) !important;
            }

            #view-notes .breadcrumbs {
                flex-wrap: wrap;
                gap: 6px;
            }

            #view-notes .page-title-input {
                font-size: clamp(20px, 6vw, 30px) !important;
                margin-top: 8px !important;
            }

            #view-notes .editor {
                min-height: 52vh !important;
                padding: 14px 12px !important;
                font-size: 16px;
                line-height: 1.55;
            }

            #view-notes .editor table {
                display: block;
                overflow-x: auto;
                max-width: 100%;
            }

            #view-settings .settings-grid {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }

            #view-settings .settings-main-stack {
                gap: 10px !important;
            }

            #view-settings .settings-card {
                padding: 14px !important;
                gap: 10px !important;
            }

            #view-settings .settings-row {
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 8px !important;
            }

            #view-settings .settings-actions {
                width: 100%;
                gap: 8px !important;
            }

            #view-settings .settings-actions .neumo-btn,
            #view-settings .settings-row > .neumo-btn,
            #view-settings .settings-row .modal-input {
                width: 100%;
                max-width: none !important;
            }

            #view-settings #taskOrderStrategySelect {
                width: 100% !important;
                max-width: none !important;
            }

            #view-homework {
                padding-bottom: calc(126px + env(safe-area-inset-bottom, 0px)) !important;
            }

            #view-homework #hwMainArea {
                padding: 10px !important;
            }

            #view-homework .hw-header-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            #view-homework .hw-header-bar > div:last-child {
                width: 100%;
                display: grid !important;
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 8px !important;
            }

            #view-homework .hw-header-bar > div:last-child .hw-btn {
                width: 100%;
                justify-content: center;
            }

            #view-homework .hw-table-wrap {
                overflow-x: hidden;
                border-radius: 12px;
            }

            #view-homework .hw-data-table {
                min-width: 0;
                width: 100%;
            }

            .theme-panel {
                top: calc(var(--top-nav-height-mobile) + 8px) !important;
                left: 10px !important;
                right: 10px !important;
                width: auto !important;
                max-height: calc(100dvh - var(--top-nav-height-mobile) - 18px) !important;
                padding: 14px !important;
                z-index: 5600 !important;
                border-radius: 14px !important;
            }

            .apply-mode-toggle {
                flex-direction: column;
                gap: 8px;
            }

            .preset-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .tutorial-card {
                width: calc(100vw - 16px) !important;
                max-height: calc(100dvh - 16px);
                overflow-y: auto;
                border-radius: 14px;
                padding: 14px !important;
            }

            .tutorial-actions {
                flex-wrap: wrap;
                justify-content: stretch;
                gap: 8px;
            }

            .tutorial-actions .neumo-btn {
                flex: 1 1 calc(50% - 8px);
            }

            .modal {
                padding: 10px !important;
                align-items: flex-end !important;
            }

            .modal-content {
                width: 100% !important;
                max-width: none !important;
                max-height: calc(100dvh - 20px) !important;
                overflow-y: auto !important;
                border-radius: 14px 14px 10px 10px !important;
                padding: 16px !important;
            }

            .modal-header {
                margin-bottom: 12px !important;
                position: sticky;
                top: 0;
                z-index: 2;
                background: inherit;
            }

            .modal-body {
                margin-bottom: 12px !important;
            }

            .modal-footer {
                flex-wrap: wrap;
                justify-content: stretch;
                gap: 8px !important;
                position: sticky;
                bottom: 0;
                padding-top: 10px;
                background: linear-gradient(180deg, rgba(255, 255, 255, 0), var(--bg-primary));
            }

            .modal-footer .btn,
            .modal-footer .neumo-btn {
                flex: 1 1 calc(50% - 8px);
                min-height: 42px;
            }
        }

        @media (max-width: 768px) {
            .view {
                padding: 8px 8px calc(136px + env(safe-area-inset-bottom, 0px)) !important;
            }

            .top-nav {
                margin: 6px !important;
                padding: 8px 10px !important;
                gap: 8px !important;
            }

            .brand-label {
                font-size: 15px !important;
            }

            .view-tabs-toggle {
                right: 8px !important;
            }

            #view-today .summary-grid {
                grid-template-columns: 1fr !important;
            }

            #view-today .task-actions .neumo-btn {
                flex: 1 1 100%;
            }

            #view-timeline .view-header > div:last-child {
                grid-template-columns: 1fr;
            }

            #view-timeline #addBlockBtn {
                grid-column: span 1;
            }

            #view-timeline .timeline-calendar-grid.week,
            #view-timeline .timeline-calendar-grid.month {
                grid-template-columns: 1fr;
            }

            #view-timeline .timeline-year-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            #view-homework .hw-data-table {
                min-width: 0;
                width: 100%;
                border-collapse: separate;
                border-spacing: 0;
            }

            #view-homework .hw-data-table thead {
                display: none;
            }

            #view-homework .hw-data-table tbody {
                display: grid;
                gap: 10px;
            }

            #view-homework .hw-data-table tr {
                display: grid;
                gap: 8px;
                border: 1px solid var(--glass-border);
                border-radius: 12px;
                background: rgba(255, 255, 255, 0.04);
                padding: 10px;
            }

            #view-homework .hw-data-table td {
                display: grid;
                grid-template-columns: 1fr;
                gap: 8px;
                padding: 0 !important;
                border: 0 !important;
                align-items: start;
                width: auto !important;
                min-width: 0 !important;
            }

            #view-homework .hw-data-table td:nth-child(1),
            #view-homework .hw-data-table td:nth-child(2),
            #view-homework .hw-data-table td:nth-child(3),
            #view-homework .hw-data-table td:nth-child(4) {
                width: auto !important;
            }

            #view-homework .hw-data-table td::before {
                display: block;
                margin-bottom: 2px;
                font-size: 11px;
                text-transform: uppercase;
                letter-spacing: 0.06em;
                color: var(--text-secondary);
                font-weight: 700;
            }

            #view-homework .hw-data-table td:nth-child(1)::before { content: "Class"; }
            #view-homework .hw-data-table td:nth-child(2)::before { content: "Assignments"; }
            #view-homework .hw-data-table td:nth-child(3)::before { content: "Activity"; }
            #view-homework .hw-data-table td:nth-child(4)::before { content: "Notes"; }

            #view-homework .hw-inline-add {
                grid-template-columns: 1fr;
                gap: 8px;
                padding: 10px;
            }

            #view-homework .hw-course-row {
                align-items: flex-start;
            }

            #view-homework .hw-course-title,
            #view-homework .hw-task-text {
                white-space: normal;
                overflow-wrap: break-word;
                word-break: break-word;
            }

            #view-homework .hw-inline-add input,
            #view-homework .hw-inline-add select,
            #view-homework .hw-inline-add button {
                width: 100%;
            }

            #view-homework .hw-inline-add .nf-select,
            #view-homework .hw-inline-add .nf-date {
                width: 100% !important;
                min-width: 0 !important;
            }

            #view-homework .hw-inline-add .nf-select.nf-select--compact .nf-select-trigger {
                min-height: 38px;
                font-size: 13px;
                padding: 8px 30px 8px 10px;
            }

            #view-homework .hw-inline-add .nf-date .nf-date-trigger {
                min-height: 38px;
                padding: 8px 30px 8px 10px;
                font-size: 13px;
            }

            .tutorial-actions .neumo-btn,
            .modal-footer .btn,
            .modal-footer .neumo-btn {
                flex: 1 1 100%;
            }
        }

        @media (max-width: 560px) {
            .storage-options .taskbar-save-status {
                display: none;
            }

            .storage-options .storage-btn {
                min-height: 36px;
                padding: 8px 6px !important;
            }

            .storage-options .storage-btn .btn-text {
                display: none !important;
            }

            #view-homework .hw-header-bar > div:last-child {
                grid-template-columns: 1fr !important;
            }

            #view-timeline .timeline-year-grid {
                grid-template-columns: 1fr;
            }

            #view-notes .editor {
                font-size: 15px;
                padding: 12px 10px !important;
            }
        }

        @media (max-width: 1024px) and (max-height: 760px) {
            .top-nav {
                top: 4px !important;
            }

            #view-notes .toolbar-wrapper {
                top: calc(var(--top-nav-height-mobile) + 4px) !important;
            }

            .chatbot-panel {
                max-height: calc(100dvh - var(--top-nav-height-mobile, 64px) - 104px) !important;
            }
        }
    </style>

    

    <style id="active-view-hard-guard">
        .view {
            display: none !important;
        }
        .view.active {
            display: block !important;
        }
        #view-collegeapp.active,
        #view-life.active {
            display: grid !important;
        }
    </style>
    <script id="active-view-fallback-script">
        (function () {
            function applyActiveView(view) {
                var next = typeof view === 'string' && view ? view : 'today';
                var sections = document.querySelectorAll('.view');
                var tabs = document.querySelectorAll('.view-tab');
                sections.forEach(function (section) {
                    var isActive = section.id === ('view-' + next);
                    section.classList.toggle('active', isActive);
                    section.style.display = isActive ? '' : 'none';
                });
                tabs.forEach(function (tab) {
                    tab.classList.toggle('active', tab.dataset.view === next);
                });
            }

            document.addEventListener('DOMContentLoaded', function () {
                var current = document.querySelector('.view-tab.active');
                applyActiveView(current && current.dataset ? current.dataset.view : 'today');
                document.querySelectorAll('.view-tab').forEach(function (tab) {
                    tab.addEventListener('click', function () {
                        applyActiveView(tab.dataset.view);
                    });
                });
            });
        })();
    </script>

    <script src="app.js"></script>

    <!-- All Tasks drawer (collapsible) -->
    <aside id="allTasksDrawer" class="all-tasks-drawer" aria-hidden="true">
        <div class="drawer-header">
            <h3>All Tasks <span class="neumo-chip" id="allCount">0</span></h3>
            <button id="closeAllTasksBtn" class="neumo-btn" aria-label="Close tasks">Close</button>
        </div>
        <div id="today-all-list" class="task-list drawer-body"></div>
        <div id="today-all-empty" class="empty-state drawer-empty">
            <div class="empty-title">No tasks</div>
            <div class="empty-subtitle">Your tasks will appear here.</div>
        </div>
    </aside>
    <!-- Duplicate homework view removed (lives inside main-content now) -->

    <!-- Auto-set CSS variable for top-nav height so the floating toolbar positions correctly -->
    <script>
        (function(){
            function updateTopNavHeight(){
                var topNav = document.querySelector('.top-nav');
                if(!topNav) return;
                var rect = topNav.getBoundingClientRect();
                /*
                 We want the toolbar to sit below the bottom edge of the top-nav as rendered in the
                 viewport. Using only rect.height assumes the top-nav starts at the very top of the
                 viewport (y=0). Because the top-nav is sticky and may be offset (e.g., top:12px), we
                 compute the distance from the viewport top to the bottom of the top-nav: rect.top + rect.height.
                 */
                var bottom = rect.top + rect.height;
                document.documentElement.style.setProperty('--top-nav-height', bottom + 'px');
                // also keep mobile var in sync
                document.documentElement.style.setProperty('--top-nav-height-mobile', bottom + 'px');
            }

            // Run on load and on resize
            window.addEventListener('load', updateTopNavHeight);
            window.addEventListener('resize', function(){ window.requestAnimationFrame(updateTopNavHeight); });

            // Observe top-nav size changes (if ResizeObserver is available)
            document.addEventListener('DOMContentLoaded', function(){
                var topNav = document.querySelector('.top-nav');
                if(topNav && window.ResizeObserver){
                    var ro = new ResizeObserver(updateTopNavHeight);
                    ro.observe(topNav);
                }
                // initial call in case load already fired
                updateTopNavHeight();
            });
        })();
    </script>
    <!-- storage/taskbar measurement script removed because the taskbar was deleted -->
</body>
</html>

