* {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

    :root {
            --font-heading: "Playfair Display", Georgia, serif;
            --font-body: "Source Sans 3", "Segoe UI", system-ui, sans-serif;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f8f7;
            --bg-hover: #f0eeeb;
            --bg-elevated: #ffffff;
            --text-primary: #2a2621;
            --text-secondary: #5f6670;
            --text-muted: #87909d;
            --border: rgba(22, 30, 45, 0.13);
            --accent: #b8860b;
            --accent-rgb: 184, 134, 11;
            --accent-strong: #9a6f07;
            --accent-soft: rgba(184, 134, 11, 0.12);
            --sidebar-width: 300px;
            --editor-bg: #ffffff;
            --code-bg: #f5f7fa;
            --status-bar-height: 30px;
            --glass-01: rgba(245, 243, 240, 0.88);
            --glass-02: rgba(248, 246, 243, 0.92);
            --glass-border: rgba(22, 30, 45, 0.12);
            --glass-blur: 22px;
            --shadow-soft: 0 14px 32px rgba(22, 30, 45, 0.08);
            --shadow-soft-lg: 0 24px 52px rgba(22, 30, 45, 0.12);
            --neumo-bg: #ffffff;
            --neumo-shadow-light: rgba(255, 255, 255, 0.85);
            --neumo-shadow-dark: rgba(22, 30, 45, 0.12);
            --neumo-radius: 14px;
            --neumo-offset: 8px;
            --neumo-inset-dark: rgba(22, 30, 45, 0.1);
            --neumo-inset-light: rgba(255, 255, 255, 0.8);
            /* Surface tokens: consistent bg/border for components in both themes */
            --surface-bg: rgba(22, 30, 45, 0.03);
            --surface-bg-hover: rgba(22, 30, 45, 0.06);
            --surface-bg-active: rgba(22, 30, 45, 0.08);
            --surface-border: rgba(22, 30, 45, 0.10);
            --surface-border-strong: rgba(22, 30, 45, 0.16);
            --surface-bg-elevated: rgba(22, 30, 45, 0.02);
            --surface-inset: rgba(22, 30, 45, 0.04);
            --code-inline-bg: rgba(22, 30, 45, 0.06);
            --code-block-bg: rgba(22, 30, 45, 0.04);
            /* Approximate height of the top navigation (used for placing the floating toolbar) */
            --top-nav-height: 88px;
            --top-nav-height-mobile: 64px;
            --radius: 18px;
            --radius-lg: 28px;
            --radius-pill: 999px;
            --transition-fast: 180ms cubic-bezier(0.22, 1, 0.36, 1);
            --transition-base: 260ms cubic-bezier(0.22, 1, 0.36, 1);
        }

            .toolbar-time-widget {
                font-variant-numeric: tabular-nums;
                font-feature-settings: "tnum";
            }

        /* Theme */
    [data-theme="dark"] {
            --bg-primary: #0f0e0c;
            --bg-secondary: #171513;
            --bg-hover: #201e1b;
            --bg-elevated: #1b1916;
            --text-primary: #ece6dd;
            --text-secondary: #c3bbb1;
            --text-muted: #9a9186;
            --border: rgba(255, 255, 255, 0.08);
            --accent: #d2a74d;
            --accent-rgb: 210, 167, 77;
            --accent-strong: #b4882d;
            --accent-soft: rgba(210, 167, 77, 0.14);
            --editor-bg: #14120f;
            --code-bg: #1c1a17;
            --glass-01: rgba(20, 19, 18, 0.5);
            --glass-02: rgba(20, 19, 18, 0.64);
            --glass-border: rgba(255, 255, 255, 0.08);
            --shadow-soft: 0 14px 30px rgba(0, 0, 0, 0.34);
            --shadow-soft-lg: 0 28px 56px rgba(0, 0, 0, 0.4);
            --neumo-bg: #171513;
            --neumo-shadow-light: rgba(255, 255, 255, 0.035);
            --neumo-shadow-dark: rgba(0, 0, 0, 0.48);
            --neumo-inset-dark: rgba(0, 0, 0, 0.5);
            --neumo-inset-light: rgba(255, 255, 255, 0.06);
            /* Surface tokens for dark mode */
            --surface-bg: rgba(255, 255, 255, 0.03);
            --surface-bg-hover: rgba(255, 255, 255, 0.06);
            --surface-bg-active: rgba(255, 255, 255, 0.10);
            --surface-border: rgba(255, 255, 255, 0.08);
            --surface-border-strong: rgba(255, 255, 255, 0.14);
            --surface-bg-elevated: rgba(255, 255, 255, 0.02);
            --surface-inset: rgba(255, 255, 255, 0.04);
            --code-inline-bg: rgba(255, 255, 255, 0.08);
            --code-block-bg: rgba(0, 0, 0, 0.25);
        }

        /* Neumorphic utility classes and defaults */
        /* These provide soft shadows and rounded surfaces for a gentle "neumorphism" look. */
        .neumo-card {
            background: var(--neumo-bg);
            border-radius: var(--neumo-radius);
            box-shadow: 8px 8px 18px var(--neumo-shadow-dark), -8px -8px 18px var(--neumo-shadow-light);
            border: 1px solid var(--border);
        }

        .neumo-btn {
            background: var(--neumo-bg);
            border-radius: var(--radius-pill);
            padding: 8px 14px;
            box-shadow: 6px 6px 14px var(--neumo-shadow-dark), -6px -6px 14px var(--neumo-shadow-light);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
        }

        .neumo-btn:hover {
            transform: translateY(-1px);
        }

        .neumo-btn:active {
            transform: translateY(0);
            box-shadow: inset 3px 3px 7px var(--neumo-inset-dark), inset -3px -3px 7px var(--neumo-shadow-light);
        }

        .neumo-input {
            background: var(--neumo-bg);
            border-radius: 12px;
            padding: 10px 12px;
            box-shadow: inset 3px 3px 6px var(--neumo-inset-dark), inset -3px -3px 6px var(--neumo-inset-light);
            border: 1px solid var(--border);
            color: var(--text-primary);
            outline: none;
            transition: box-shadow var(--transition-fast), transform var(--transition-fast);
        }

        .neumo-input:focus {
            box-shadow: inset 2px 2px 4px var(--neumo-inset-dark), inset -2px -2px 4px var(--neumo-inset-light), 0 0 0 3px var(--accent-soft);
        }

        /* Theme native select popups so open dropdown menus match app theme */
        select {
            color: var(--text-primary);
            background-color: var(--bg-elevated);
            border-color: var(--border);
            color-scheme: light;
        }

        [data-theme="dark"] select,
        [data-theme="tokyo-night"] select,
        [data-theme="dracula"] select,
        [data-theme="nord"] select,
        [data-theme="monokai"] select,
        [data-theme="gruvbox"] select,
        [data-theme="solarized-dark"] select,
        [data-theme="one-dark"] select,
        [data-theme="midnight-blue"] select,
        [data-theme="ocean-dark"] select {
            color-scheme: dark;
            background-color: rgba(255, 255, 255, 0.04);
        }

        select option,
        select optgroup {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        select option:disabled {
            color: var(--text-muted);
        }

        /* Custom animated select component */
        .nf-select {
            position: relative;
            display: inline-block;
            min-width: 0;
            vertical-align: middle;
        }

        .nf-select.nf-select--full {
            width: 100%;
        }

        .nf-select.nf-select--flex {
            flex: 1;
        }

        .nf-select-native {
            position: absolute !important;
            inset: 0 !important;
            width: 100% !important;
            height: 100% !important;
            opacity: 0 !important;
            pointer-events: none !important;
            z-index: -1 !important;
        }

        .nf-select-trigger {
            width: 100%;
            min-height: 42px;
            border-radius: 16px;
            border: 1px solid var(--glass-border, var(--border));
            background: var(--glass-01);
            color: var(--text-primary);
            font: inherit;
            text-align: left;
            padding: 10px 38px 10px 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast), background var(--transition-fast);
            box-shadow: 0 8px 18px rgba(22, 30, 45, 0.08);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        .nf-select:not(.is-disabled) .nf-select-trigger:hover {
            border-color: var(--accent);
            transform: translateY(-1px);
            box-shadow: 0 12px 24px rgba(22, 30, 45, 0.12);
        }

        .nf-select-trigger:focus-visible {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-soft), 0 10px 20px rgba(22, 30, 45, 0.12);
        }

        .nf-select.open .nf-select-trigger {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-soft), 0 12px 24px rgba(22, 30, 45, 0.14);
        }

        .nf-select-label {
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .nf-select-chevron {
            position: absolute;
            right: 14px;
            top: 50%;
            width: 10px;
            height: 10px;
            border-right: 2px solid currentColor;
            border-bottom: 2px solid currentColor;
            transform: translateY(-60%) rotate(45deg);
            transition: transform var(--transition-fast);
            opacity: 0.9;
            pointer-events: none;
        }

        .nf-select.open .nf-select-chevron {
            transform: translateY(-40%) rotate(-135deg);
        }

        .nf-select-menu {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            min-width: max(100%, 190px);
            max-height: 260px;
            overflow: auto;
            padding: 8px;
            border-radius: 16px;
            border: 1px solid var(--glass-border, var(--border));
            background: var(--bg-elevated);
            box-shadow: 0 18px 38px rgba(22, 30, 45, 0.18);
            z-index: 2200;
            opacity: 0;
            transform: translateY(-8px) scale(0.98);
            transform-origin: top center;
            pointer-events: none;
            transition: opacity var(--transition-fast), transform var(--transition-fast);
            -webkit-backdrop-filter: blur(14px);
            backdrop-filter: blur(14px);
        }

        .nf-select.open .nf-select-menu {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }

        .nf-select-menu.is-open {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }

        .nf-select-menu--portal {
            position: fixed;
            right: auto;
            min-width: 190px;
            z-index: 13000;
        }

        .nf-select-menu--portal.nf-select-menu--open-up {
            transform-origin: bottom center;
            transform: translateY(8px) scale(0.98);
        }

        .nf-select-menu--portal.is-open.nf-select-menu--open-up {
            transform: translateY(0) scale(1);
        }

        .nf-select-group {
            padding: 7px 10px 6px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            font-weight: 700;
        }

        .nf-select-option {
            width: 100%;
            border: 0;
            border-radius: 11px;
            background: transparent;
            color: var(--text-primary);
            font: inherit;
            font-size: 13px;
            text-align: left;
            padding: 8px 10px;
            cursor: pointer;
            display: block;
            transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
        }

        .nf-select-option:hover,
        .nf-select-option:focus-visible {
            outline: none;
            background: var(--accent-soft);
            color: var(--text-primary);
            transform: translateX(2px);
        }

        .nf-select-option.is-selected {
            background: var(--accent-soft);
            color: var(--text-primary);
            font-weight: 600;
        }

        .nf-select-option.is-disabled {
            color: var(--text-muted);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .nf-select.is-disabled .nf-select-trigger {
            opacity: 0.65;
            cursor: not-allowed;
        }

        .nf-select.nf-select--compact .nf-select-trigger {
            min-height: 28px;
            border-radius: 10px;
            padding: 4px 26px 4px 8px;
            font-size: 11px;
            box-shadow: none;
        }

        .nf-select.nf-select--compact .nf-select-chevron {
            right: 9px;
            width: 8px;
            height: 8px;
            border-width: 1.7px;
        }

        .nf-select.nf-select--compact .nf-select-menu {
            min-width: max(100%, 140px);
            border-radius: 10px;
            padding: 6px;
            max-height: 220px;
        }

        .nf-select.nf-select--compact .nf-select-option {
            font-size: 11px;
            padding: 6px 8px;
            border-radius: 8px;
        }

        #toolbarTimeControls .nf-select {
            min-width: 86px;
        }

        @media (prefers-reduced-motion: reduce) {
            .nf-select-trigger,
            .nf-select-menu,
            .nf-select-option,
            .nf-select-chevron {
                transition: none !important;
                transform: none !important;
            }
        }

        /* Custom animated date picker component */
        .nf-date {
            position: relative;
            display: inline-block;
            min-width: 0;
            vertical-align: middle;
        }

        .nf-date.nf-date--full {
            width: 100%;
        }

        .nf-date-native {
            position: absolute !important;
            inset: 0 !important;
            width: 100% !important;
            height: 100% !important;
            opacity: 0 !important;
            pointer-events: none !important;
            z-index: -1 !important;
        }

        .nf-date-trigger {
            width: 100%;
            min-height: 42px;
            border-radius: 16px;
            border: 1px solid var(--glass-border, var(--border));
            background: var(--glass-01);
            color: var(--text-primary);
            font: inherit;
            text-align: left;
            padding: 10px 40px 10px 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast), background var(--transition-fast);
            box-shadow: 0 8px 18px rgba(22, 30, 45, 0.08);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        .nf-date:not(.is-disabled) .nf-date-trigger:hover {
            border-color: var(--accent);
            transform: translateY(-1px);
            box-shadow: 0 12px 24px rgba(22, 30, 45, 0.12);
        }

        .nf-date-trigger:focus-visible {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-soft), 0 10px 20px rgba(22, 30, 45, 0.12);
        }

        .nf-date.open .nf-date-trigger {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-soft), 0 12px 24px rgba(22, 30, 45, 0.14);
        }

        .nf-date-label {
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .nf-date-icon {
            position: absolute;
            right: 13px;
            top: 50%;
            width: 16px;
            height: 16px;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--text-secondary);
        }

        .nf-date-icon::before,
        .nf-date-icon::after {
            content: "";
            position: absolute;
            box-sizing: border-box;
        }

        .nf-date-icon::before {
            inset: 3px 1px 1px;
            border: 1.8px solid currentColor;
            border-radius: 4px;
        }

        .nf-date-icon::after {
            left: 3px;
            right: 3px;
            top: 1px;
            height: 4px;
            border-top: 2px solid currentColor;
            border-left: 2px solid currentColor;
            border-right: 2px solid currentColor;
            border-radius: 2px 2px 0 0;
        }

        .nf-date-panel {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            min-width: 280px;
            width: max(100%, 280px);
            padding: 10px;
            border-radius: 16px;
            border: 1px solid var(--glass-border, var(--border));
            background: var(--bg-elevated);
            box-shadow: 0 18px 38px rgba(22, 30, 45, 0.18);
            z-index: 2400;
            opacity: 0;
            transform: translateY(-8px) scale(0.98);
            transform-origin: top center;
            pointer-events: none;
            transition: opacity var(--transition-fast), transform var(--transition-fast);
            -webkit-backdrop-filter: blur(14px);
            backdrop-filter: blur(14px);
        }

        .nf-date.open .nf-date-panel {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }

        .nf-date-panel.is-open {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }

        .nf-date-panel--portal {
            position: fixed;
            right: auto;
            z-index: 13020;
        }

        .nf-date-panel--portal.nf-date-panel--open-up {
            transform-origin: bottom center;
            transform: translateY(8px) scale(0.98);
        }

        .nf-date-panel--portal.is-open.nf-date-panel--open-up {
            transform: translateY(0) scale(1);
        }

        .nf-date.drop-up .nf-date-panel {
            top: auto;
            bottom: calc(100% + 8px);
            transform: translateY(8px) scale(0.98);
            transform-origin: bottom center;
        }

        .nf-date.drop-up.open .nf-date-panel {
            transform: translateY(0) scale(1);
        }

        .nf-date-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 8px;
        }

        .nf-date-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 0.01em;
        }

        .nf-date-nav {
            border: 1px solid var(--glass-border, var(--border));
            background: var(--glass-01);
            color: var(--text-primary);
            width: 28px;
            height: 28px;
            border-radius: 9px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background var(--transition-fast), transform var(--transition-fast), border-color var(--transition-fast);
        }

        .nf-date-nav:hover {
            background: var(--accent-soft);
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .nf-date-weekdays,
        .nf-date-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .nf-date-weekday {
            text-align: center;
            font-size: 10px;
            font-weight: 700;
            color: var(--text-secondary);
            padding: 4px 0;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .nf-date-day {
            border: 0;
            border-radius: 9px;
            background: transparent;
            color: var(--text-primary);
            height: 32px;
            font: inherit;
            font-size: 12px;
            cursor: pointer;
            transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
        }

        .nf-date-day:hover,
        .nf-date-day:focus-visible {
            outline: none;
            background: var(--accent-soft);
            transform: translateY(-1px);
        }

        .nf-date-day.is-other {
            color: var(--text-muted);
            opacity: 0.65;
        }

        .nf-date-day.is-selected {
            background: var(--accent);
            color: #fff;
            font-weight: 700;
        }

        .nf-date-day.is-today:not(.is-selected) {
            box-shadow: inset 0 0 0 1px var(--accent);
            color: var(--text-primary);
            font-weight: 600;
        }

        .nf-date-day:disabled {
            opacity: 0.35;
            cursor: not-allowed;
            transform: none !important;
            background: transparent !important;
        }

        .nf-date-footer {
            margin-top: 8px;
            display: flex;
            justify-content: space-between;
            gap: 8px;
        }

        .nf-date-action {
            border: 0;
            background: transparent;
            color: var(--accent);
            font: inherit;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 6px;
            transition: background var(--transition-fast), color var(--transition-fast);
        }

        .nf-date-action:hover {
            background: var(--accent-soft);
        }

        .nf-date.is-disabled .nf-date-trigger {
            opacity: 0.65;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .nf-date-panel {
                min-width: 260px;
                width: max(100%, 260px);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .nf-date-trigger,
            .nf-date-panel,
            .nf-date-day,
            .nf-date-nav,
            .nf-date-action {
                transition: none !important;
                transform: none !important;
            }
        }

        /* A subtle variant for darker themes */
        [data-theme="dark"] .neumo-card,
        [data-theme="dark"] .neumo-btn,
        [data-theme="dark"] .neumo-input {
            background: var(--neumo-bg);
            box-shadow: 6px 6px 16px var(--neumo-shadow-dark), -6px -6px 16px var(--neumo-shadow-light);
            border: 1px solid rgba(255, 255, 255, 0.06);
            color: var(--text-primary);
        }

        .new-page-btn,
        .todo-add-btn,
        .toolbar-btn,
        .btn,
        .todo-filter-btn,
        .theme-switcher-btn {
            background: var(--neumo-bg);
            border-radius: var(--radius-pill);
            border: 1px solid var(--border);
            box-shadow: 6px 6px 14px var(--neumo-shadow-dark), -6px -6px 14px var(--neumo-shadow-light);
            color: var(--text-primary);
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
        }

        .new-page-btn:hover,
        .todo-add-btn:hover,
        .toolbar-btn:hover,
        .btn:hover,
        .todo-filter-btn:hover,
        .theme-switcher-btn:hover {
            transform: translateY(-1px);
        }

        .btn-primary {
            background: var(--accent-soft);
            color: var(--text-primary);
        }

        .glass-panel,
        .glass-card,
        .glass-modal {
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(160%);
            backdrop-filter: blur(var(--glass-blur)) saturate(160%);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-soft);
        }

        .glass-panel {
            border-radius: var(--radius-lg);
        }

        .glass-card {
            border-radius: var(--radius);
            background: var(--glass-01);
        }

        .glass-modal {
            border-radius: calc(var(--radius-lg) + 6px);
        }

        .neumo-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: var(--radius-pill);
            background: var(--neumo-bg);
            box-shadow: 4px 4px 10px var(--neumo-shadow-dark), -4px -4px 10px var(--neumo-shadow-light);
            border: 1px solid var(--border);
            font-size: 12px;
            color: var(--text-secondary);
            letter-spacing: 0.04em;
            text-transform: uppercase;
        }

        .neumo-toggle {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: var(--radius-pill);
            background: var(--neumo-bg);
            box-shadow: inset 2px 2px 5px var(--neumo-inset-dark), inset -2px -2px 5px var(--neumo-inset-light);
            border: 1px solid var(--border);
            font-size: 13px;
            color: var(--text-secondary);
        }

        .streak-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: var(--radius-pill);
            background: var(--accent-soft);
            color: var(--text-primary);
            font-weight: 600;
            letter-spacing: 0.01em;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            transition: background-color var(--transition-base), color var(--transition-base);
        }

        body[data-theme="dark"] {
            background:
                radial-gradient(1100px 800px at 8% -10%, rgba(210, 167, 77, 0.12), transparent 60%),
                radial-gradient(900px 700px at 90% 10%, rgba(0, 0, 0, 0.45), transparent 55%),
                linear-gradient(160deg, var(--bg-primary), var(--bg-secondary));
        }

        h1, h2, h3, h4, h5 {
            font-family: var(--font-heading);
            letter-spacing: -0.01em;
        }

        :focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* Sidebar Styling - Liquid Glass */
        .sidebar {
            width: var(--sidebar-width);
            min-width: var(--sidebar-width);
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(160%);
            backdrop-filter: blur(var(--glass-blur)) saturate(160%);
            border-right: 1px solid var(--glass-border);
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease, min-width 0.3s ease;
            flex-shrink: 0;
            position: relative;
            z-index: 1200; /* keep sidebar above most floating UI */
            overflow: hidden;
        }

        .sidebar.collapsed {
            width: 0;
            min-width: 0;
            border-right: none;
        }

        .sidebar.collapsed > * {
            opacity: 0;
            visibility: hidden;
        }

        .sidebar-toggle-btn {
            position: fixed;
            top: 70px;
            left: calc(var(--sidebar-width) - 14px);
            width: 28px;
            height: 28px;
            background: var(--surface-bg-hover);
            -webkit-backdrop-filter: blur(12px) saturate(150%);
            backdrop-filter: blur(12px) saturate(150%);
            border: 1px solid var(--surface-border);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1300;
            color: var(--text-secondary);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            transition: left 0.3s ease, background 0.2s ease, transform 0.2s ease;
            font-size: 12px;
        }

        .sidebar-toggle-btn:hover {
            background: var(--surface-bg-active);
            color: var(--text-primary);
            transform: scale(1.05);
        }

        .sidebar-toggle-btn.collapsed {
            left: 10px;
        }

        .sidebar-toggle-btn i {
            transition: transform 0.3s ease;
        }

        .sidebar-toggle-btn.collapsed i {
            transform: rotate(180deg);
        }

        .sidebar-header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--surface-border);
            background: var(--surface-bg);
        }

        .app-title {
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-search {
            padding: 10px 16px;
            border-bottom: 1px solid var(--surface-border);
        }

        .search-input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--surface-border);
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
            font-size: 13px;
            outline: none;
            transition: border-color 0.2s, background 0.2s;
        }
        
        .search-input:focus {
            border-color: var(--accent);
            background: var(--surface-bg-hover);
        }

        /* Compact focus timer with Apple-like styling */
        .focus-timer {
            padding: 8px 10px;
            border-radius: 10px;
            margin: 8px 12px 6px 12px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            background: var(--surface-bg-elevated);
            -webkit-backdrop-filter: blur(6px);
            backdrop-filter: blur(6px);
            border: 1px solid var(--surface-border);
            font-size: 13px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        .focus-timer:hover {
            background: var(--surface-bg);
            border-color: var(--surface-border);
        }
        .focus-timer .timer-top {
            display:flex;
            align-items:center;
            justify-content:flex-start;
            gap:4px;
        }
        .focus-timer .timer-left {
            display:flex;
            align-items:center;
            gap:8px;
        }
        .focus-timer .timer-mode-badge{
            background: var(--surface-bg);
            color:var(--text-secondary);
            padding:6px 10px;
            border-radius:999px;
            font-weight:600;
            font-size:11px;
            border: 1px solid var(--surface-border);
        }
        .focus-timer .timer-display {
            display: inline-block;
            font-size:16px;
            font-weight:700;
            padding:6px 12px;
            border-radius:8px;
            background: transparent;
            color:var(--text-primary);
            min-width:70px;
            text-align:center;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            line-height: 1.15;
            font-variant-numeric: tabular-nums;
            font-feature-settings: "tnum";
            white-space: nowrap;
        }

        .focus-timer .timer-wheel-segment {
            position: relative;
            display: inline-block;
            height: 1.15em;
            vertical-align: middle;
            overflow: hidden;
        }

        .focus-timer .timer-wheel-sep {
            display: inline-block;
            vertical-align: middle;
            padding: 0 0.08em;
        }

        .focus-timer .timer-wheel-static {
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            text-align: center;
        }

        .focus-timer .timer-wheel-face {
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            backface-visibility: hidden;
            transform-origin: center center;
            text-align: center;
        }

        .focus-timer .timer-wheel-segment-animate .timer-wheel-prev {
            animation: timerWheelOut 0.28s cubic-bezier(0.2, 0.9, 0.2, 1) both;
        }

        .focus-timer .timer-wheel-segment-animate .timer-wheel-next {
            animation: timerWheelIn 0.28s cubic-bezier(0.2, 0.9, 0.2, 1) both;
        }

        @keyframes timerWheelOut {
            from {
                transform: translateY(-50%) rotateX(0deg);
                opacity: 1;
                filter: blur(0);
            }
            to {
                transform: translateY(-140%) rotateX(65deg);
                opacity: 0.1;
                filter: blur(1.4px);
            }
        }

        @keyframes timerWheelIn {
            from {
                transform: translateY(35%) rotateX(-65deg);
                opacity: 0.15;
                filter: blur(1.4px);
            }
            to {
                transform: translateY(-50%) rotateX(0deg);
                opacity: 1;
                filter: blur(0);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .focus-timer .timer-wheel-segment-animate .timer-wheel-prev,
            .focus-timer .timer-wheel-segment-animate .timer-wheel-next {
                animation: none;
            }
        }
        .focus-timer .timer-controls {
            display:flex;
            gap:6px;
            align-items:center;
            margin-left: 2px;
            padding: 1px;
            border-radius: 12px;
            background: rgba(22, 30, 45, 0.05);
            border: 1px solid rgba(22, 30, 45, 0.08);
        }
        .focus-timer .icon-btn {
            width:32px;
            height:32px;
            display:inline-flex;
            align-items:center;
            justify-content:center;
            border-radius:9px;
            border:1px solid transparent;
            background: transparent;
            color:var(--text-primary);
            cursor:pointer;
            font-size:12px;
            transition: transform 0.12s ease, background 0.16s ease, border-color 0.16s ease;
        }
        .focus-timer .icon-btn:hover{
            transform: translateY(-1px);
            background: rgba(22, 30, 45, 0.08);
            border-color: rgba(22, 30, 45, 0.12);
        }
        .focus-timer .icon-btn.primary{
            background:var(--accent);
            color:#fff;
            border-color:transparent;
        }
        .focus-timer .timer-settings {
            display:none; /* hidden by default to save space */
            flex-direction: column;
            gap:12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
            margin-top: 12px;
            font-size:12px;
            color:var(--text-secondary);
        }
        .focus-timer.expanded .timer-settings{ display:flex; }

        /* Keep timer controls above page rows when dropdowns open inside sidebar */
        .sidebar > .focus-timer {
            position: relative;
            z-index: 8;
        }

        .sidebar > .focus-timer.expanded {
            z-index: 18;
        }

        .sidebar > .focus-timer .timer-settings {
            position: relative;
            z-index: 2;
        }
        
        .timer-presets {
            display: flex;
            gap: 8px;
            justify-content: space-between;
        }
        
        .preset-btn {
            flex: 1;
            min-height: 30px;
            padding: 6px 10px;
            border-radius: 8px;
            border: 1px solid rgba(22, 30, 45, 0.1);
            background: var(--surface-bg);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.16s ease;
        }
        
        .preset-btn:hover {
            background: var(--accent-soft);
            color: var(--text-primary);
            border-color: var(--accent);
        }
        
        .timer-custom-input {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 8px;
            align-items: stretch;
        }

        .timer-audio-settings {
            display: grid;
            gap: 8px;
        }

        .timer-field {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid rgba(22, 30, 45, 0.1);
            background: var(--surface-bg);
            font-size: 11px;
            letter-spacing: 0.06em;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .timer-field--wide {
            align-items: stretch;
            flex-direction: column;
            gap: 7px;
            padding: 8px 9px;
        }

        .timer-field--wide > span {
            font-size: 11px;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .focus-timer .timer-settings input[type="number"]{
            width:100%;
            min-width: 0;
            padding:5px 6px;
            border-radius:6px;
            border:1px solid rgba(22, 30, 45, 0.14);
            background: var(--surface-bg-elevated);
            color:var(--text-primary);
            text-align:center;
            font-weight: 600;
        }
        .focus-timer .timer-settings input[type="number"]:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-soft);
        }

        .focus-timer .timer-settings select {
            width: 100%;
            min-width: 0;
            padding: 7px 8px;
            border-radius: 8px;
            border: 1px solid rgba(22, 30, 45, 0.14);
            background: var(--surface-bg-elevated);
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 600;
        }

        .focus-timer .timer-settings select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-soft);
        }

        #timerSettings .nf-select {
            width: 100%;
            z-index: 2400;
        }

        #timerSettings .nf-select.open {
            z-index: 4200;
        }

        #timerSettings .nf-select .nf-select-trigger {
            min-height: 40px;
            border-radius: 12px;
            border: 1px solid rgba(62, 136, 255, 0.5);
            background: #141b29;
            color: #f3f6fb;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.32);
            -webkit-backdrop-filter: none;
            backdrop-filter: none;
        }

        #timerSettings .nf-select .nf-select-label {
            color: #f6f8fc;
            font-weight: 600;
        }

        #timerSettings .nf-select-menu {
            border-radius: 12px;
            border: 1px solid rgba(96, 165, 250, 0.55);
            background: #050d1b;
            color: #f4f7fc;
            box-shadow: 0 18px 34px rgba(0, 0, 0, 0.52);
            -webkit-backdrop-filter: none;
            backdrop-filter: none;
            z-index: 5000;
        }

        #timerSettings .nf-select-option {
            color: #eef3ff;
            font-size: 13px;
            border-radius: 10px;
        }

        #timerSettings .nf-select-option:hover,
        #timerSettings .nf-select-option:focus-visible {
            background: rgba(96, 165, 250, 0.24);
            color: #ffffff;
            transform: none;
        }

        #timerSettings .nf-select-option.is-selected {
            background: #1e3659;
            color: #ffffff;
            font-weight: 700;
        }

        body:not([data-theme]) #timerSettings .nf-select-menu,
        [data-theme="light"] #timerSettings .nf-select-menu {
            background: #ffffff;
            color: #0f172a;
            border-color: rgba(37, 99, 235, 0.42);
            box-shadow: 0 16px 30px rgba(15, 23, 42, 0.22);
        }

        body:not([data-theme]) #timerSettings .nf-select .nf-select-trigger,
        [data-theme="light"] #timerSettings .nf-select .nf-select-trigger {
            background: #ffffff;
            color: #0f172a;
            border-color: rgba(37, 99, 235, 0.42);
            box-shadow: 0 10px 22px rgba(15, 23, 42, 0.16);
        }

        body:not([data-theme]) #timerSettings .nf-select .nf-select-label,
        [data-theme="light"] #timerSettings .nf-select .nf-select-label {
            color: #0f172a;
        }

        body:not([data-theme]) #timerSettings .nf-select-option,
        [data-theme="light"] #timerSettings .nf-select-option {
            color: #0f172a;
        }

        body:not([data-theme]) #timerSettings .nf-select-option:hover,
        body:not([data-theme]) #timerSettings .nf-select-option:focus-visible,
        [data-theme="light"] #timerSettings .nf-select-option:hover,
        [data-theme="light"] #timerSettings .nf-select-option:focus-visible {
            background: #dbeafe;
            color: #0b1322;
        }

        body:not([data-theme]) #timerSettings .nf-select-option.is-selected,
        [data-theme="light"] #timerSettings .nf-select-option.is-selected {
            background: #bfdbfe;
            color: #0b1322;
        }

        .timer-volume-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .focus-timer .timer-settings input[type="range"] {
            flex: 1;
            margin: 0;
            accent-color: var(--accent);
            cursor: pointer;
        }

        .timer-volume-row output {
            min-width: 42px;
            text-align: right;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 0.02em;
        }
        .focus-timer .timer-progress {
            height:6px;
            background:rgba(22, 30, 45, 0.08);
            border-radius:6px;
            overflow:hidden;
        }
        .focus-timer .timer-progress-bar {
            height:100%;
            width:0%;
            background: linear-gradient(90deg, var(--accent), var(--accent-strong));
            transition:width 0.25s linear;
        }

        [data-theme="dark"] .focus-timer .timer-controls {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.12);
        }

        [data-theme="dark"] .focus-timer .icon-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.16);
        }

        [data-theme="dark"] .preset-btn,
        [data-theme="dark"] .timer-field {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.14);
            color: var(--text-secondary);
        }

        [data-theme="dark"] .focus-timer .timer-settings input[type="number"] {
            background: rgba(10, 10, 10, 0.35);
            border-color: rgba(255, 255, 255, 0.16);
            color: var(--text-primary);
        }

        [data-theme="dark"] .focus-timer .timer-settings select {
            background: rgba(10, 10, 10, 0.35);
            border-color: rgba(255, 255, 255, 0.16);
            color: var(--text-primary);
        }

        [data-theme="dark"] #timerSettings .nf-select .nf-select-trigger {
            background: #101217;
            border-color: rgba(96, 165, 250, 0.5);
            color: #f5f7fb;
        }

        [data-theme="dark"] #timerSettings .nf-select-menu {
            background: #080c12;
            border-color: rgba(96, 165, 250, 0.48);
        }

        .pages-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .page-item {
            padding: 6px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            user-select: none;
            margin: 0 8px;
            border-radius: 8px;
            position: relative;
            min-height: 32px;
            background: var(--surface-bg-elevated);
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }

        .page-item:hover {
            background: var(--surface-bg-hover);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
            border: 1px solid var(--surface-border);
            margin: 0 7px;
        }

        .page-item.active {
            background: var(--surface-bg-active);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            font-weight: 500;
            border: 1px solid var(--surface-border);
            margin: 0 7px;
        }

        /* Visual drop indicators for drag-and-drop reordering */
        .page-item.drop-before::before {
            content: '';
            position: absolute;
            left: 8px;
            right: 8px;
            top: 0;
            height: 0;
            border-top: 3px solid var(--accent);
            border-radius: 3px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
            transform: translateY(-50%);
            pointer-events: none;
        }

        .page-item.drop-after::after {
            content: '';
            position: absolute;
            left: 8px;
            right: 8px;
            bottom: 0;
            height: 0;
            border-bottom: 3px solid var(--accent);
            border-radius: 3px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
            transform: translateY(50%);
            pointer-events: none;
        }

        .page-item.drop-inside {
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border-left: 4px solid var(--accent);
            margin-left: 6px;
            padding-left: 10px;
        }

        .page-title-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .page-star-indicator {
            color: #f1c40f;
            font-size: 10px;
            margin-left: 4px;
            flex-shrink: 0;
        }

        .page-item-icons .fa-star {
            color: var(--text-secondary);
        }

        .page-item-icons .fa-star.starred {
            color: #f1c40f;
        }

        .page-item-icons .fa-star:hover {
            color: #f1c40f;
        }

        .page-icon {
            font-size: 16px;
            cursor: pointer;
            opacity: 1;
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .page-icon:hover {
            transform: scale(1.2);
        }

        .page-icon-empty {
            opacity: 0.5;
        }

        /* Prevent background scroll when modal is open */
        body.modal-open {
            overflow: hidden !important;
            height: 100% !important;
        }

        .page-item-icons {
            margin-left: auto;
            display: none;
            gap: 8px;
            opacity: 0.6;
        }

        .page-item:hover .page-item-icons {
            display: flex;
        }
        
        .page-item-icons i:hover {
            color: var(--text-primary);
            opacity: 1;
        }

        .new-page-btn {
            margin: 16px;
            padding: 10px;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border: 1px dashed var(--surface-border-strong);
            color: var(--text-secondary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 13px;
        }

        .new-page-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--surface-bg-hover);
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        /* Enhanced Todo Styles */
        .sidebar-todo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .todo-filter-btn {
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 6px;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .todo-filter-btn:hover {
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
        }

        .todo-progress-container {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            margin-bottom: 8px;
        }

        .todo-progress-bar {
            flex: 1;
            height: 6px;
            background: var(--glass-01);
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
            border-radius: 6px;
            overflow: hidden;
        }

        .todo-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #27ae60);
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .todo-progress-text {
            font-size: 11px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .todo-filter-panel, .todo-options-panel {
            display: none;
            padding: 12px;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            border: 1px solid var(--surface-border);
            border-radius: 12px;
            margin-bottom: 10px;
            flex-direction: column;
            gap: 8px;
        }

        .todo-filter-panel.active, .todo-options-panel.active {
            display: flex;
        }

        .filter-group, .todo-option-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label, .todo-option-group label {
            font-size: 11px;
            color: var(--text-secondary);
            min-width: 60px;
        }

        .filter-group select, .todo-option-group select,
        .todo-option-group input {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid var(--surface-border);
            border-radius: 8px;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(6px);
            backdrop-filter: blur(6px);
            color: var(--text-primary);
            font-size: 11px;
        }

        .todo-item {
            flex-wrap: wrap;
        }

        .todo-priority-badge {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 8px;
        }

        .priority-high {
            background: #ff4444;
            color: white;
        }

        .priority-medium {
            background: #ffaa00;
            color: #333;
        }

        .priority-low {
            background: #27ae60;
            color: white;
        }

        .todo-meta {
            display: flex;
            gap: 8px;
            width: 100%;
            padding-left: 24px;
            margin-top: 4px;
        }

        .todo-meta-item {
            font-size: 10px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .todo-meta-item.overdue {
            color: #ff4444;
        }

        .todo-category-badge {
            font-size: 9px;
            padding: 2px 6px;
            background: var(--accent);
            color: white;
            border-radius: 10px;
        }

        .top-nav {
            margin: 18px 20px 12px;
            padding: 16px 22px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 18px;
            border-radius: var(--radius-lg);
            position: sticky;
            top: 12px;
            z-index: 1200;
        }

        .nav-left,
        .nav-right {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .nav-left {
            flex-wrap: wrap;
        }

        .app-brand {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .brand-label {
            font-family: var(--font-heading);
            font-size: 20px;
            letter-spacing: 0.01em;
        }

        .brand-sub {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--text-muted);
        }

        .nav-divider {
            width: 1px;
            height: 32px;
            background: var(--border);
            opacity: 0.6;
        }

        .tabs-shell {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 0;
        }

        .view-tabs {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px;
            border-radius: 999px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            -webkit-backdrop-filter: blur(18px) saturate(160%);
            backdrop-filter: blur(18px) saturate(160%);
            box-shadow: 0 10px 24px rgba(22, 30, 45, 0.1);
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            max-width: min(100vw - 420px, 1120px);
            scrollbar-width: thin;
        }

        .view-tab {
            border: none;
            background: transparent;
            padding: 6px 12px;
            border-radius: var(--radius-pill);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.09em;
            line-height: 1;
            color: var(--text-secondary);
            cursor: pointer;
            transition: background var(--transition-fast), color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast);
        }

        .view-tab.active {
            background: var(--bg-hover);
            color: var(--text-primary);
            box-shadow: inset 0 0 0 1px rgba(184, 134, 11, 0.2), 0 4px 10px rgba(20,16,12,0.1);
        }

        .view-tab:hover:not(.active) {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        @media (min-width: 1025px) {
            .view-tabs > .view-tab[data-view="settings"] {
                margin-left: auto;
            }
        }

        @media (max-width: 1024px) {
            .view-tabs > .view-tab[data-view="settings"] {
                margin-left: 0;
            }
        }

        .tabs-shell .tab-clock-embed {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-height: 38px;
            padding: 3px 10px 3px 12px;
            margin-left: 4px;
            border-radius: 999px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            -webkit-backdrop-filter: blur(18px) saturate(160%);
            backdrop-filter: blur(18px) saturate(160%);
            box-shadow: inset 0 1px 0 var(--neumo-inset-light), 0 8px 18px rgba(22, 30, 45, 0.08);
            position: relative;
            flex-shrink: 0;
        }

        .tabs-shell .tab-clock-main {
            display: inline-flex;
            align-items: center;
            gap: 9px;
            line-height: 1;
        }

        .tabs-shell .tab-clock-icon {
            color: var(--accent);
            font-size: 14px;
        }

        .tabs-shell .toolbar-time-widget {
            min-width: 82px;
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            text-align: left;
            letter-spacing: 0.01em;
            display: inline-block;
            padding: 0;
        }

        .tabs-shell .tab-clock-gear {
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 8px;
            background: var(--bg-hover);
            color: var(--text-secondary);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(22, 30, 45, 0.12);
            transition: color var(--transition-fast), background var(--transition-fast), box-shadow var(--transition-fast);
        }

        .tabs-shell .tab-clock-gear i {
            font-size: 13px;
        }

        .tabs-shell .tab-clock-gear:hover {
            color: var(--text-primary);
            background: var(--surface-bg-active);
            box-shadow: 0 6px 12px rgba(22, 30, 45, 0.14);
        }

        .quick-app-launchers {
            display: none;
            align-items: center;
            gap: 6px;
            margin-left: 2px;
        }

        .quick-app-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 7px 12px;
            background: var(--bg-secondary);
            -webkit-backdrop-filter: blur(18px) saturate(160%);
            backdrop-filter: blur(18px) saturate(160%);
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            cursor: pointer;
            transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
        }

        .quick-app-btn:hover {
            background: var(--bg-hover);
            box-shadow: 0 8px 18px rgba(22, 30, 45, 0.14);
        }

        .quick-app-btn i {
            font-size: 13px;
        }

        .quick-app-btn.spotify i {
            color: #1db954;
        }

        .quick-app-btn.chatgpt i {
            color: #10a37f;
        }

        [data-theme="dark"] .quick-app-btn {
            border-color: rgba(255, 255, 255, 0.1);
            background: linear-gradient(165deg, rgba(20, 19, 18, 0.62), rgba(20, 19, 18, 0.44));
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06), 0 8px 18px rgba(0, 0, 0, 0.34);
        }

        [data-theme="dark"] .tabs-shell .tab-clock-embed {
            border-color: rgba(255, 255, 255, 0.1);
            background: linear-gradient(165deg, rgba(20, 19, 18, 0.62), rgba(20, 19, 18, 0.44));
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06), 0 8px 18px rgba(0, 0, 0, 0.34);
        }

        [data-theme="dark"] .tabs-shell .tab-clock-gear {
            background: linear-gradient(165deg, rgba(34, 31, 28, 0.72), rgba(20, 19, 18, 0.56));
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.42);
        }

        .global-search {
            min-width: 220px;
        }

        .view {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: 8px 28px 28px;
        }

        .view.active {
            display: block;
        }

        .view-notes {
            /* Reduced top padding so the fixed toolbar no longer creates a large empty gap
               The toolbar is fixed; we keep a small breathing room but avoid the huge 128px gap. */
            padding-top: 24px;
        }

        /* Progress view (compact dashboard) */
        .view-progress {
            display: none; /* views are controlled by .view.active */
            flex-direction: column;
            gap: 12px;
            padding-top: 12px;
        }

    .view-progress .view-header { margin-bottom: 10px; }
    /* When Progress is merged into Today, ensure Today view headers match Progress spacing */
    #view-today .view-header { margin-bottom: 10px; }

        .stats-grid .glass-card {
            padding: 18px;
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        @media (max-width: 900px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); grid-auto-rows: auto; }
        }

        @media (max-width: 600px) {
            .stats-grid { grid-template-columns: 1fr; }
        }

        .view-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-end;
            gap: 20px;
            margin-bottom: 18px;
        }

        .view-header h2 {
            font-size: 30px;
            margin: 0;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .eyebrow {
            text-transform: uppercase;
            letter-spacing: 0.2em;
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .summary-card {
            padding: 22px 20px;
            border-radius: 18px;
            background: var(--surface-bg-elevated);
            box-shadow: 0 12px 32px rgba(0,0,0,0.06);
        }

        .summary-label {
            font-size: 12px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .summary-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
            letter-spacing: -0.01em;
        }

        .summary-meta {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .today-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 360px;
            gap: 20px;
            align-items: start;
        }

        @media (max-width: 900px) {
            .today-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .today-panel {
            padding: 22px;
            display: flex;
            flex-direction: column;
            gap: 14px;
            min-height: 260px;
            border-radius: 18px;
            background: var(--glass-01);
            box-shadow: 0 18px 40px rgba(0,0,0,0.06);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .panel-header h3 { font-size: 18px; margin:0; }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .task-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 14px 18px;
            border-radius: 16px;
            background: var(--surface-bg-elevated);
            border: 1px solid var(--surface-border);
            border-left: 4px solid transparent;
            box-shadow: 0 10px 28px rgba(0,0,0,0.06);
            transition: transform 180ms var(--transition-fast), box-shadow 180ms var(--transition-fast);
        }

        .task-card:hover { transform: translateY(-6px); box-shadow: 0 18px 40px rgba(0,0,0,0.09); }

        .task-card.task-priority-high {
            border-left-color: #d32f2f;
            background: linear-gradient(90deg, rgba(211, 47, 47, 0.08), rgba(211, 47, 47, 0.02) 38%, var(--surface-bg-elevated) 100%);
        }

        .task-card.task-priority-medium {
            border-left-color: #f57c00;
            background: linear-gradient(90deg, rgba(245, 124, 0, 0.08), rgba(245, 124, 0, 0.02) 38%, var(--surface-bg-elevated) 100%);
        }

        .task-card.task-priority-low {
            border-left-color: #2e7d32;
            background: linear-gradient(90deg, rgba(46, 125, 50, 0.07), rgba(46, 125, 50, 0.02) 38%, var(--surface-bg-elevated) 100%);
        }

        [data-theme="dark"] .task-card.task-priority-high {
            background: linear-gradient(90deg, rgba(211, 47, 47, 0.22), rgba(211, 47, 47, 0.06) 40%, rgba(20,19,18,0.82) 100%);
        }

        [data-theme="dark"] .task-card.task-priority-medium {
            background: linear-gradient(90deg, rgba(245, 124, 0, 0.2), rgba(245, 124, 0, 0.06) 40%, rgba(20,19,18,0.82) 100%);
        }

        [data-theme="dark"] .task-card.task-priority-low {
            background: linear-gradient(90deg, rgba(46, 125, 50, 0.2), rgba(46, 125, 50, 0.06) 40%, rgba(20,19,18,0.82) 100%);
        }

        .task-card.completed {
            opacity: 0.65;
            text-decoration: line-through;
        }

        .task-main {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .task-title {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 15px;
            line-height: 1.25;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .task-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .task-actions {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .habit-add-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .habit-add-row .neumo-input {
            flex: 1;
            min-width: 0;
        }

        .empty-state {
            padding: 14px;
            border-radius: var(--radius);
            background: var(--surface-bg);
            text-align: center;
        }

        .empty-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .empty-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Quick actions UI removed */

        /* Linked task panel removed  styles cleared */


        .stats-grid {
            display: grid;
            gap: 18px;
            grid-template-columns: repeat(2, 1fr);
            grid-auto-rows: minmax(160px, 260px);
            width: 100%;
            max-width: 1200px; /* keep dashboard content from stretching to full page width */
            align-items: start; /* prevent cards from stretching to full height */
            margin: 8px 20px 40px; /* breathing room above/below */
        }

        .glass-card {
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 140px;
            background: var(--glass-01);
            border-radius: 14px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-soft);
        }

        .bar-chart {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            align-items: end;
            height: 120px;
        }

        .bar {
            width: 100%;
            border-radius: 10px;
            background: var(--accent-soft);
            position: relative;
        }

        .bar span {
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: var(--text-secondary);
        }

        .streak-stats,
        .category-stats {
            display: grid;
            gap: 10px;
        }

        .history-list {
            display: grid;
            gap: 8px;
            /* keep the recent history column scrollable and constrained */
            max-height: 520px;
            overflow-y: auto;
            padding-right: 6px;
        }

        /* Responsive: fall back to stacked layout on narrower screens */
        @media (max-width: 1100px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
                max-width: 100%;
                margin: 8px 12px 40px;
            }
        }

        /* Small helpers for dashboard placeholders */
        .card-content { display:flex; flex:1; gap:12px; align-items:center; }
        .sparkline { flex:1; height:48px; background: linear-gradient(90deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01)); border-radius:6px; display:flex; align-items:center; justify-content:center; color:var(--text-secondary); }
        .heatmap-placeholder { flex:1; height:110px; background: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01)); border-radius:8px; display:flex; align-items:center; justify-content:center; color:var(--text-secondary); }
        .donut-placeholder { width:84px; height:84px; border-radius:50%; background: conic-gradient(var(--accent) 0 25%, #6c5ce7 0 55%, #00b894 0 100%); box-shadow: inset 0 -6px 12px rgba(0,0,0,0.06); }
        .legend { display:flex; flex-direction:column; gap:6px; color:var(--text-secondary); font-size:13px; }
        .legend-item { display:flex; justify-content:space-between; gap:12px; align-items:center; }
        .legend-color { width:12px; height:12px; border-radius:3px; display:inline-block; margin-right:8px; }
        .card-stat { font-size:22px; font-weight:700; color:var(--text-primary); }
        .card-meta { font-size:13px; color:var(--text-secondary); }

        .settings-grid {
            display: grid;
            gap: 18px;
            grid-template-columns: 1fr;
            align-items: start;
        }

        .settings-main-stack {
            display: grid;
            gap: 18px;
        }

        .settings-feature-rail {
            align-self: start;
        }

        .settings-card {
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-self: start;
            height: auto;
        }

        @media (min-width: 1180px) {
            #view-settings .settings-grid {
                grid-template-columns: minmax(340px, 1fr) minmax(360px, 440px);
                grid-template-rows: auto auto;
                column-gap: 18px;
                row-gap: 18px;
                align-items: start;
            }

            #view-settings .settings-main-stack-top {
                grid-column: 1;
                grid-row: 1;
            }

            #view-settings .settings-main-stack-bottom {
                grid-column: 1;
                grid-row: 2;
            }

            #view-settings .settings-feature-rail {
                grid-column: 2;
                grid-row: 1 / span 2;
                align-self: start;
            }
        }

        .settings-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .settings-row-calendar-sync {
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-start;
        }

        #view-settings .settings-row-calendar-sync .modal-input {
            flex: 1 1 220px;
            max-width: 320px;
            min-width: 180px;
            margin: 0;
        }

        .settings-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .settings-actions .neumo-btn.active {
            background: var(--accent-soft);
            box-shadow: inset 2px 2px 6px var(--neumo-inset-dark), inset -2px -2px 6px var(--neumo-inset-light);
            color: var(--text-primary);
        }

        .settings-help {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .settings-toggle {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .feature-toggle-list {
            display: grid;
            gap: 10px;
        }

        .feature-toggle-list-onboarding {
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
        }

        .feature-toggle-card {
            position: relative;
            display: grid;
            grid-template-columns: 38px minmax(0, 1fr) auto;
            align-items: center;
            gap: 12px;
            min-height: 70px;
            padding: 12px;
            border-radius: 14px;
            border: 1px solid rgba(17, 24, 39, 0.14);
            background: var(--surface-bg-elevated);
            box-shadow: 0 8px 20px rgba(17, 24, 39, 0.08);
            cursor: pointer;
            transition: border-color 160ms ease, box-shadow 160ms ease, transform 160ms ease, background 160ms ease;
        }

        .feature-toggle-card:hover {
            transform: translateY(-1px);
            border-color: rgba(184, 134, 11, 0.4);
            box-shadow: 0 10px 22px rgba(17, 24, 39, 0.12);
        }

        .feature-toggle-card[data-checked="true"] {
            border-color: rgba(184, 134, 11, 0.55);
            background: linear-gradient(180deg, rgba(184, 134, 11, 0.14), var(--surface-bg-elevated));
            box-shadow: 0 12px 24px rgba(184, 134, 11, 0.16);
        }

        .feature-toggle-input {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }

        .feature-toggle-icon {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(184, 134, 11, 0.14);
            color: var(--accent);
            transition: background 160ms ease, color 160ms ease, transform 160ms ease;
        }

        .feature-toggle-icon i {
            font-size: 14px;
        }

        .feature-toggle-copy {
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .feature-toggle-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.25;
        }

        .feature-toggle-description {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.35;
        }

        .feature-toggle-switch {
            width: 46px;
            height: 26px;
            border-radius: 999px;
            border: 1px solid rgba(17, 24, 39, 0.18);
            background: rgba(17, 24, 39, 0.12);
            display: inline-flex;
            align-items: center;
            padding: 3px;
            transition: background 160ms ease, border-color 160ms ease, box-shadow 160ms ease;
        }

        .feature-toggle-switch-handle {
            width: 18px;
            height: 18px;
            border-radius: 999px;
            background: #ffffff;
            box-shadow: 0 2px 6px rgba(17, 24, 39, 0.24);
            transition: transform 160ms ease;
        }

        .feature-toggle-input:checked ~ .feature-toggle-icon {
            background: rgba(184, 134, 11, 0.85);
            color: #ffffff;
            transform: scale(1.03);
        }

        .feature-toggle-input:checked ~ .feature-toggle-switch {
            background: rgba(184, 134, 11, 0.85);
            border-color: rgba(184, 134, 11, 0.95);
            box-shadow: 0 0 0 2px rgba(184, 134, 11, 0.2);
        }

        .feature-toggle-input:checked ~ .feature-toggle-switch .feature-toggle-switch-handle {
            transform: translateX(20px);
        }

        .feature-toggle-input:focus-visible ~ .feature-toggle-switch {
            box-shadow: 0 0 0 3px rgba(58, 137, 255, 0.24);
            border-color: rgba(58, 137, 255, 0.5);
        }

        body.feature-setup-open {
            overflow: hidden;
        }

        .feature-setup-overlay {
            position: fixed;
            inset: 0;
            z-index: 12600;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .feature-setup-overlay.active {
            display: flex;
        }

        .feature-setup-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(8, 13, 21, 0.56);
            backdrop-filter: blur(3px);
        }

        .feature-setup-card {
            position: relative;
            width: min(860px, calc(100vw - 32px));
            max-height: min(88vh, 760px);
            overflow: auto;
            border-radius: 22px;
            border: 1px solid var(--border);
            background: var(--surface-bg-elevated);
            box-shadow: 0 30px 70px rgba(17, 24, 39, 0.35);
            padding: 22px;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .feature-setup-card h2 {
            margin: 0;
            font-size: clamp(24px, 3.2vw, 34px);
            letter-spacing: -0.015em;
        }

        .feature-setup-card p {
            margin: 0;
            color: var(--text-secondary);
            line-height: 1.45;
        }

        .feature-setup-note {
            margin-top: 4px;
            font-size: 12px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: var(--text-secondary);
        }

        .feature-setup-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .feature-setup-actions .neumo-btn {
            min-width: 132px;
        }

        @media (max-width: 900px) {
            .feature-toggle-list-onboarding {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 640px) {
            .feature-setup-overlay {
                padding: 12px;
            }

            .feature-setup-card {
                width: min(560px, calc(100vw - 24px));
                max-height: calc(100vh - 24px);
                padding: 16px;
                border-radius: 16px;
            }

            .feature-toggle-card {
                min-height: 66px;
                padding: 10px;
                grid-template-columns: 34px minmax(0, 1fr) auto;
            }

            .feature-toggle-description {
                font-size: 11px;
            }
        }

        .tutorial-overlay {
            position: fixed;
            inset: 0;
            display: none;
            z-index: 12000;
        }

        .tutorial-overlay.active {
            display: block;
        }

        .tutorial-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(12, 15, 21, 0.42);
        }

        .tutorial-spotlight {
            position: fixed;
            border-radius: 14px;
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 0 9999px rgba(12, 15, 21, 0.64), 0 10px 36px rgba(0, 0, 0, 0.32);
            pointer-events: none;
            transition: top 0.2s ease, left 0.2s ease, width 0.2s ease, height 0.2s ease;
            z-index: 12005;
        }

        .tutorial-card {
            position: fixed;
            width: min(420px, calc(100vw - 32px));
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 18px 48px rgba(0, 0, 0, 0.28);
            z-index: 12010;
        }

        .tutorial-card.centered {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .tutorial-card h3 {
            margin: 0 0 8px;
            font-size: 20px;
        }

        .tutorial-card p {
            margin: 0;
            color: var(--text-secondary);
            line-height: 1.45;
            font-size: 14px;
        }

        .tutorial-step {
            margin-bottom: 8px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            color: var(--accent);
        }

        .tutorial-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 14px;
        }

        #tutorialActionBtn {
            background: var(--accent-soft);
        }

        .tutorial-actions .neumo-btn[disabled] {
            opacity: 0.45;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .tutorial-card {
                width: calc(100vw - 24px);
                padding: 14px;
            }
        }

        .weekday-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .weekday-selector label {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: var(--radius-pill);
            background: var(--neumo-bg);
            box-shadow: inset 2px 2px 4px var(--neumo-inset-dark), inset -2px -2px 4px var(--neumo-inset-light);
            font-size: 12px;
            color: var(--text-secondary);
        }

        @media (max-width: 960px) {
            .top-nav {
                flex-direction: column;
                align-items: flex-start;
            }

            .nav-right {
                width: 100%;
                flex-wrap: wrap;
            }

            .global-search {
                flex: 1;
                min-width: 160px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.001ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.001ms !important;
                scroll-behavior: auto !important;
            }
        }

    .toolbar-wrapper {
            /* Floating pill-shaped toolbar separated from the sidebar and screen edges */
            position: fixed;
                /* place the toolbar just below the top nav using a CSS variable for robustness */
                /* add extra breathing room between the tab switcher (top-nav) and the floating toolbar */
                top: calc(var(--top-nav-height) + 20px);
            left: calc(var(--sidebar-width) + 16px); /* keep gap from sidebar */
            right: 16px; /* gap from right edge */
            max-width: calc(100% - (var(--sidebar-width) + 32px));
            height: 56px;
            z-index: 1150; /* float above most UI but below top nav */
            display: flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 999px; /* pill */
            /* Frosted glass background tuned for a pill look */
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(16px) saturate(140%);
            backdrop-filter: blur(16px) saturate(140%);
            border: 1px solid var(--glass-border, rgba(0,0,0,0.06));
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            transition: left 0.25s ease, right 0.25s ease, max-width 0.25s ease, background 0.2s ease, top 0.2s ease;
        }

    [data-theme="dark"] .toolbar-wrapper,
        [data-theme="tokyo-night"] .toolbar-wrapper,
        [data-theme="dracula"] .toolbar-wrapper,
        [data-theme="nord"] .toolbar-wrapper,
        [data-theme="monokai"] .toolbar-wrapper,
        [data-theme="gruvbox"] .toolbar-wrapper,
        [data-theme="solarized-dark"] .toolbar-wrapper,
        [data-theme="one-dark"] .toolbar-wrapper,
        [data-theme="midnight-blue"] .toolbar-wrapper,
        [data-theme="ocean-dark"] .toolbar-wrapper {
            /* Make dark theme toolbar mostly transparent but keep a subtle tint */
            background: rgba(30, 30, 40, 0.04);
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        /* When sidebar is collapsed, keep the floating pill offset from the viewport edge */
        .sidebar.collapsed ~ .main-content .toolbar-wrapper,
        body:has(.sidebar.collapsed) .toolbar-wrapper {
            left: 16px;
            max-width: calc(100% - 32px);
        }

    .toolbar-scroll-btn {
            /* position the scroll buttons inside the fixed toolbar so they don't overlap the sidebar */
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            /* make scroll buttons more subtle */
            background: var(--surface-bg);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.18s ease;
            opacity: 0;
            pointer-events: none;
            border-radius: 8px;
            z-index: 12; /* above toolbar content but below sidebar and major overlays */
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .toolbar-scroll-btn:hover {
            background: var(--surface-bg-hover);
            color: var(--accent);
        }

        .toolbar-scroll-btn.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .toolbar-scroll-btn i {
            font-size: 12px;
        }

        .toolbar-scroll-btn.left { left: 8px; }
        .toolbar-scroll-btn.right { right: 8px; }

        .toolbar {
            padding: 0 8px;
            display: flex;
            flex: 1 1 auto;
            gap: 12px;
            align-items: center;
            height: 100%;
            background: transparent; /* wrapper provides the pill background */
            overflow-x: auto;
            overflow-y: visible;
            scroll-behavior: smooth;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }

        /* Mobile: revert to a compact full-width top bar to avoid overlapping content */
        @media (max-width: 640px) {
            .toolbar-wrapper {
                left: 0 !important;
                right: 0 !important;
                /* on narrow screens place the toolbar under the mobile top nav height */
                top: calc(var(--top-nav-height-mobile));
                height: 64px;
                padding: 6px 10px;
                border-radius: 0 0 12px 12px; /* slight rounding at bottom */
                max-width: none;
                box-shadow: 0 6px 20px rgba(0,0,0,0.12);
            }

            /* Hide scroll buttons on very small screens to avoid floating circles */
            .toolbar-scroll-btn {
                display: none;
            }

            .toolbar {
                padding: 0 10px;
                gap: 8px;
                height: 100%;
                align-items: center;
            }

            /* Slightly reduce button sizes for mobile */
            .toolbar-btn {
                padding: 8px 10px;
                font-size: 14px;
            }
        }

        .toolbar-btn {
            /* make toolbar buttons mostly transparent to reduce visual weight */
            background: var(--surface-bg);
            border: 1px solid var(--surface-border);
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px 10px;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 14px;
            -webkit-backdrop-filter: blur(6px);
            backdrop-filter: blur(6px);
        }

        .toolbar-btn:hover {
            background: var(--surface-bg-hover);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        /* Breadcrumbs */
        .breadcrumbs {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .breadcrumb-link {
            color: var(--text-secondary);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 4px 8px;
            border-radius: 6px;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }

        .breadcrumb-link:hover {
            color: var(--accent);
            background: var(--surface-bg-hover);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
        }

        .breadcrumb-separator {
            color: var(--border);
        }

        .breadcrumb-current {
            color: var(--text-primary);
            font-weight: 500;
        }

        .page-title-input {
            width: 100%;
            border: none;
            font-size: 36px;
            font-weight: 700;
            /* tighten the title spacing so the heading appears closer to the toolbar */
            margin-top: 12px;
            margin-bottom: 16px;
            background: transparent;
            color: var(--text-primary);
            outline: none;
            font-family: inherit;
        }

        .page-title-input::placeholder {
            color: var(--border);
        }

        /* Media container styles */
        .media-container {
            position: relative;
            margin: 16px 0;
            border-radius: 12px;
            overflow: visible;
            background: var(--glass-01);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border: 1px solid var(--glass-border);
        }
        
        .media-container video,
        .media-container audio {
            display: block;
        }
        
        .media-container iframe {
            background: transparent;
        }
        
        /* Media action button */
        .media-action-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 4px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-secondary);
            z-index: 20;
            transition: all 0.2s ease;
        }
        
        .media-container:hover .media-action-btn,
        .resizable-media:hover .media-action-btn,
        .media-wrapper:hover .media-action-btn {
            display: flex;
        }
        
        .media-action-btn:hover {
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
        }
        
        /* Media dropdown menu */
        .media-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            background: var(--surface-bg-elevated);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(22, 30, 45, 0.16);
            border-radius: 12px;
            box-shadow: 0 12px 30px rgba(22, 30, 45, 0.2);
            min-width: 160px;
            z-index: 100;
            display: none;
            overflow: hidden;
        }
        
        .media-dropdown.active {
            display: block;
        }

        [data-theme="dark"] .media-dropdown {
            background: rgba(20, 19, 18, 0.88);
            border: 1px solid rgba(255, 255, 255, 0.14);
        }
        
        .media-dropdown-item {
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-primary);
            transition: all 0.15s ease;
        }
        
        .media-dropdown-item:hover {
            background: rgba(22, 30, 45, 0.08);
        }
        
        .media-dropdown-item i {
            width: 16px;
            color: var(--text-secondary);
        }
        
        .media-dropdown-item.danger {
            color: #dc2626;
        }
        
        .media-dropdown-item.danger i {
            color: #dc2626;
        }
        
        .media-dropdown-divider {
            height: 1px;
            background: var(--border);
            margin: 4px 0;
        }

        /* Resizable media and images */
        .resizable-media {
            position: relative;
            display: inline-block;
            max-width: 100%;
        }
        
        .resizable-media img,
        .resizable-media video,
        .resizable-media iframe {
            display: block;
            max-width: 100%;
        }
        
        .resizable-media:hover .resize-handle,
        .resizable-media.resizing .resize-handle {
            opacity: 1;
        }
        
        .resize-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--accent);
            border: 2px solid white;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 20;
            cursor: nwse-resize;
        }
        
        .resize-handle.se {
            bottom: -6px;
            right: -6px;
        }
        
        .resize-handle.sw {
            bottom: -6px;
            left: -6px;
            cursor: nesw-resize;
        }
        
        .resizable-media::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 2px solid transparent;
            border-radius: 4px;
            pointer-events: none;
            transition: border-color 0.2s ease;
        }
        
        .resizable-media:hover::before,
        .resizable-media.resizing::before {
            border-color: var(--accent);
        }
        
        .resizable-media .size-indicator {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }
        
        .resizable-media.resizing .size-indicator {
            opacity: 1;
        }

        /* Tags System */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 8px 0;
            margin-bottom: 12px;
            align-items: center;
        }
        
        .tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 5px 12px;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border: 1px solid var(--surface-border);
            border-radius: 14px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tag:hover {
            background: rgba(var(--accent-rgb, 66, 153, 225), 0.6);
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            color: white;
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .tag .tag-remove {
            font-size: 10px;
            opacity: 0.7;
            margin-left: 2px;
        }
        
        .tag .tag-remove:hover {
            opacity: 1;
        }
        
        .tag-input-wrapper {
            display: inline-flex;
            align-items: center;
        }
        
        .tag-input {
            border: none;
            background: transparent;
            outline: none;
            font-size: 12px;
            color: var(--text-primary);
            padding: 4px 8px;
            min-width: 80px;
        }
        
        .tag-input::placeholder {
            color: var(--text-secondary);
        }
        
        .add-tag-btn {
            background: none;
            border: 1px dashed var(--border);
            border-radius: 12px;
            padding: 4px 10px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s ease;
        }
        
        .add-tag-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        
        /* Tag colors */
        .tag[data-color="red"] { background: #fee2e2; color: #dc2626; border-color: #fca5a5; }
        .tag[data-color="orange"] { background: #ffedd5; color: #ea580c; border-color: #fdba74; }
        .tag[data-color="yellow"] { background: #fef9c3; color: #ca8a04; border-color: #fde047; }
        .tag[data-color="green"] { background: #dcfce7; color: #16a34a; border-color: #86efac; }
        .tag[data-color="blue"] { background: #dbeafe; color: #2563eb; border-color: #93c5fd; }
        .tag[data-color="purple"] { background: #f3e8ff; color: #9333ea; border-color: #d8b4fe; }
        .tag[data-color="pink"] { background: #fce7f3; color: #db2777; border-color: #f9a8d4; }
        .tag[data-color="gray"] { background: #f3f4f6; color: #4b5563; border-color: #d1d5db; }
        
        /* Dark theme tag adjustments */
        [data-theme="dark"] .tag[data-color="red"] { background: #7f1d1d; color: #fca5a5; border-color: #991b1b; }
        [data-theme="dark"] .tag[data-color="orange"] { background: #7c2d12; color: #fdba74; border-color: #9a3412; }
        [data-theme="dark"] .tag[data-color="yellow"] { background: #713f12; color: #fde047; border-color: #854d0e; }
        [data-theme="dark"] .tag[data-color="green"] { background: #14532d; color: #86efac; border-color: #166534; }
        [data-theme="dark"] .tag[data-color="blue"] { background: #1e3a5f; color: #93c5fd; border-color: #1e40af; }
        [data-theme="dark"] .tag[data-color="purple"] { background: #581c87; color: #d8b4fe; border-color: #6b21a8; }
        [data-theme="dark"] .tag[data-color="pink"] { background: #831843; color: #f9a8d4; border-color: #9d174d; }
        [data-theme="dark"] .tag[data-color="gray"] { background: #374151; color: #d1d5db; border-color: #4b5563; }
        
        /* Sidebar tag filter */
        .sidebar-tags-filter {
            padding: 8px 16px;
            border-bottom: 1px solid var(--border);
        }
        
        .sidebar-tags-filter-title {
            font-size: 11px;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .sidebar-tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        
        .sidebar-tag {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            cursor: pointer;
            background: var(--glass-01);
            -webkit-backdrop-filter: blur(6px);
            backdrop-filter: blur(6px);
            color: var(--text-secondary);
            border: 1px solid var(--glass-border);
            transition: all 0.2s ease;
        }
        
        .sidebar-tag:hover,
        .sidebar-tag.active {
            border-color: var(--accent);
            color: var(--accent);
        }
        
        .sidebar-tag.active {
            background: var(--accent);
            color: white;
        }

        /* Slash Commands Menu - Liquid Glass */
        .slash-menu {
            position: absolute;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid var(--surface-border);
            border-radius: 14px;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.2);
            max-height: 320px;
            overflow-y: auto;
            z-index: 1000;
            width: 280px;
            display: none;
        }
        
        .slash-menu.active {
            display: block;
        }
        
        .slash-menu-header {
            padding: 10px 14px;
            font-size: 11px;
            text-transform: uppercase;
            color: var(--text-secondary);
            font-weight: 600;
            border-bottom: 1px solid var(--surface-border);
            background: var(--surface-bg);
        }
        
        .slash-menu-item {
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background 0.15s ease;
        }
        
        .slash-menu-item:hover,
        .slash-menu-item.selected {
            background: var(--surface-bg-hover);
        }
        
        .slash-menu-item-icon {
            width: 36px;
            height: 36px;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--text-secondary);
            border: 1px solid var(--surface-border);
        }
        
        .slash-menu-item-content {
            flex: 1;
        }
        
        .slash-menu-item-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .slash-menu-item-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .slash-menu-empty {
            padding: 20px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 13px;
        }

        /* Status Bar - Hidden, moved to bottom taskbar */
        .status-bar {
            display: none;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Theme Switcher Button - Liquid Glass */
        .theme-switcher-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            backdrop-filter: blur(16px) saturate(180%);
            color: var(--accent);
            border: 1px solid var(--surface-border);
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            transition: transform 0.2s, background 0.2s;
        }

        .theme-switcher-btn:hover {
            transform: scale(1.1);
            background: var(--surface-bg-hover);
        }

        /* Theme Panel - Liquid Glass */
        .theme-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid var(--surface-border);
            border-radius: 16px;
            padding: 20px;
            width: 320px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 200;
            box-shadow: 0 16px 64px rgba(0, 0, 0, 0.2);
            display: none;
            animation: slideIn 0.3s ease;
        }

        .theme-panel.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }



        .theme-panel-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .theme-panel-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .apply-mode-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .mode-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--surface-border);
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .mode-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .page-selector {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border-radius: 12px;
            border: 1px solid var(--surface-border);
        }

        .page-selector.active {
            display: block;
        }

        .page-selector-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }

        .page-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px;
            margin-bottom: 4px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .page-checkbox:hover {
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(6px);
            backdrop-filter: blur(6px);
        }

        .page-checkbox input[type="checkbox"] {
            cursor: pointer;
        }

        .theme-presets {
            margin-bottom: 20px;
        }

        .preset-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-secondary);
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .preset-card {
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .preset-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .preset-card.active {
            border-color: var(--accent);
        }

        .preset-card.active::after {
            content: '';
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--accent);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .preset-preview {
            display: flex;
            gap: 2px;
            margin-bottom: 8px;
            height: 30px;
        }

        .preset-color {
            flex: 1;
            border-radius: 4px;
        }

        .preset-name {
            font-size: 12px;
            font-weight: 500;
        }

        .custom-colors {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .color-input-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .color-input-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-input-item label {
            font-size: 12px;
            color: var(--text-secondary);
            flex: 1;
        }

        .color-input-item input[type="color"] {
            width: 40px;
            height: 30px;
            border: 1px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
        }

        /* Font Settings */
        .font-settings, .animation-settings {
            margin-top: 15px;
        }

        .font-input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .font-input-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .font-input-item label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .font-input-item select {
            padding: 6px 10px;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            background: var(--glass-01);
            color: var(--text-primary);
            font-size: 12px;
            cursor: pointer;
            min-width: 140px;
            -webkit-backdrop-filter: blur(6px);
            backdrop-filter: blur(6px);
        }

        /* Animation Toggle */
        .animation-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
        }

        @media (max-width: 640px) {
            .font-input-item {
                flex-wrap: wrap;
            }
            .font-input-item select {
                min-width: 0;
                width: 100%;
            }
            .font-settings, .animation-settings {
                max-width: 100%;
                overflow: hidden;
            }
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--accent);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        body.animations-enabled .page-item {
            animation: slideIn 0.2s ease;
        }

        body.animations-enabled .todo-item {
            animation: slideUp 0.2s ease;
        }

        body.animations-enabled .modal.active .modal-content {
            animation: scaleIn 0.2s ease;
        }

        body.animations-enabled .editor-container {
            animation: fadeIn 0.3s ease;
        }

        .theme-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .reset-theme-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--glass-border);
            background: var(--glass-01);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
        }

        .reset-theme-btn:hover {
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            min-width: var(--sidebar-width);
            background: var(--glass-01);
            -webkit-backdrop-filter: blur(20px) saturate(160%);
            backdrop-filter: blur(20px) saturate(160%);
            border-right: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow: hidden;
            position: relative;
            z-index: 1200;
            transition: width 0.3s ease, min-width 0.3s ease, background-color 0.3s ease;
        }

        /* Rendering/compositing hints to avoid transient artifacts (vertical streaks) on some GPUs/browsers */
        .sidebar, .app-container, .pages-list, .page-item, .emoji-picker, .modal-content {
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            will-change: transform, opacity;
        }

        .sidebar.collapsed {
            width: 0;
            min-width: 0;
            margin-left: 0;
            border-right: none;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
            background: transparent;
        }

        .workspace-name {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .page-item {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 2px;
            transition: background 0.2s;
            position: relative;
        }
        
        .page-item .page-item-icons {
            display: none;
            align-items: center;
            gap: 8px;
        }
        
        .page-item:hover .page-item-icons {
            display: flex;
        }

        .page-item:hover {
            background: var(--bg-hover);
        }

        .page-item.active {
            background: var(--bg-hover);
        }

        .page-item i {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .page-item-icons i {
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        
        .page-item-icons i:hover {
            opacity: 1;
        }

        .page-theme-indicator {
            position: absolute;
            right: 12px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid var(--border);
        }
        
        .page-item:hover .page-theme-indicator {
            display: none;
        }


        .add-page-btn {
            width: 100%;
            padding: 8px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .add-page-btn:hover {
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--editor-bg);
            transition: background-color 0.3s ease;
            min-width: 0;
            position: relative;
        }

        .toolbar {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--bg-primary);
            transition: background-color 0.3s ease;
            overflow-x: auto;
            scroll-behavior: smooth;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .toolbar::-webkit-scrollbar {
            display: none;
        }

        /* If toolbar is inside the fixed toolbar-wrapper use transparent background
           (wrapper provides the frosted glass) and ensure it fills wrapper height so
           controls remain visible and interactive. Also bring scroll buttons above
           toolbar contents to avoid accidental overlays. */
        .toolbar-wrapper .toolbar {
            background: transparent;
            height: 100%;
            align-items: center;
            padding: 0 12px;
        }

        .toolbar-wrapper .toolbar-btn {
            height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .toolbar-scroll-btn {
            z-index: 1120;
        }

        .toolbar-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.2s;
        }

        .toolbar-btn:hover {
            background: var(--bg-hover);
        }

        .toolbar-btn.active {
            background: var(--accent);
            color: white;
        }

        .toolbar-separator {
            width: 1px;
            height: 24px;
            background: var(--border);
            margin: 0 4px;
        }

        .word-count-display {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            padding: 4px 10px;
            background: var(--glass-01);
            -webkit-backdrop-filter: blur(6px);
            backdrop-filter: blur(6px);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
        }

        .editor-container {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            width: 100%;
        }

        .page-title {
            font-size: 40px;
            font-weight: 700;
            border: none;
            outline: none;
            width: 100%;
            margin-top: 24px;
            margin-bottom: 20px;
            color: var(--text-primary);
            background: transparent;
        }

        .editor {
            min-height: 500px;
            outline: none;
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-primary);
        }

        .editor h1 {
            font-size: 32px;
            font-weight: 600;
            margin: 20px 0;
        }

        .editor h2 {
            font-size: 24px;
            font-weight: 600;
            margin: 18px 0;
        }

        .editor h3 {
            font-size: 20px;
            font-weight: 600;
            margin: 16px 0;
        }

        .editor p {
            margin: 12px 0;
        }

        .editor ul, .editor ol {
            margin: 12px 0;
            padding-left: 30px;
        }

        .editor blockquote {
            border-left: 3px solid var(--accent);
            padding: 12px 20px;
            margin: 15px 0;
            color: var(--text-secondary);
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(6px);
            backdrop-filter: blur(6px);
            border-radius: 0 10px 10px 0;
        }

        .editor pre {
            background: rgba(0, 0, 0, 0.25);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid var(--surface-border);
            padding: 15px;
            border-radius: 12px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .editor code {
            background: rgba(0, 0, 0, 0.2);
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
            padding: 3px 8px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
        }

        /* Table Styles */
        .editor table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .editor table th,
        .editor table td {
            border: 1px solid var(--surface-border);
            padding: 10px 12px;
            text-align: left;
        }

        .editor table th {
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(6px);
            backdrop-filter: blur(6px);
            font-weight: 600;
        }

        .editor table tr:hover td {
            background: var(--surface-bg-hover);
        }

        /* Checklist Styles */
        .editor .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            margin: 4px 0;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
            border: 1px solid var(--surface-border);
            border-radius: 8px;
        }

        .editor .checklist-item:last-child {
            border-bottom: none;
        }

        .editor .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent);
        }

        .editor .checklist-item.checked .checklist-text {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .editor .checklist-text {
            flex: 1;
            outline: none;
        }

        /* Collapsible Section Styles */
        .editor .collapsible-section {
            margin: 15px 0;
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            overflow: visible;
            position: relative;
            background: var(--glass-01);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
        }

        .editor .collapsible-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            padding-right: 45px;
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            cursor: pointer;
            user-select: none;
            border-radius: 12px 12px 0 0;
        }

        .editor .collapsible-header:hover {
            background: var(--glass-01);
        }

        .editor .collapsible-icon {
            transition: transform 0.3s ease;
        }

        .editor .collapsible-section.collapsed .collapsible-icon {
            transform: rotate(-90deg);
        }

        .editor .collapsible-title {
            font-weight: 600;
            flex: 1;
            outline: none;
        }

        .editor .collapsible-content {
            padding: 15px;
            border-top: 1px solid var(--glass-border);
        }

        .editor .collapsible-section.collapsed .collapsible-content {
            display: none;
        }
        
        /* Collapsible action button */
        .collapsible-action-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            background: var(--glass-01);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-secondary);
            z-index: 20;
            transition: all 0.2s ease;
        }
        
        .collapsible-section:hover .collapsible-action-btn {
            display: flex;
        }
        
        .collapsible-action-btn:hover {
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
        }
        
        /* Collapsible dropdown menu */
        .collapsible-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            background: var(--surface-bg-elevated);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--surface-border);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            min-width: 140px;
            z-index: 100;
            display: none;
            overflow: hidden;
        }
        
        .collapsible-dropdown.active {
            display: block;
        }
        
        .collapsible-dropdown-item {
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-primary);
            transition: all 0.15s ease;
        }
        
        .collapsible-dropdown-item:hover {
            background: var(--surface-bg-hover);
        }
        
        .collapsible-dropdown-item i {
            width: 16px;
            color: var(--text-secondary);
        }
        
        .collapsible-dropdown-item.danger {
            color: #dc2626;
        }
        
        .collapsible-dropdown-item.danger i {
            color: #dc2626;
        }

        /* Image Styles */
        .editor img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 15px 0;
            cursor: pointer;
        }

        .editor img:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .editor .image-container {
            position: relative;
            display: inline-block;
            margin: 15px 0;
        }

        .editor .image-container img {
            margin: 0;
        }

        .editor .image-resize-handle {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: var(--accent);
            border-radius: 4px;
            cursor: se-resize;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .editor .image-container:hover .image-resize-handle {
            opacity: 0.7;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* lighter backdrop so dialogs don't make the whole app feel too dark */
            background: rgba(0, 0, 0, 0.24);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            /* use theme-aware glass variable and slightly reduce blur/shadow so modal reads brighter */
            background: var(--glass-01);
            -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(140%);
            backdrop-filter: blur(var(--glass-blur)) saturate(140%);
            border: 1px solid var(--glass-border, rgba(255,255,255,0.08));
            border-radius: 18px;
            padding: 24px;
            width: 90%;
            max-width: 520px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.18);
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-input {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--surface-border);
            border-radius: 10px;
            font-size: 14px;
            outline: none;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
            transition: border-color 0.2s, background 0.2s;
        }

        .modal-input:focus {
            border-color: var(--accent);
            background: var(--surface-bg-hover);
        }

        .new-page-modal-content {
            max-width: 680px;
        }

        .template-preview-panel {
            margin-top: 14px;
            border: 1px solid var(--glass-border, rgba(255,255,255,0.08));
            border-radius: 14px;
            background: var(--surface-bg);
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .template-preview-head {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 10px;
        }

        .template-preview-title-wrap {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            min-width: 0;
        }

        .template-preview-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: 1px solid var(--glass-border, rgba(255,255,255,0.08));
            background: var(--surface-bg);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex: 0 0 36px;
        }

        .template-preview-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .template-preview-description {
            margin-top: 4px;
            color: var(--text-secondary);
            font-size: 12px;
            line-height: 1.4;
        }

        .template-suggest-btn {
            white-space: nowrap;
            padding: 8px 12px;
            font-size: 12px;
            flex-shrink: 0;
        }

        .template-preview-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .template-preview-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .template-preview-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .template-preview-tag {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid var(--glass-border, rgba(255,255,255,0.08));
            background: var(--surface-bg);
            font-size: 11px;
            color: var(--text-primary);
        }

        .template-preview-task-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding-top: 6px;
            border-top: 1px dashed var(--glass-border, rgba(255,255,255,0.08));
        }

        .template-task-toggle-copy {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 0;
        }

        .template-task-summary {
            color: var(--text-secondary);
            font-size: 12px;
            line-height: 1.3;
        }

        .template-preview-task-row.disabled {
            opacity: 0.55;
        }

        @media (max-width: 640px) {
            .new-page-modal-content {
                max-width: 94vw;
                padding: 18px;
            }

            .template-preview-head {
                flex-direction: column;
                align-items: stretch;
            }

            .template-suggest-btn {
                width: 100%;
            }
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ===== Add-Item Modal ===== */
        .add-item-modal-content {
            max-width: 560px;
            max-height: 88vh;
            display: flex;
            flex-direction: column;
        }

        .add-item-modal-content .modal-body {
            overflow-y: auto;
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            gap: 14px;
            padding-right: 4px;
        }

        .add-item-field {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .add-item-field label {
            font-size: 0.73rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .add-item-field .modal-input {
            margin: 0;
        }

        .add-item-field textarea.modal-input {
            resize: vertical;
            min-height: 56px;
        }

        .add-item-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }

        @media (max-width: 500px) {
            .add-item-row {
                grid-template-columns: 1fr;
            }
            .add-item-modal-content {
                max-height: 92vh;
            }
        }

        .btn {
            padding: 10px 18px;
            border: 1px solid var(--surface-border);
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            transition: all 0.2s;
            transition: opacity 0.2s;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-secondary {
            background: var(--glass-01);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
        }

        /* Bottom storage/taskbar */

        .storage-options {
            position: fixed;
            bottom: 0;
            left: var(--sidebar-width, 280px);
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            background: var(--surface-bg);
            -webkit-backdrop-filter: blur(12px) saturate(140%);
            backdrop-filter: blur(12px) saturate(140%);
            border-top: 1px solid var(--surface-border);
            box-shadow: 0 -6px 30px rgba(0,0,0,0.08);
            z-index: 100;
            transition: left 0.25s ease, opacity 0.15s ease;
        }

        .taskbar-save-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            padding: 6px 10px;
            border-radius: 8px;
            background: rgba(0,0,0,0.03);
            color: var(--text-secondary);
            border: 1px solid var(--surface-border);
        }

        .taskbar-save-status.saved { color: var(--accent); }
        .taskbar-save-status.saving { color: var(--accent-soft); }

        .taskbar-divider { width: 1px; height: 24px; background: var(--surface-border); margin: 0 6px; }

        .storage-btn {
            padding: 8px 12px;
            font-size: 13px;
            border-radius: 8px;
            display: inline-flex;
            gap: 8px;
            align-items: center;
            background: var(--glass-01);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
        }

        .storage-btn.primary { background: var(--accent); color: #fff; border-color: transparent; }

        @media (max-width: 900px) {
            .storage-options {
                left: auto !important;
                right: 12px !important;
                bottom: 16px !important;
                width: auto !important;
                padding: 8px !important;
                flex-direction: column !important;
                align-items: center !important;
                gap: 12px !important;
                border-radius: 12px !important;
                box-shadow: 0 6px 30px rgba(0,0,0,0.25);
                z-index: 130;
            }

            .storage-btn .btn-text { display: none; }
        }

        /* Toggle Button */
        .toggle-sidebar {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            display: none;
        }

        /* Mobile-first responsive improvements */
        @media (max-width: 768px) {
            :root {
                --sidebar-width: 280px;
            }

            .top-nav {
                margin: 12px 12px 8px;
                padding: 12px 14px;
                gap: 12px;
                top: 8px;
            }

            .nav-left {
                width: 100%;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .nav-divider { display: none; }

            .view-tabs {
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding: 4px;
            }

            .tabs-shell .tab-clock-embed {
                display: none;
            }

            .view-tabs::-webkit-scrollbar { display: none; }

            .view-tab {
                padding: 6px 10px;
                font-size: 11px;
                white-space: nowrap;
            }

            .nav-right {
                width: 100%;
            }

            .global-search { width: 100%; }

            .view-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .summary-grid {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 12px;
            }

            .today-grid {
                grid-template-columns: 1fr;
            }

            .task-card {
                flex-direction: column;
                align-items: flex-start;
            }

            .task-actions {
                align-self: flex-end;
            }

            /* Use circular toggle on mobile (keep the floating circular control)
               and hide the hamburger `.toggle-sidebar` to avoid duplicates. */
            .toggle-sidebar {
                display: none;
            }
            
            .sidebar {
                position: fixed;
                z-index: 99;
                height: 100vh;
                left: 0;
                transform: translateX(0);
                transition: transform 0.3s ease;
            }
            
            .sidebar.collapsed {
                transform: translateX(-100%);
                width: var(--sidebar-width);
                min-width: var(--sidebar-width);
            }
            
            /* Mobile sidebar overlay */
            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.55);
                /* sit above sidebar but below the toolbar */
                z-index: 105;
            }
            
            .sidebar-overlay.active {
                display: block;
            }

            .sidebar-toggle-btn {
                /* Show the floating circular toggle on small screens (circular UI)
                   - keep sizing adjusted for touch targets */
                /* position below the fixed toolbar so it doesn't overlap */
                top: calc(64px + 12px);
                left: 12px;
                width: 40px;
                height: 40px;
                font-size: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-toggle-btn.collapsed {
                left: 12px;
            }
            
            .editor-container {
                /* add top padding to account for fixed toolbar on mobile */
                padding: 140px 16px 40px 16px;
            }
            
            .page-title-input {
                font-size: 28px;
                margin-top: 20px;
            }

            /* Touch-friendly toolbar */
            .toolbar-wrapper {
                left: 0 !important;
                right: 0 !important;
                max-width: none !important;
                z-index: 110;
            }

            .toolbar {
                padding: 8px 12px;
                gap: 4px;
                /* Make toolbar sit above the sidebar overlay so controls remain accessible */
            }
            
            .toolbar-btn {
                min-width: 40px;
                min-height: 40px;
                padding: 10px;
            }
            
            .toolbar-separator {
                margin: 0 4px;
            }
            
            .toolbar-scroll-btn {
                width: 40px;
                height: 40px;
            }
            
            .toolbar-scroll-btn i {
                font-size: 14px;
            }

            /* Larger touch targets for page items */
            .page-item {
                min-height: 44px;
                padding: 12px 16px;
            }

            /* Make sidebar content start below the fixed toolbar on small viewports */
            .sidebar {
                padding-top: calc(64px + 12px);
            }

            /* Make the sidebar search input full-width and touch-friendly */
            .sidebar-search {
                padding: 12px 12px 6px 12px;
            }
            .sidebar-search .search-input {
                width: 100%;
                padding: 10px 12px;
            }

            /* Move the NoteFlow app title/logo to the right inside the sidebar header on mobile */
            .sidebar-header .app-title {
                width: 100%;
                justify-content: flex-end;
            }

            .theme-panel {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
                max-height: 70vh;
            }
            
            .theme-switcher-btn {
                width: 50px;
                height: 50px;
            }
            
            /* Todo panel mobile */
            .todo-panel {
                width: 100%;
                max-width: 100%;
                right: 0;
                left: 0;
                border-radius: 16px 16px 0 0;
                max-height: 60vh;
            }
            
            /* Word count smaller on mobile */
            .word-count-display {
                font-size: 11px;
                padding: 4px 8px;
            }
            
            /* Time widget compact on mobile */
            .toolbar-time-elegant {
                padding: 4px 10px !important;
            }
            
            .toolbar-time-widget {
                font-size: 13px !important;
                min-width: 60px !important;
            }
        }
        
        /* Small mobile (phones) */
        @media (max-width: 480px) {
            :root { --sidebar-width: 240px; }

            .top-nav {
                margin: 8px 8px 6px;
                padding: 10px 12px;
            }

            .view-tab {
                padding: 6px 10px;
                letter-spacing: 0.08em;
            }

            .editor-container {
                /* keep space for fixed toolbar on small phones */
                padding: 96px 12px 16px 12px;
            }

            .page-title-input {
                font-size: 24px;
                margin-top: 20px;
            }
            
            .toolbar-btn {
                min-width: 36px;
                min-height: 36px;
                padding: 8px;
                font-size: 13px;
            }
            
            .theme-panel {
                width: calc(100% - 20px);
                right: 10px;
                left: 10px;
                padding: 16px;
            }
            
            .sidebar-header {
                padding: 12px;
            }
            
            .app-title span {
                font-size: 16px;
            }
            /* Slightly reduce page-item font-size to avoid cramped rows on very small screens */
            .page-item {
                font-size: 14px;
            }
        }
        
        /* Tablet landscape */
        @media (min-width: 769px) and (max-width: 1024px) {
            :root {
                --sidebar-width: 260px;
            }
            
            .editor-container {
                padding: 30px 40px;
            }
        }
        
        /* Touch device detection - larger targets */
        @media (hover: none) and (pointer: coarse) {
            .toolbar-btn {
                min-width: 44px;
                min-height: 44px;
            }
            
            .page-item {
                min-height: 48px;
            }
            
            .page-item-icons i {
                padding: 8px;
            }
            
            .sidebar-toggle-btn {
                width: 44px;
                height: 44px;
            }

            /* On touch devices, show the page action icons by default (no hover) */
            .page-item .page-item-icons {
                display: flex;
            }

            /* Make sidebar content start below the fixed toolbar so search and timer don't overlap */
            .sidebar {
                padding-top: calc(64px + 12px);
            }

            /* Focus timer: allow wrapping and slightly larger controls on touch */
            .focus-timer {
                gap: 10px;
                padding: 10px 12px;
            }

            .focus-timer .timer-top {
                flex-wrap: wrap;
                align-items: center;
                gap: 10px;
            }

            .focus-timer .timer-controls {
                flex-wrap: wrap;
                align-items: center;
            }
            .focus-timer .icon-btn {
                width: 40px;
                height: 40px;
            }

            .neumo-btn {
                min-height: 44px;
            }

            .timeline-mini-btn {
                min-height: 44px;
                min-width: 44px;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--bg-hover);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 30, 30, 0.85);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            backdrop-filter: blur(20px) saturate(180%);
            color: #fff;
            padding: 14px 28px;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
            display: none;
            z-index: 2000;
            animation: slideUp 0.3s ease;
        }

        .toast.show {
            display: block;
        }

        .mini-celebration-burst {
            position: fixed;
            width: 1px;
            height: 1px;
            pointer-events: none;
            z-index: 3400;
        }

        .mini-celebration-pill {
            position: absolute;
            left: 0;
            top: 0;
            transform: translate(-50%, -14px);
            padding: 7px 12px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.02em;
            white-space: nowrap;
            color: #fff;
            background: linear-gradient(165deg, rgba(255, 153, 0, 0.95), rgba(244, 114, 182, 0.95));
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.28);
            animation: miniCelebrateBanner 1150ms ease forwards;
        }

        .mini-celebration-spark {
            position: absolute;
            left: 0;
            top: 0;
            width: 8px;
            height: 8px;
            border-radius: 2px;
            background: var(--spark-color, #f59e0b);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.44);
            animation: miniCelebrateSpark 900ms cubic-bezier(0.22, 1, 0.36, 1) forwards;
            animation-delay: var(--delay, 0ms);
        }

        @keyframes miniCelebrateSpark {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translate(var(--dx, 0px), var(--dy, 0px)) scale(0.42) rotate(var(--rot, 180deg));
            }
        }

        @keyframes miniCelebrateBanner {
            0% {
                opacity: 0;
                transform: translate(-50%, 6px) scale(0.92);
            }
            14% {
                opacity: 1;
                transform: translate(-50%, -14px) scale(1);
            }
            82% {
                opacity: 1;
                transform: translate(-50%, -17px) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -26px) scale(0.96);
            }
        }

        .timer-done-popup {
            position: fixed;
            left: 50%;
            top: 50%;
            width: min(560px, calc(100vw - 28px));
            padding: 24px 22px;
            border-radius: 20px;
            background: var(--surface-bg-elevated);
            border: 1px solid rgba(22, 30, 45, 0.14);
            box-shadow: 0 26px 58px rgba(22, 30, 45, 0.28);
            -webkit-backdrop-filter: blur(10px) saturate(140%);
            backdrop-filter: blur(10px) saturate(140%);
            z-index: 12650;
            opacity: 0;
            transform: translate(-50%, -46%) scale(0.94);
            pointer-events: none;
            transition: opacity 0.22s ease, transform 0.22s ease;
        }

        .timer-done-popup.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }

        .timer-done-title {
            font-size: clamp(26px, 4vw, 34px);
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        .timer-done-message {
            margin-top: 10px;
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.45;
        }

        .timer-done-btn {
            margin-top: 18px;
            min-height: 46px;
            padding: 0 18px;
            border-radius: 12px;
            border: 1px solid rgba(22, 30, 45, 0.14);
            background: var(--surface-bg);
            color: var(--text-primary);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
        }

        .timer-done-btn:hover {
            background: var(--bg-hover);
        }

        [data-theme="dark"] .timer-done-popup {
            background: rgba(24, 22, 19, 0.92);
            border-color: rgba(255, 255, 255, 0.14);
            box-shadow: 0 28px 62px rgba(0, 0, 0, 0.52);
        }

        [data-theme="dark"] .timer-done-btn {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.16);
            color: var(--text-primary);
        }

        @media (max-width: 640px) {
            .timer-done-popup {
                width: calc(100vw - 20px);
                padding: 18px 16px;
                border-radius: 14px;
            }

            .timer-done-title {
                font-size: clamp(22px, 7vw, 28px);
            }

            .timer-done-message {
                margin-top: 8px;
                font-size: 14px;
            }

            .timer-done-btn {
                width: 100%;
                min-height: 42px;
                font-size: 14px;
            }
        }

        /* Link Tooltip */
        .link-tooltip {
            position: fixed;
            background: var(--surface-bg-elevated);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--surface-border);
            padding: 10px 14px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1000;
            gap: 8px;
            align-items: center;
        }

        .link-tooltip.active {
            display: flex;
        }

        .link-tooltip a {
            color: var(--accent);
            text-decoration: none;
            font-size: 13px;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .link-tooltip a:hover {
            text-decoration: underline;
        }

        .link-tooltip button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .link-tooltip button:hover {
            background: var(--glass-02);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, 100%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }
        /* Strong override placed at end of stylesheet to ensure toolbar inner
           elements do not render their own background which caused the
           dark rectangle. Uses !important to override any earlier rules. */
        .toolbar-wrapper .toolbar {
            background: transparent !important;
            height: 100% !important;
            padding: 0 12px !important;
            box-shadow: none !important;
        }

        /* Ensure individual toolbar buttons don't carry a panel-like background */
        .toolbar-wrapper .toolbar-btn {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            color: inherit;
        }

        /* Keep scroll buttons hidden by default to reduce visual clutter.
           JS toggles the .visible class when toolbar overflow requires them.
           On small/narrow viewports we show them by default for discoverability. */
        .toolbar-scroll-btn {
            opacity: 0;
            pointer-events: none;
            background: var(--glass-01, rgba(255,255,255,0.06));
            border: 1px solid var(--glass-border, rgba(255,255,255,0.06));
            color: var(--text-primary);
            transition: opacity 0.16s ease, transform 0.16s ease;
            box-shadow: 0 6px 18px rgba(0,0,0,0.10);
        }

        /* Shown state (applied by JS when needed) */
        .toolbar-scroll-btn.visible {
            opacity: 0.92;
            pointer-events: auto;
            transform: scale(1.02);
        }

        .toolbar-scroll-btn:hover {
            background: var(--glass-02, rgba(255,255,255,0.12));
            color: var(--accent);
        }

        /* Mobile / narrow: always show scroll buttons for easier access */
        @media (max-width: 900px) {
            .toolbar-scroll-btn {
                opacity: 0.92;
                pointer-events: auto;
            }
        }

        /* Sidebar mask: add an inner opaque overlay to the sidebar so heavy
           frosted elements behind it (toolbar/save bar) don't visually bleed
           through the semi-transparent sidebar. This keeps the sidebar's
           glass look while preventing rectangles from elements behind it.
           We use a pseudo-element so it doesn't change the DOM. */
        .sidebar::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            /* Make the sidebar more transparent so more light/frost shows through.
               Very subtle overlay for light theme (reduced alpha). */
            background: linear-gradient(rgba(0,0,0,0.00), rgba(0,0,0,0.01));
            mix-blend-mode: normal;
            transition: background-color 0.22s ease, opacity 0.22s ease;
        }

        /* Progress dashboard refinements to match the mock: tighter spacing,
           improved card proportions, subtle shadows and centered streak stats. */
        .view-progress .view-header { margin-bottom: 8px; }
        .view-progress .view-header h2 { font-size: 28px; margin: 6px 0 0; }

        .stats-grid {
            gap: 14px; /* slightly tighter */
            grid-template-columns: repeat(2, 1fr);
            grid-auto-rows: minmax(120px, 200px);
            margin: 6px 18px 28px;
        }

        .glass-card {
            padding: 18px 20px;
            border-radius: 14px;
            background: var(--glass-01);
            border: 1px solid var(--glass-border);
            box-shadow: 0 18px 40px rgba(20,20,20,0.04);
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 10px;
        }

        /* Weekly card has a small badge on top-right */
        .card-weekly { position: relative; }
        .card-weekly .neumo-chip, .card-weekly .card-badge {
            position: absolute; top: 12px; right: 12px; transform: none;
        }
        .card-badge {
            background: var(--bg-secondary); color: var(--text-primary);
            border-radius: 999px; padding: 6px 10px; font-size: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.06);
        }

        .card-content { display:flex; align-items:center; gap:16px; }
        .sparkline { flex:1; height:46px; background: linear-gradient(90deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01)); border-radius:8px; display:flex; align-items:center; justify-content:center; color:var(--text-secondary); }
        .heatmap-placeholder { width:100%; height:110px; border-radius:8px; background: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01)); display:flex; align-items:center; justify-content:center; color:var(--text-secondary); }
        .donut-placeholder { width:78px; height:78px; border-radius:50%; display:inline-block; }
        .legend { display:flex; flex-direction:column; gap:8px; color:var(--text-secondary); font-size:13px; }

        .card-stat { font-size:20px; font-weight:700; color:var(--text-primary); }
        .card-meta { font-size:13px; color:var(--text-secondary); }

        /* Priority dot styles for task cards */
        .priority-dot { display:inline-block; width:12px; height:12px; border-radius:50%; margin-right:8px; vertical-align:middle; box-shadow:0 2px 6px rgba(0,0,0,0.12); }
        .priority-high { background: #d32f2f; }
        .priority-medium { background: #f57c00; }
        .priority-low { background: #2e7d32; }

    .due-chip { display:inline-block; padding:4px 8px; background: rgba(0,0,0,0.03); border-radius:999px; font-size:12px; color:var(--text-secondary); margin-left:8px; }

        /* Streak card: center content and make the large number prominent */
        .card-streaks { align-items:center; justify-content:center; text-align:center; }
        .card-streaks .streak-large { font-size:48px; line-height:1; }
        .card-streaks .streak-meta { color:var(--text-secondary); margin-top:6px; }

        @media (max-width: 900px) {
            .stats-grid { grid-auto-rows: auto; gap:12px; margin: 6px 12px 20px; }
            .card-streaks .streak-large { font-size:40px; }
            .view-progress .view-header h2 { font-size:22px; }
        }

        /* Today view layout cleanup: tighter sections, balanced columns, cleaner task rows */
        #view-today {
            max-width: none;
            width: 100%;
            margin: 0;
            padding: 14px 18px 24px;
        }

        #view-today .view-header {
            margin-bottom: 14px;
            align-items: flex-end;
            gap: 14px;
        }

        .today-header-actions {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 10px;
            flex-wrap: wrap;
        }

        #view-today .summary-grid {
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 14px;
            margin-bottom: 16px;
        }

        #view-today .summary-card {
            min-height: 136px;
            padding: 18px;
        }

        #view-today .summary-value {
            line-height: 1;
        }

        #view-today .today-grid {
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        #view-today .today-panel {
            min-height: 310px;
            padding: 18px 18px 16px;
            gap: 12px;
        }

        #view-today .today-panel .task-card {
            display: grid;
            grid-template-columns: minmax(0, 1fr) auto;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            border-radius: 14px;
        }

        #view-today .today-panel .task-main {
            min-width: 0;
        }

        #view-today .today-panel .task-actions {
            justify-content: flex-end;
            flex-wrap: wrap;
            gap: 8px;
        }

        #view-today .today-panel .task-actions .neumo-btn {
            padding: 8px 12px;
            font-size: 13px;
        }

        #view-today .stats-grid {
            grid-template-columns: repeat(4, minmax(0, 1fr));
            grid-auto-rows: minmax(140px, auto);
            gap: 14px;
            margin: 6px 0 34px;
            max-width: 100%;
        }

        @media (max-width: 1400px) {
            #view-today .stats-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 1200px) {
            #view-today .summary-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 1024px) {
            #view-today .today-grid {
                grid-template-columns: 1fr;
            }

            #view-today .stats-grid {
                grid-template-columns: 1fr;
            }

            #view-today .today-panel {
                min-height: auto;
            }

            #view-today .view-header {
                align-items: flex-start;
            }
        }

        @media (max-width: 700px) {
            #view-today {
                padding: 14px 12px 18px;
            }

            #view-today .summary-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .today-header-actions {
                width: 100%;
                justify-content: flex-start;
            }
        }

        /* Dark theme: lower the overlay alpha so the sidebar is less blocking but
           still slightly grounded to avoid complete bleed-through. */
        [data-theme="dark"] .sidebar::before {
            background: linear-gradient(rgba(0,0,0,0.12), rgba(0,0,0,0.08));
        }

        /* Dark mode shadow tuning for cleaner depth and less glow */
        [data-theme="dark"] .glass-panel,
        [data-theme="dark"] .glass-card,
        [data-theme="dark"] .glass-modal {
            box-shadow: 0 14px 32px rgba(0, 0, 0, 0.34);
            border-color: rgba(255, 255, 255, 0.06);
        }

        /* Let document content bleed through the sticky nav in dark mode */
        [data-theme="dark"] .top-nav {
            background: rgba(20, 20, 24, 0.08);
            border-color: rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 26px rgba(0, 0, 0, 0.24);
        }

        [data-theme="dark"] .neumo-btn,
        [data-theme="dark"] .toolbar-btn,
        [data-theme="dark"] .theme-switcher-btn {
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.42), -2px -2px 8px rgba(255, 255, 255, 0.03);
            border-color: rgba(255, 255, 255, 0.05);
        }

        [data-theme="dark"] .view-tabs {
            background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.02));
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.06), 0 8px 18px rgba(0, 0, 0, 0.24);
        }

        [data-theme="dark"] .view-tab.active {
            background: linear-gradient(165deg, rgba(210, 167, 77, 0.14), rgba(210, 167, 77, 0.07));
            box-shadow: inset 0 0 0 1px rgba(210, 167, 77, 0.22), 0 3px 8px rgba(0, 0, 0, 0.18);
        }

        [data-theme="dark"] .view-tab:hover:not(.active) {
            background: rgba(255,255,255,0.06);
        }

        [data-theme="dark"] .settings-actions .neumo-btn.active {
            box-shadow: inset 1px 1px 4px rgba(0, 0, 0, 0.56), inset -1px -1px 4px rgba(255, 255, 255, 0.05);
        }

        [data-theme="dark"] .feature-toggle-card {
            border-color: rgba(255, 255, 255, 0.14);
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05), 0 10px 22px rgba(0, 0, 0, 0.34);
        }

        [data-theme="dark"] .feature-toggle-card:hover {
            border-color: rgba(184, 134, 11, 0.56);
        }

        [data-theme="dark"] .feature-toggle-card[data-checked="true"] {
            border-color: rgba(184, 134, 11, 0.72);
            background: linear-gradient(180deg, rgba(184, 134, 11, 0.25), rgba(184, 134, 11, 0.1));
            box-shadow: 0 14px 28px rgba(0, 0, 0, 0.42);
        }

        [data-theme="dark"] .feature-toggle-switch {
            border-color: rgba(255, 255, 255, 0.24);
            background: rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .feature-toggle-switch-handle {
            background: #f9f9f9;
        }

        [data-theme="dark"] .feature-toggle-input:checked ~ .feature-toggle-switch {
            background: rgba(184, 134, 11, 0.9);
            border-color: rgba(184, 134, 11, 0.95);
            box-shadow: 0 0 0 2px rgba(184, 134, 11, 0.3);
        }

        [data-theme="dark"] .feature-toggle-input:focus-visible ~ .feature-toggle-switch {
            box-shadow: 0 0 0 3px rgba(105, 168, 255, 0.3);
        }

        [data-theme="dark"] .feature-setup-backdrop {
            background: rgba(4, 8, 14, 0.72);
        }

        [data-theme="dark"] .feature-setup-card {
            border-color: rgba(255, 255, 255, 0.14);
            background: linear-gradient(180deg, rgba(28, 31, 36, 0.97), rgba(20, 22, 26, 0.97));
            box-shadow: 0 36px 72px rgba(0, 0, 0, 0.5);
        }

        /* Also ensure the sidebar content is rendered above the overlay */
        .sidebar > * { position: relative; z-index: 1; }

/* Floating Add Task FAB */
.fab-add-task {
    display: none; /* hidden by default; shown inside the Today view */
}

/* Show and position FAB only when the Today view is active */
#view-today.active .fab-container { display: block; position: fixed; bottom: 108px; right: 24px; z-index: 2400; }
#view-today.active .fab-add-task {
    display: inline-flex;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    align-items: center;
    justify-content: center;
    background: var(--accent, #b8860b);
    color: #fff;
    border: none;
    box-shadow: 0 12px 28px rgba(0,0,0,0.22);
    cursor: pointer;
    transition: transform 120ms ease, box-shadow 120ms ease;
    font-size: 20px;
    position: relative;
}

/* Minimal, streak-first layout: move tasks into a right drawer */
.all-tasks-drawer {
    position: fixed;
    top: 88px; /* below top nav */
    right: 0;
    width: 380px;
    max-width: 90vw;
    height: calc(100vh - 120px);
    background: var(--glass-01);
    -webkit-backdrop-filter: blur(var(--glass-blur));
    backdrop-filter: blur(var(--glass-blur));
    border-left: 1px solid var(--glass-border);
    box-shadow: -20px 0 40px rgba(0,0,0,0.12);
    transform: translateX(100%);
    transition: transform 260ms cubic-bezier(0.22,1,0.36,1);
    z-index: 2600;
    display: flex;
    flex-direction: column;
    border-radius: 18px 0 0 18px;
    overflow: hidden;
}
.all-tasks-drawer[aria-hidden="false"] { transform: translateX(0); }
.all-tasks-drawer .drawer-header { display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid var(--surface-border); }
.all-tasks-drawer .drawer-body { padding:12px 14px; overflow:auto; overflow-x:hidden; }
.all-tasks-drawer .drawer-empty { padding:12px 14px; }
.all-tasks-drawer .task-list { gap: 10px; }
.all-tasks-drawer .task-card {
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto;
    align-items: center;
    gap: 10px;
    border-radius: 14px;
}
.all-tasks-drawer .task-main { min-width: 0; }
.all-tasks-drawer .task-meta {
    white-space: normal;
    line-height: 1.35;
}
.all-tasks-drawer .task-actions {
    justify-content: flex-end;
    flex-wrap: wrap;
    gap: 8px;
}
.all-tasks-drawer .task-actions .neumo-btn {
    min-width: 72px;
    padding: 7px 10px;
    font-size: 13px;
}

/* Header buttons */
#toggleAllTasksBtn { padding:8px 12px; border-radius: 10px; }
#topAddTaskBtn { padding:8px 14px; border-radius: 12px; background:var(--accent); color:#fff; box-shadow: 0 8px 18px rgba(0,0,0,0.08); }

/* Hide floating FAB for the minimal layout; top add button is used instead */
#view-today.active .fab-container { display: none !important; }

@media (max-width: 900px) {
    .all-tasks-drawer {
        width: min(92vw, 420px);
        top: var(--top-nav-height-mobile);
        height: calc(100vh - var(--top-nav-height-mobile) - 12px);
        border-radius: 16px 0 0 16px;
    }
    .all-tasks-drawer .task-card {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    .all-tasks-drawer .task-actions {
        justify-content: flex-start;
    }
}

#view-today.active .fab-container .fab-label {
    display: inline-block;
    margin-left: 12px;
    background: var(--surface-bg-elevated);
    color: var(--text-primary);
    padding: 8px 12px;
    border-radius: 999px;
    font-weight: 600;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    vertical-align: middle;
}

#view-today.active .fab-container .fab-label::before {
    content: '';
    display: inline-block;
    width: 8px; height: 8px; border-radius:50%; margin-right:8px; vertical-align:middle;
    background: var(--accent, #b8860b);
}

@media (max-width: 900px) {
    #view-today.active .fab-container { bottom: 150px; right: 16px; }
    #view-today.active .fab-add-task { width:48px; height:48px; font-size:18px; }
    #view-today.active .fab-container .fab-label { display: none; }
}

/* Hide assistant/chatbot in the Today view to avoid overlap and distraction */
body:has(#view-today.active) .chatbot-btn,
body:has(#view-today.active) .chatbot-panel,
body:has(#view-today.active) .chatbot-info {
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
}

/* Debug task panel (development aid) - removed */

/* 
   TIMELINE VIEW (TimeTile integration)
    */

.view-timeline { padding: 24px; }
.view-timeline .view-header { margin-bottom: 20px; }

.mode-badge {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 999px;
    background: var(--accent-soft);
    color: var(--accent);
    font-size: 13px;
    font-weight: 600;
    text-transform: capitalize;
}

.timeline-wrapper {
    padding: 24px;
    border-radius: var(--radius-lg);
}

.timeline-calendar-view {
    display: grid;
    gap: 12px;
}

.timeline-calendar-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
}

.timeline-calendar-title {
    font-size: 15px;
    font-weight: 700;
    color: var(--text-primary);
}

.timeline-calendar-nav {
    display: flex;
    align-items: center;
    gap: 8px;
}

.timeline-mini-btn {
    padding: 6px 10px;
    font-size: 12px;
}

.timeline-weekday-row {
    display: grid;
    grid-template-columns: repeat(7, minmax(0, 1fr));
    gap: 8px;
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 600;
}

.timeline-weekday-row > div {
    text-align: center;
    padding: 4px 0;
}

.timeline-calendar-grid.week,
.timeline-calendar-grid.month {
    display: grid;
    grid-template-columns: repeat(7, minmax(0, 1fr));
    gap: 8px;
}

.timeline-calendar-cell {
    border: 1px solid var(--border);
    background: var(--glass-01);
    border-radius: 12px;
    padding: 10px;
    text-align: left;
    display: grid;
    gap: 6px;
    min-height: 128px;
    cursor: pointer;
    transition: border-color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
}

.timeline-calendar-cell:hover {
    transform: translateY(-2px);
    border-color: var(--accent);
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.12);
}

.timeline-calendar-cell.outside {
    opacity: 0.5;
}

.timeline-calendar-cell.today {
    border-color: var(--accent);
}

.timeline-calendar-cell.selected {
    box-shadow: 0 0 0 1px var(--accent) inset;
}

.timeline-calendar-dayhead {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 10px;
}

.timeline-calendar-daynum {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
}

.timeline-calendar-weekday {
    font-size: 11px;
    color: var(--text-secondary);
}

.timeline-calendar-count {
    font-size: 11px;
    color: var(--accent);
    font-weight: 600;
}

.timeline-calendar-events {
    display: grid;
    gap: 4px;
}

.timeline-calendar-event {
    font-size: 11px;
    color: var(--text-secondary);
    background: var(--surface-bg);
    border: 1px solid rgba(0, 0, 0, 0.05);
    border-radius: 8px;
    padding: 3px 6px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.timeline-calendar-empty {
    font-size: 11px;
    color: var(--text-muted);
}

.timeline-calendar-more {
    font-size: 11px;
    color: var(--text-secondary);
    font-weight: 600;
}

.timeline-year-grid {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 10px;
}

.timeline-year-card {
    border: 1px solid var(--border);
    background: var(--glass-01);
    border-radius: 12px;
    padding: 12px;
    text-align: left;
    display: grid;
    gap: 6px;
    min-height: 84px;
    cursor: pointer;
    transition: border-color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
}

.timeline-year-card:hover {
    transform: translateY(-2px);
    border-color: var(--accent);
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.12);
}

.timeline-year-month {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
}

.timeline-year-count {
    font-size: 12px;
    color: var(--text-secondary);
}

.timeline-calendar-hint {
    font-size: 12px;
    color: var(--text-muted);
}

[data-theme="dark"] .timeline-calendar-cell,
[data-theme="dark"] .timeline-year-card {
    background: rgba(255, 255, 255, 0.06);
    border-color: rgba(255, 255, 255, 0.12);
}

[data-theme="dark"] .timeline-calendar-event {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.12);
}

.timeline-container {
    display: grid;
    grid-template-columns: 56px 1fr;
    gap: 16px;
    min-height: 520px;
    max-height: 70vh;
    overflow-y: auto;
    overflow-x: hidden;
    position: relative;
}

.timeline-scale {
    position: relative;
    height: 100%;
}

.hour-marker {
    position: absolute;
    left: 0;
    width: 100%;
    font-size: 11px;
    font-weight: 500;
    color: var(--text-muted);
    padding-right: 8px;
    text-align: right;
}
.hour-marker::after {
    content: '';
    position: absolute;
    right: -16px;
    top: 0;
    width: calc(var(--timeline-grid-span, 0px) + 16px);
    height: 1px;
    background: var(--border);
    pointer-events: none;
}

.timeline-blocks {
    position: relative;
    min-height: 600px; /* 25px per hour * 24 */
}

.timeline-block {
    position: absolute;
    left: 0;
    right: 0;
    padding: 10px 14px;
    border-radius: var(--neumo-radius);
    background: var(--neumo-bg);
    border-left: 5px solid var(--accent);
    box-shadow: 4px 4px 12px var(--neumo-shadow-dark),
                -4px -4px 12px var(--neumo-shadow-light);
    cursor: pointer;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    overflow: hidden;
    z-index: 1;
}
.timeline-block:hover {
    transform: translateY(-2px);
    box-shadow: 6px 6px 16px var(--neumo-shadow-dark),
                -6px -6px 16px var(--neumo-shadow-light);
    z-index: 2;
}
.timeline-block.current {
    background: var(--accent-soft);
    border-left-width: 7px;
    box-shadow: 0 0 20px var(--accent-soft),
                4px 4px 12px var(--neumo-shadow-dark),
                -4px -4px 12px var(--neumo-shadow-light);
}

.timeline-block .block-name {
    font-weight: 600;
    font-size: 14px;
    color: var(--text-primary);
    margin-bottom: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.timeline-block .block-time {
    font-size: 12px;
    color: var(--text-muted);
}

.now-indicator {
    position: absolute;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--accent);
    box-shadow: 0 0 12px var(--accent);
    z-index: 50;
    pointer-events: none;
}
.now-indicator::before {
    content: attr(data-now-label);
    position: absolute;
    left: 8px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 10px;
    font-weight: 700;
    color: var(--accent);
    background: var(--bg-primary);
    padding: 2px 7px;
    border-radius: 999px;
    border: 1px solid rgba(0, 0, 0, 0.12);
    line-height: 1.2;
}

.current-block-card {
    padding: 20px;
}
.current-block-card .panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}
.current-block-card h3 {
    margin: 0;
    font-size: 16px;
}

.progress-bar {
    height: 8px;
    background: var(--bg-secondary);
    border-radius: 4px;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    background: var(--accent);
    border-radius: 4px;
    transition: width 300ms ease;
}

/* Time-of-day mode theming */
body[data-time-mode="morning"] {
    --accent: #b8860b;
    --accent-soft: rgba(184,134,11,0.12);
}
body[data-time-mode="afternoon"] {
    --accent: #2563eb;
    --accent-soft: rgba(37,99,235,0.12);
}
body[data-time-mode="evening"] {
    --accent: #fb7185;
    --accent-soft: rgba(251,113,133,0.12);
}
body[data-time-mode="night"] {
    --accent: #60a5fa;
    --accent-soft: rgba(96,165,250,0.12);
}

/* Responsive timeline */
@media (max-width: 768px) {
    .timeline-container {
        grid-template-columns: 44px 1fr;
        gap: 10px;
        max-height: 60vh;
    }
    .timeline-block {
        padding: 8px 10px;
    }
    .hour-marker {
        font-size: 10px;
    }
    .now-indicator::before {
        left: 6px;
        font-size: 9px;
    }

    .timeline-calendar-grid.week,
    .timeline-calendar-grid.month {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .timeline-weekday-row {
        display: none;
    }

    .timeline-year-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }
}

/* Emoji Picker - Final override (single source of truth) */
.emoji-modal-overlay {
    background: rgba(8, 12, 18, 0.52);
}

.emoji-picker {
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    z-index: 2600;
    width: min(860px, calc(100vw - 28px));
    max-height: min(82vh, 760px);
    padding: 14px 14px 12px;
    border-radius: 18px;
    border: 1px solid var(--border);
    background: var(--bg-primary);
    box-shadow: 0 28px 80px rgba(0, 0, 0, 0.42);
    display: none;
    overflow: hidden;
    box-sizing: border-box;
}

.emoji-picker.active {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.emoji-picker-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
    margin: 0;
}

.emoji-header-left {
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.emoji-picker-title {
    margin: 0;
    line-height: 1.1;
    font-size: 21px;
    font-weight: 800;
    letter-spacing: -0.01em;
    color: var(--text-primary);
}

.emoji-picker-subtitle {
    font-size: 12px;
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.emoji-header-actions {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
}

.emoji-close-btn {
    width: 34px;
    height: 34px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--bg-secondary);
    color: var(--text-secondary);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: background 160ms ease, color 160ms ease, border-color 160ms ease, transform 160ms ease;
}

.emoji-close-btn:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
    border-color: var(--accent);
    transform: translateY(-1px);
}

.emoji-remove-btn {
    border: 1px solid rgba(216, 74, 74, 0.45);
    background: rgba(216, 74, 74, 0.12);
    color: #b84141;
    border-radius: 10px;
    height: 34px;
    padding: 0 12px;
    font-size: 12px;
    font-weight: 700;
    cursor: pointer;
    transition: background 160ms ease, color 160ms ease, border-color 160ms ease;
}

.emoji-remove-btn:hover {
    background: rgba(216, 74, 74, 0.2);
    border-color: rgba(216, 74, 74, 0.7);
    color: #9f2f2f;
}

[data-theme="dark"] .emoji-remove-btn {
    color: #ffb0b0;
    background: rgba(255, 90, 90, 0.14);
    border-color: rgba(255, 125, 125, 0.45);
}

[data-theme="dark"] .emoji-remove-btn:hover {
    background: rgba(255, 90, 90, 0.24);
}

.emoji-search-container {
    margin: 0;
}

.emoji-search {
    width: 100%;
    height: 42px;
    padding: 0 14px;
    border: 1px solid var(--border);
    border-radius: 11px;
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 14px;
    outline: none;
    transition: border-color 160ms ease, box-shadow 160ms ease, background 160ms ease;
    box-sizing: border-box;
}

.emoji-search:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-soft);
    background: var(--bg-primary);
}

.emoji-categories {
    display: flex;
    flex-wrap: nowrap;
    gap: 8px;
    margin: 0;
    padding: 2px 0 10px;
    overflow-x: auto;
    overflow-y: hidden;
    border-bottom: 1px solid var(--border);
    scrollbar-width: thin;
}

.emoji-cat-btn {
    flex: 0 0 auto;
    border: 1px solid var(--border);
    background: var(--bg-secondary);
    color: var(--text-secondary);
    border-radius: 999px;
    padding: 6px 12px;
    font-size: 12px;
    font-weight: 700;
    line-height: 1;
    cursor: pointer;
    white-space: nowrap;
    transition: background 160ms ease, color 160ms ease, border-color 160ms ease;
}

.emoji-cat-btn:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
}

.emoji-cat-btn.active {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent);
}

.emoji-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(44px, 1fr));
    gap: 8px;
    margin: 0;
    padding: 10px 2px 4px;
    max-height: min(52vh, 430px);
    overflow-y: auto;
    overflow-x: hidden;
    scrollbar-width: thin;
}

.emoji-option {
    width: 42px;
    height: 42px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    font-size: 24px;
    cursor: pointer;
    user-select: none;
    transition: transform 140ms ease, background 140ms ease;
}

.emoji-option:hover {
    transform: translateY(-1px) scale(1.08);
    background: var(--bg-hover);
}

.emoji-option:active {
    transform: scale(0.96);
}

.emoji-empty {
    grid-column: 1 / -1;
    padding: 18px 10px;
    text-align: center;
    color: var(--text-secondary);
    font-size: 13px;
}

.emoji-grid::-webkit-scrollbar,
.emoji-categories::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

.emoji-grid::-webkit-scrollbar-thumb,
.emoji-categories::-webkit-scrollbar-thumb {
    background: rgba(130, 130, 130, 0.4);
    border-radius: 12px;
}

.emoji-grid::-webkit-scrollbar-thumb:hover,
.emoji-categories::-webkit-scrollbar-thumb:hover {
    background: rgba(130, 130, 130, 0.6);
}

.emoji-grid::-webkit-scrollbar-track,
.emoji-categories::-webkit-scrollbar-track {
    background: transparent;
}

@media (max-width: 768px) {
    .emoji-picker {
        width: calc(100vw - 16px);
        max-height: 76vh;
        border-radius: 14px;
        padding: 12px 10px 10px;
    }

    .emoji-picker-title {
        font-size: 18px;
    }

    .emoji-picker-subtitle {
        font-size: 11px;
    }

    .emoji-search {
        height: 40px;
        font-size: 13px;
    }

    .emoji-cat-btn {
        padding: 6px 11px;
        font-size: 11px;
    }

    .emoji-grid {
        grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
        gap: 7px;
        max-height: 46vh;
    }

    .emoji-option {
        width: 38px;
        height: 38px;
        font-size: 22px;
        border-radius: 8px;
    }
}

/* Light mode: enforce pure white app and sidebar surfaces */
body:not([data-theme="dark"]) .sidebar {
    background: #ffffff;
    border-right: 1px solid rgba(22, 30, 45, 0.12);
    -webkit-backdrop-filter: none;
    backdrop-filter: none;
}

body:not([data-theme="dark"]) .sidebar::before {
    background: transparent;
}

body:not([data-theme="dark"]) .sidebar-header,
body:not([data-theme="dark"]) .sidebar-search,
body:not([data-theme="dark"]) .pages-list {
    background: #ffffff;
}

/* Toolbar clock controls: keep the settings popover anchored and inside toolbar bounds */
.toolbar-time-elegant {
    position: relative !important;
    overflow: visible !important;
}

#toolbarTimeControls {
    position: absolute !important;
    top: calc(100% + 8px);
    right: 0;
    margin-left: 0 !important;
    padding: 8px 10px;
    border: 1px solid var(--border);
    border-radius: 10px;
    background: var(--bg-primary);
    box-shadow: 0 10px 26px rgba(22, 30, 45, 0.14);
    z-index: 1400;
    white-space: nowrap;
    transform: translateX(0);
}

#toolbarTimeControls select {
    min-width: 86px;
}

@media (max-width: 768px) {
    #toolbarTimeControls {
        left: 0;
        right: auto;
        max-width: calc(100vw - 32px);
    }
}

/* Homework priority visuals */
.hw-priority {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 58px;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 700;
    text-transform: capitalize;
    line-height: 1.2;
}

.hw-priority-high {
    background: rgba(211, 47, 47, 0.16);
    color: #b71c1c;
}

.hw-priority-medium {
    background: rgba(245, 124, 0, 0.18);
    color: #8a4700;
}

.hw-priority-low {
    background: rgba(46, 125, 50, 0.16);
    color: #1b5e20;
}

.hw-inline-add select {
    padding: 5px 8px;
    border-radius: 6px;
    border: 1px solid rgba(255,255,255,.08);
    background: transparent;
    color: var(--text-primary);
    font-size: .8rem;
}

.hw-task-controls {
    display: inline-flex;
    gap: 6px;
    align-items: center;
    flex-wrap: wrap;
}

.hw-task-control {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 11px;
    color: var(--text-muted);
}

.hw-task-control select {
    padding: 2px 6px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 11px;
}

[data-theme="dark"] .hw-priority-high {
    background: rgba(211, 47, 47, 0.22);
    color: #ff8a80;
}

[data-theme="dark"] .hw-priority-medium {
    background: rgba(245, 124, 0, 0.22);
    color: #ffcc80;
}

[data-theme="dark"] .hw-priority-low {
    background: rgba(46, 125, 50, 0.24);
    color: #a5d6a7;
}

/* ------------------------------------------------------------------
   Responsive hardening layer
   Keeps app usable across narrow/short screens and mixed orientations.
------------------------------------------------------------------- */
@media (max-width: 1200px) {
    :root {
        --sidebar-width: clamp(240px, 30vw, 300px);
    }

    .top-nav {
        gap: 12px !important;
    }

    .nav-left {
        min-width: 0;
        flex: 1 1 auto;
    }

    .nav-right {
        min-width: 200px;
    }

    .global-search {
        min-width: 0 !important;
        width: min(280px, 34vw);
    }
}

@media (max-width: 1024px) {
    :root {
        --sidebar-width: clamp(240px, 72vw, 340px);
    }

    .app-container {
        overflow: hidden;
    }

    .main-content {
        min-width: 0;
        width: 100%;
    }

    .top-nav {
        margin: 8px !important;
        padding: 10px 12px !important;
        border-radius: 16px !important;
        gap: 10px !important;
        align-items: flex-start !important;
    }

    .nav-left {
        width: 100%;
        min-width: 0;
        flex-wrap: wrap;
    }

    .nav-right {
        display: none !important;
    }

    .brand-sub,
    .nav-divider {
        display: none !important;
    }

    .tabs-shell {
        width: 100%;
        min-width: 0;
        justify-content: flex-end;
        padding-right: 56px; /* room for mobile toggle */
    }

    .view-tabs-toggle {
        right: calc(env(safe-area-inset-right, 0px) + 12px) !important;
    }

    .view-tabs.expanded {
        right: calc(env(safe-area-inset-right, 0px) + 8px) !important;
        width: min(360px, calc(100vw - 16px - env(safe-area-inset-right, 0px))) !important;
        max-height: min(70vh, calc(100vh - 96px)) !important;
    }

    .toolbar-wrapper {
        left: 8px !important;
        right: 8px !important;
        max-width: none !important;
        top: calc(var(--top-nav-height-mobile) + 8px) !important;
        border-radius: 12px !important;
    }

    .toolbar {
        min-height: 48px;
    }

    .editor-container {
        padding: calc(var(--top-nav-height-mobile) + 72px) 12px 84px 12px !important;
    }

    .page-title-input {
        margin-top: 10px !important;
        font-size: clamp(20px, 5vw, 28px) !important;
    }

    .editor {
        min-height: 48vh !important;
    }

    .storage-options {
        left: 8px !important;
        right: 8px !important;
        bottom: calc(env(safe-area-inset-bottom, 0px) + 8px) !important;
        width: auto !important;
        max-width: none !important;
        flex-direction: row !important;
        justify-content: center !important;
        flex-wrap: wrap !important;
        gap: 8px !important;
        padding: 8px !important;
        z-index: 2400 !important;
    }

    .storage-options .storage-btn {
        min-height: 36px;
    }

    .chatbot-btn {
        right: calc(env(safe-area-inset-right, 0px) + 10px) !important;
        bottom: calc(env(safe-area-inset-bottom, 0px) + 84px) !important;
        z-index: 2500 !important;
    }

    .chatbot-panel {
        left: 10px !important;
        right: 10px !important;
        width: auto !important;
        max-width: none !important;
        bottom: calc(env(safe-area-inset-bottom, 0px) + 140px) !important;
        max-height: 60vh !important;
    }

    .all-tasks-drawer {
        width: min(92vw, 420px) !important;
        right: 0 !important;
        top: var(--top-nav-height-mobile) !important;
        height: calc(100vh - var(--top-nav-height-mobile) - env(safe-area-inset-bottom, 0px)) !important;
        border-radius: 16px 0 0 16px !important;
        z-index: 2600 !important;
    }

    .sidebar {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        bottom: 0 !important;
        height: 100dvh !important;
        width: min(var(--sidebar-width), 84vw) !important;
        min-width: min(var(--sidebar-width), 84vw) !important;
        max-width: min(var(--sidebar-width), 84vw) !important;
        z-index: 5000 !important;
        transform: translateX(0);
        transition: transform 0.25s ease;
    }

    .sidebar:not(.collapsed) {
        visibility: visible !important;
        opacity: 1 !important;
        pointer-events: auto !important;
    }

    /* Mobile source-of-truth: body class controls whether sidebar is visible */
    body:not(.sidebar-open) .sidebar {
        transform: translateX(-100%) !important;
        visibility: hidden !important;
        opacity: 0 !important;
        pointer-events: none !important;
        border-right: none !important;
        box-shadow: none !important;
    }

    body.sidebar-open .sidebar {
        transform: translateX(0) !important;
        visibility: visible !important;
        opacity: 1 !important;
        pointer-events: auto !important;
    }

    .sidebar.collapsed {
        /* Use element-relative translation so any later width override still hides fully */
        transform: translateX(-100%) !important;
        width: min(var(--sidebar-width), 84vw) !important;
        min-width: min(var(--sidebar-width), 84vw) !important;
        border-right: none !important;
        box-shadow: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        pointer-events: none !important;
    }

    .sidebar-overlay {
        z-index: 4200 !important;
    }

    .sidebar-overlay.active {
        background: rgba(0, 0, 0, 0.38) !important;
    }

    .sidebar-toggle-btn {
        left: 12px !important;
        top: calc(var(--top-nav-height-mobile) + 52px) !important;
        z-index: 5200 !important;
    }

    .sidebar-toggle-btn.collapsed {
        left: 12px !important;
    }
}

@media (max-width: 640px) {
    .top-nav {
        margin: 6px !important;
        padding: 8px 10px !important;
    }

    .brand-label {
        font-size: 15px !important;
    }

    .view-tabs.expanded {
        padding: 8px !important;
        gap: 6px !important;
    }

    .view-tab {
        font-size: 11px !important;
        padding: 7px 10px !important;
    }

    .toolbar {
        padding: 6px 8px !important;
    }

    .toolbar-btn {
        min-width: 38px !important;
        min-height: 38px !important;
    }

    .editor-container {
        padding: calc(var(--top-nav-height-mobile) + 68px) 10px 90px 10px !important;
    }

    .summary-grid,
    .today-grid,
    .stats-grid {
        gap: 10px !important;
    }
}

@media (max-height: 760px) and (max-width: 1024px) {
    .top-nav {
        position: sticky;
        top: 4px !important;
    }

    .toolbar-wrapper {
        top: calc(var(--top-nav-height-mobile) + 4px) !important;
    }

    .editor-container {
        padding-top: calc(var(--top-nav-height-mobile) + 62px) !important;
    }

    .sidebar {
        padding-top: 74px !important;
    }

    .chatbot-panel {
        max-height: 52vh !important;
    }
}

/* ------------------------------------------------------------------
   Clean Scrollbars (sidebar + drawer surfaces)
------------------------------------------------------------------- */
:root {
    --scrollbar-track: rgba(22, 30, 45, 0.06);
    --scrollbar-thumb: rgba(22, 30, 45, 0.24);
    --scrollbar-thumb-hover: rgba(22, 30, 45, 0.36);
}

[data-theme="dark"] {
    --scrollbar-track: rgba(255, 255, 255, 0.06);
    --scrollbar-thumb: rgba(255, 255, 255, 0.24);
    --scrollbar-thumb-hover: rgba(255, 255, 255, 0.34);
}

.pages-list,
.all-tasks-drawer .drawer-body,
.emoji-picker-body,
.emoji-grid,
.emoji-categories,
.hw-setup-card {
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
    scrollbar-gutter: stable;
}

.pages-list::-webkit-scrollbar,
.all-tasks-drawer .drawer-body::-webkit-scrollbar,
.emoji-picker-body::-webkit-scrollbar,
.emoji-grid::-webkit-scrollbar,
.emoji-categories::-webkit-scrollbar,
.hw-setup-card::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

.pages-list::-webkit-scrollbar-track,
.all-tasks-drawer .drawer-body::-webkit-scrollbar-track,
.emoji-picker-body::-webkit-scrollbar-track,
.emoji-grid::-webkit-scrollbar-track,
.emoji-categories::-webkit-scrollbar-track,
.hw-setup-card::-webkit-scrollbar-track {
    background: var(--scrollbar-track);
    border-radius: 999px;
}

.pages-list::-webkit-scrollbar-thumb,
.all-tasks-drawer .drawer-body::-webkit-scrollbar-thumb,
.emoji-picker-body::-webkit-scrollbar-thumb,
.emoji-grid::-webkit-scrollbar-thumb,
.emoji-categories::-webkit-scrollbar-thumb,
.hw-setup-card::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, var(--scrollbar-thumb), var(--scrollbar-thumb));
    border-radius: 999px;
    border: 2px solid transparent;
    background-clip: padding-box;
}

.pages-list::-webkit-scrollbar-thumb:hover,
.all-tasks-drawer .drawer-body::-webkit-scrollbar-thumb:hover,
.emoji-picker-body::-webkit-scrollbar-thumb:hover,
.emoji-grid::-webkit-scrollbar-thumb:hover,
.emoji-categories::-webkit-scrollbar-thumb:hover,
.hw-setup-card::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, var(--scrollbar-thumb-hover), var(--scrollbar-thumb-hover));
    background-clip: padding-box;
}

/* Hide arrow buttons that create the dated boxed look on Windows */
.pages-list::-webkit-scrollbar-button,
.all-tasks-drawer .drawer-body::-webkit-scrollbar-button,
.emoji-picker-body::-webkit-scrollbar-button,
.emoji-grid::-webkit-scrollbar-button,
.emoji-categories::-webkit-scrollbar-button,
.hw-setup-card::-webkit-scrollbar-button {
    display: none;
    width: 0;
    height: 0;
}

/* Imported file-type icon accents */
.page-icon .imported-word-icon {
    color: #2b579a;
    font-size: 15px;
    line-height: 1;
}

[data-theme="dark"] .page-icon .imported-word-icon {
    color: #7fb0ff;
}

/* Import drag-and-drop modal */
.import-drop-modal {
    max-width: 620px;
}

.import-drop-zone {
    border: 2px dashed var(--border);
    border-radius: 14px;
    padding: 28px 20px;
    text-align: center;
    background: var(--glass-01);
    display: grid;
    gap: 10px;
    justify-items: center;
    transition: border-color var(--transition-fast), background var(--transition-fast), box-shadow var(--transition-fast);
    cursor: pointer;
}

.import-drop-zone i {
    font-size: 24px;
    color: var(--accent);
}

.import-drop-title {
    font-weight: 700;
    color: var(--text-primary);
}

.import-drop-subtitle {
    font-size: 13px;
    color: var(--text-secondary);
    max-width: 500px;
}

.import-drop-zone.drag-over {
    border-color: var(--accent);
    background: var(--accent-soft);
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.08);
}

/* ------------------------------------------------------------------
   Today Dashboard Refresh
------------------------------------------------------------------- */
#view-today.dashboard-today {
    width: 100%;
    max-width: none;
    padding: 16px 20px 26px;
}

#view-today.dashboard-today > .view-header {
    margin-bottom: 14px;
    align-items: flex-end;
    gap: 14px;
}

#view-today.dashboard-today .today-header-actions {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 10px;
    flex-wrap: wrap;
}

#view-today.dashboard-today .today-dashboard-surface {
    padding: 16px;
    border-radius: 22px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    background:
        radial-gradient(circle at 8% 0%, rgba(255, 186, 73, 0.18), transparent 35%),
        radial-gradient(circle at 92% 100%, rgba(255, 122, 60, 0.14), transparent 30%),
        linear-gradient(180deg, rgba(255, 255, 255, 0.52), rgba(255, 255, 255, 0.34));
    box-shadow: 0 20px 44px rgba(0, 0, 0, 0.08);
    margin-bottom: 20px;
}

#view-today.dashboard-today .summary-grid {
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 12px;
    margin-bottom: 14px;
}

#view-today.dashboard-today .summary-card {
    min-height: 130px;
    padding: 16px;
    border: 1px solid rgba(255, 255, 255, 0.26);
    background: linear-gradient(160deg, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.38));
}

#view-today.dashboard-today .summary-value {
    font-size: clamp(26px, 2.2vw, 34px);
    line-height: 1;
}

#view-today.dashboard-today .today-grid {
    display: grid;
    gap: 12px;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) minmax(300px, 0.92fr);
    grid-template-areas:
        "commit commit habits"
        "due completed habits";
}

#view-today.dashboard-today .today-panel {
    min-height: 290px;
    border-radius: 18px;
    border: 1px solid rgba(255, 255, 255, 0.24);
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.68), rgba(255, 255, 255, 0.38));
    box-shadow: 0 14px 30px rgba(0, 0, 0, 0.07);
    padding: 16px;
    gap: 12px;
}

#view-today.dashboard-today .today-panel-committed { grid-area: commit; min-height: 340px; }
#view-today.dashboard-today .today-panel-due { grid-area: due; }
#view-today.dashboard-today .today-panel-completed { grid-area: completed; }
#view-today.dashboard-today .today-panel-habits { grid-area: habits; min-height: 100%; }

#view-today.dashboard-today .panel-header h3 {
    margin: 0;
    font-size: 16px;
    letter-spacing: 0.02em;
}

#view-today.dashboard-today .today-panel .neumo-chip {
    border-radius: 999px;
    padding: 4px 10px;
}

#view-today.dashboard-today .today-panel .task-list {
    flex: 1;
    min-height: 0;
    overflow: auto;
    padding-right: 4px;
}

#view-today.dashboard-today .today-panel .empty-state {
    margin-top: auto;
    border: 1px dashed rgba(0, 0, 0, 0.08);
    background: rgba(255, 255, 255, 0.44);
}

#view-today.dashboard-today .today-panel .task-card {
    padding: 12px 14px;
    border-radius: 14px;
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
}

#view-today.dashboard-today .today-panel .task-actions .neumo-btn {
    padding: 8px 12px;
    font-size: 13px;
}

#view-today.dashboard-today .habit-add-row {
    background: rgba(255, 255, 255, 0.52);
    border: 1px solid rgba(0, 0, 0, 0.06);
    padding: 8px;
    border-radius: 12px;
}

#view-today.dashboard-today .today-analytics-section {
    margin-top: 8px;
}

#view-today.dashboard-today .today-analytics-header {
    margin-bottom: 12px;
}

#view-today.dashboard-today .stats-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr));
    grid-auto-rows: minmax(150px, auto);
    gap: 12px;
    margin: 0 0 34px;
    max-width: 100%;
}

#view-today.dashboard-today .card-weekly { grid-column: span 1; }
#view-today.dashboard-today .card-monthly { grid-column: span 1; }
#view-today.dashboard-today .card-categories { grid-column: span 1; }
#view-today.dashboard-today .card-streaks { grid-column: span 1; }
#view-today.dashboard-today .card-categories .card-content {
    align-items: center;
    gap: 16px;
}

#view-today.dashboard-today #categoryDonut {
    width: 174px;
    height: 174px;
    min-width: 174px;
    border-radius: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(165deg, rgba(255, 255, 255, 0.72), rgba(255, 255, 255, 0.44));
    border: 1px solid rgba(0, 0, 0, 0.08);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.7), 0 10px 24px rgba(0, 0, 0, 0.08);
}

#view-today.dashboard-today #categoryDonut svg {
    width: 156px;
    height: 156px;
}

#view-today.dashboard-today .card-categories .legend {
    flex: 1;
    min-width: 0;
    gap: 8px;
}

#view-today.dashboard-today .card-categories .legend-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(0, 0, 0, 0.08);
    background: rgba(255, 255, 255, 0.58);
}

#view-today.dashboard-today .card-categories .legend-main {
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 0;
}

#view-today.dashboard-today .card-categories .legend-color {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    margin-right: 0;
    box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.62);
}

#view-today.dashboard-today .card-categories .legend-label {
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: var(--text-primary);
}

#view-today.dashboard-today .card-categories .legend-metrics {
    display: flex;
    align-items: baseline;
    gap: 10px;
    flex: 0 0 auto;
}

#view-today.dashboard-today .card-categories .legend-percent {
    font-size: 12px;
    color: var(--text-secondary);
    min-width: 34px;
    text-align: right;
}

#view-today.dashboard-today .card-categories .legend-value {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
    min-width: 20px;
    text-align: right;
}

[data-theme="dark"] #view-today.dashboard-today .today-dashboard-surface {
    border-color: rgba(255, 255, 255, 0.08);
    background:
        radial-gradient(circle at 10% 4%, rgba(255, 162, 0, 0.2), transparent 35%),
        radial-gradient(circle at 92% 96%, rgba(255, 88, 41, 0.18), transparent 32%),
        linear-gradient(180deg, rgba(16, 14, 12, 0.88), rgba(11, 10, 9, 0.78));
    box-shadow: 0 24px 52px rgba(0, 0, 0, 0.42);
}

[data-theme="dark"] #view-today.dashboard-today .summary-card,
[data-theme="dark"] #view-today.dashboard-today .today-panel {
    border-color: rgba(255, 255, 255, 0.12);
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.09), rgba(255, 255, 255, 0.04));
}

[data-theme="dark"] #view-today.dashboard-today .today-panel .empty-state {
    border-color: rgba(255, 255, 255, 0.14);
    background: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] #view-today.dashboard-today .habit-add-row {
    background: rgba(255, 255, 255, 0.07);
    border-color: rgba(255, 255, 255, 0.12);
}

[data-theme="dark"] #view-today.dashboard-today #categoryDonut {
    background: linear-gradient(165deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.05));
    border-color: rgba(255, 255, 255, 0.12);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08), 0 12px 24px rgba(0, 0, 0, 0.32);
}

[data-theme="dark"] #view-today.dashboard-today .card-categories .legend-item {
    border-color: rgba(255, 255, 255, 0.12);
    background: rgba(255, 255, 255, 0.05);
}

@media (max-width: 1420px) {
    #view-today.dashboard-today .today-grid {
        grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
        grid-template-areas:
            "commit habits"
            "due habits"
            "completed habits";
    }

    #view-today.dashboard-today .stats-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }

}

@media (max-width: 1024px) {
    #view-today.dashboard-today {
        padding: 14px 12px 20px;
    }

    #view-today.dashboard-today .today-dashboard-surface {
        padding: 12px;
    }

    #view-today.dashboard-today .summary-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    #view-today.dashboard-today .today-grid {
        grid-template-columns: 1fr;
        grid-template-areas:
            "commit"
            "due"
            "completed"
            "habits";
    }

    #view-today.dashboard-today .today-panel {
        min-height: 240px;
    }

    #view-today.dashboard-today .stats-grid {
        grid-template-columns: 1fr;
    }

}

@media (max-width: 640px) {
    #view-today.dashboard-today .summary-grid {
        grid-template-columns: 1fr;
    }

    #view-today.dashboard-today .today-header-actions {
        width: 100%;
        justify-content: flex-start;
    }

    #view-today.dashboard-today .card-categories .card-content {
        flex-direction: column;
        align-items: flex-start;
    }

    #view-today.dashboard-today #categoryDonut {
        width: 100%;
        max-width: 200px;
        min-width: 0;
        height: auto;
        aspect-ratio: 1 / 1;
        align-self: center;
    }
}

/* -------------------- College Tracker (Application Sheets sub-page) -------------------- */
#collegeappPage-sheets {
    gap: 18px;
    padding: 20px 20px 32px;
    flex-direction: column;
}

#collegeappPage-sheets .college-header-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
}

#collegeappPage-sheets .college-summary-grid {
    display: grid;
    grid-template-columns: repeat(5, minmax(0, 1fr));
    gap: 12px;
}

#collegeappPage-sheets .college-tracker-shell {
    padding: 14px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

#collegeappPage-sheets .college-sheet-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

#collegeappPage-sheets .college-sheet-tab {
    border: 1px solid var(--glass-border);
    background: var(--bg-secondary);
    color: var(--text-secondary);
    border-radius: 999px;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 0.86rem;
    font-weight: 600;
    transition: transform 0.16s ease, background 0.16s ease, color 0.16s ease;
}

#collegeappPage-sheets .college-sheet-tab:hover {
    transform: translateY(-1px);
}

#collegeappPage-sheets .college-sheet-tab.active {
    background: linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent) 62%, #ffffff 38%));
    color: #fff;
    border-color: transparent;
}

#collegeappPage-sheets .college-sheet-panel {
    display: none;
}

#collegeappPage-sheets .college-sheet-panel.active {
    display: block;
}

#collegeappPage-sheets .college-table-wrap {
    width: 100%;
    overflow-x: auto;
    border: 1px solid var(--glass-border);
    border-radius: 14px;
}

#collegeappPage-sheets .college-table {
    width: 100%;
    min-width: 1060px;
    border-collapse: collapse;
}

#collegeappPage-sheets .college-table thead th {
    font-size: 0.78rem;
    letter-spacing: 0.03em;
    text-transform: uppercase;
    color: var(--text-secondary);
    background: color-mix(in srgb, var(--bg-secondary) 74%, transparent);
    border-bottom: 1px solid var(--glass-border);
    padding: 10px 8px;
    position: sticky;
    top: 0;
    z-index: 1;
}

#collegeappPage-sheets .college-table tbody td {
    border-bottom: 1px solid color-mix(in srgb, var(--glass-border) 64%, transparent);
    padding: 8px;
    vertical-align: top;
}

#collegeappPage-sheets .college-empty-row td {
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.9rem;
    padding: 20px 10px;
}

#collegeappPage-sheets .college-input,
#collegeappPage-sheets .college-select,
#collegeappPage-sheets .college-textarea {
    width: 100%;
    min-width: 110px;
    background: color-mix(in srgb, var(--bg-secondary) 80%, transparent);
    color: var(--text-primary);
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    padding: 7px 9px;
    font-size: 0.84rem;
    outline: none;
}

#collegeappPage-sheets .college-textarea {
    resize: vertical;
    min-height: 42px;
    line-height: 1.35;
}

#collegeappPage-sheets .college-input:focus,
#collegeappPage-sheets .college-select:focus,
#collegeappPage-sheets .college-textarea:focus {
    border-color: color-mix(in srgb, var(--accent) 65%, #ffffff 35%);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 24%, transparent);
}

#collegeappPage-sheets .college-cell-center {
    text-align: center;
}

#collegeappPage-sheets .college-checkbox-input {
    width: 16px;
    height: 16px;
    accent-color: var(--accent);
    margin-top: 7px;
}

#collegeappPage-sheets .college-row-actions {
    text-align: center;
    width: 42px;
}

#collegeappPage-sheets .college-row-actions .icon-btn {
    width: 32px;
    height: 32px;
    border-radius: 10px;
}

@media (max-width: 1280px) {
    #collegeappPage-sheets .college-summary-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
    }
}

@media (max-width: 840px) {
    #collegeappPage-sheets {
        padding: 12px 12px 24px;
    }

    #collegeappPage-sheets .college-summary-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    #collegeappPage-sheets .college-tracker-shell {
        padding: 10px;
    }

    #collegeappPage-sheets .college-sheet-tabs {
        flex-wrap: nowrap;
        overflow-x: auto;
        padding-bottom: 4px;
        scrollbar-width: thin;
    }

    #collegeappPage-sheets .college-sheet-tab {
        flex: 0 0 auto;
        white-space: nowrap;
        font-size: 0.8rem;
        padding: 7px 10px;
    }

    #collegeappPage-sheets .college-table {
        min-width: 900px;
    }

    #collegeappPage-sheets .college-table thead th {
        font-size: 0.72rem;
        padding: 8px 7px;
    }

    #collegeappPage-sheets .college-table tbody td {
        padding: 7px;
    }

    #collegeappPage-sheets .college-input,
    #collegeappPage-sheets .college-select,
    #collegeappPage-sheets .college-textarea {
        min-width: 94px;
        font-size: 0.78rem;
        padding: 6px 7px;
    }
}

@media (max-width: 560px) {
    #collegeappPage-sheets .college-summary-grid {
        grid-template-columns: 1fr;
    }

    #collegeappPage-sheets .college-header-actions {
        width: 100%;
    }

    #collegeappPage-sheets .college-header-actions .neumo-btn {
        width: 100%;
        justify-content: center;
    }

    #collegeappPage-sheets .college-table {
        min-width: 780px;
    }

    #collegeappPage-sheets .college-sheet-tab {
        font-size: 0.76rem;
        padding: 6px 9px;
    }
}

/* -------------------- College App / Life -------------------- */
#view-collegeapp,
#view-life {
    --workspace-card-bg: linear-gradient(
        180deg,
        color-mix(in srgb, var(--bg-secondary) 90%, transparent),
        color-mix(in srgb, var(--bg-secondary) 76%, transparent)
    );
    --workspace-card-border: color-mix(in srgb, var(--glass-border) 86%, transparent);
    --workspace-table-head-bg: color-mix(in srgb, var(--bg-secondary) 82%, transparent);
    --workspace-row-border: color-mix(in srgb, var(--glass-border) 64%, transparent);
    --workspace-row-hover: color-mix(in srgb, var(--accent) 10%, var(--bg-secondary));
    grid-auto-rows: max-content;
    align-content: start;
    gap: 18px;
    padding: 22px 22px 36px;
}

#view-collegeapp.active,
#view-life.active {
    display: grid;
}

#view-collegeapp .view-header,
#view-life .view-header {
    margin-bottom: 2px;
    align-items: flex-end;
}

#view-collegeapp .view-header h2,
#view-life .view-header h2 {
    font-size: clamp(1.8rem, 3.2vw, 2.65rem);
    letter-spacing: -0.02em;
}

#view-collegeapp .eyebrow,
#view-life .eyebrow {
    font-size: 0.68rem;
    letter-spacing: 0.22em;
    color: color-mix(in srgb, var(--text-secondary) 90%, transparent);
}

.academic-header-actions,
.collegeapp-header-actions,
.life-header-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
}

.academic-header-actions .neumo-btn,
.collegeapp-header-actions .neumo-btn,
.life-header-actions .neumo-btn {
    min-height: 38px;
    border-radius: 999px;
    padding: 0 14px;
    font-size: 0.84rem;
    white-space: nowrap;
}

.academic-summary-grid,
.collegeapp-summary-grid,
.life-summary-grid {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

#view-collegeapp .summary-card,
#view-life .summary-card {
    min-height: 138px;
    padding: 18px 18px;
    border-radius: 16px;
    border: 1px solid var(--workspace-card-border);
    background: var(--workspace-card-bg);
    box-shadow: 0 10px 26px rgba(8, 12, 18, 0.16);
}

#view-collegeapp .summary-label,
#view-life .summary-label {
    font-size: 0.69rem;
    letter-spacing: 0.18em;
}

#view-collegeapp .summary-value,
#view-life .summary-value {
    font-size: clamp(1.95rem, 3.2vw, 2.5rem);
    margin-bottom: 8px;
    line-height: 1.05;
}

#view-collegeapp .summary-meta,
#view-life .summary-meta {
    font-size: 0.82rem;
}

/* ===== College App Dashboard Nav Grid ===== */
.collegeapp-nav-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 16px;
    margin-top: 8px;
}

.collegeapp-nav-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 28px 16px;
    border-radius: 18px;
    border: 1px solid var(--workspace-card-border);
    background: var(--workspace-card-bg);
    box-shadow: 6px 6px 16px var(--neumo-shadow-dark), -6px -6px 16px var(--neumo-shadow-light);
    color: var(--text-primary);
    cursor: pointer;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
    font-family: var(--font-body);
    font-size: 0.92rem;
    font-weight: 600;
    text-align: center;
    line-height: 1.3;
}

.collegeapp-nav-btn i {
    font-size: 1.6rem;
    color: var(--accent);
    transition: transform var(--transition-fast);
}

.collegeapp-nav-btn:hover {
    transform: translateY(-3px);
    box-shadow: 8px 8px 22px var(--neumo-shadow-dark), -8px -8px 22px var(--neumo-shadow-light);
    border-color: color-mix(in srgb, var(--accent) 50%, transparent);
}

.collegeapp-nav-btn:hover i {
    transform: scale(1.12);
}

.collegeapp-nav-btn:active {
    transform: translateY(0);
    box-shadow: inset 3px 3px 8px var(--neumo-shadow-dark), inset -3px -3px 8px var(--neumo-shadow-light);
}

/* Sub-page back button */
.collegeapp-back-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    margin-bottom: 14px;
    border-radius: var(--radius-pill);
    border: 1px solid var(--workspace-card-border);
    background: var(--workspace-card-bg);
    box-shadow: 4px 4px 12px var(--neumo-shadow-dark), -4px -4px 12px var(--neumo-shadow-light);
    color: var(--text-primary);
    font-family: var(--font-body);
    font-size: 0.86rem;
    font-weight: 600;
    cursor: pointer;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
}

.collegeapp-back-btn:hover {
    transform: translateY(-1px);
    box-shadow: 6px 6px 16px var(--neumo-shadow-dark), -6px -6px 16px var(--neumo-shadow-light);
}

.collegeapp-back-btn:active {
    transform: translateY(0);
    box-shadow: inset 2px 2px 6px var(--neumo-shadow-dark), inset -2px -2px 6px var(--neumo-shadow-light);
}

.collegeapp-back-btn i {
    color: var(--accent);
}

/* Sub-page animation */
.collegeapp-subpage {
    animation: collegeappPageFadeIn 260ms cubic-bezier(0.22, 1, 0.36, 1);
}

#collegeappPage-decision {
    display: flex;
    flex-direction: column;
    gap: 18px;
}

@keyframes collegeappPageFadeIn {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* ===== Life Dashboard Nav Grid ===== */
.life-nav-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 16px;
    margin-top: 8px;
}

.life-nav-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 28px 16px;
    border-radius: 18px;
    border: 1px solid var(--workspace-card-border);
    background: var(--workspace-card-bg);
    box-shadow: 6px 6px 16px var(--neumo-shadow-dark), -6px -6px 16px var(--neumo-shadow-light);
    color: var(--text-primary);
    cursor: pointer;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
    font-family: var(--font-body);
    font-size: 0.92rem;
    font-weight: 600;
    text-align: center;
    line-height: 1.3;
}

.life-nav-btn i {
    font-size: 1.6rem;
    color: var(--accent);
    transition: transform var(--transition-fast);
}

.life-nav-btn:hover {
    transform: translateY(-3px);
    box-shadow: 8px 8px 22px var(--neumo-shadow-dark), -8px -8px 22px var(--neumo-shadow-light);
    border-color: color-mix(in srgb, var(--accent) 50%, transparent);
}

.life-nav-btn:hover i {
    transform: scale(1.12);
}

.life-nav-btn:active {
    transform: translateY(0);
    box-shadow: inset 3px 3px 8px var(--neumo-shadow-dark), inset -3px -3px 8px var(--neumo-shadow-light);
}

/* Life sub-page back button */
.life-back-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    margin-bottom: 14px;
    border-radius: var(--radius-pill);
    border: 1px solid var(--workspace-card-border);
    background: var(--workspace-card-bg);
    box-shadow: 4px 4px 12px var(--neumo-shadow-dark), -4px -4px 12px var(--neumo-shadow-light);
    color: var(--text-primary);
    font-family: var(--font-body);
    font-size: 0.86rem;
    font-weight: 600;
    cursor: pointer;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
}

.life-back-btn:hover {
    transform: translateY(-1px);
    box-shadow: 6px 6px 16px var(--neumo-shadow-dark), -6px -6px 16px var(--neumo-shadow-light);
}

.life-back-btn:active {
    transform: translateY(0);
    box-shadow: inset 2px 2px 6px var(--neumo-shadow-dark), inset -2px -2px 6px var(--neumo-shadow-light);
}

.life-back-btn i {
    color: var(--accent);
}

/* Life sub-page animation */
.life-subpage {
    animation: lifePageFadeIn 260ms cubic-bezier(0.22, 1, 0.36, 1);
}

@keyframes lifePageFadeIn {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* Mobile tweaks */
@media (max-width: 600px) {
    .collegeapp-nav-grid,
    .life-nav-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    .collegeapp-nav-btn,
    .life-nav-btn {
        padding: 20px 12px;
        font-size: 0.84rem;
    }
    .collegeapp-nav-btn i,
    .life-nav-btn i {
        font-size: 1.35rem;
    }
}

.academic-module-card {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    justify-content: flex-start;
    min-height: 0;
    border-radius: 16px;
    border: 1px solid var(--workspace-card-border);
    background: var(--workspace-card-bg);
    box-shadow: 0 10px 24px rgba(8, 12, 18, 0.14);
}

.academic-module-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
}

.academic-module-head h3 {
    margin: 0;
    font-size: 1.13rem;
    font-weight: 700;
    line-height: 1.3;
    letter-spacing: -0.01em;
}

.academic-lite-card p {
    margin: 0;
    color: var(--text-secondary);
    line-height: 1.5;
}

#view-collegeapp .college-table-wrap,
#view-life .college-table-wrap {
    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 95%, transparent);
    border-radius: 13px;
    -webkit-overflow-scrolling: touch;
    max-height: none;
    background: color-mix(in srgb, var(--bg-secondary) 70%, transparent);
    scrollbar-width: thin;
}

#view-collegeapp .college-table,
#view-life .college-table {
    width: 100%;
    min-width: 960px;
    border-collapse: collapse;
    height: auto;
    table-layout: auto;
}

#view-collegeapp .college-table thead,
#view-life .college-table thead {
    display: table-header-group;
}

#view-collegeapp .college-table tbody,
#view-life .college-table tbody {
    display: table-row-group;
}

#view-collegeapp .college-table tr,
#view-life .college-table tr {
    display: table-row;
}

#view-collegeapp .college-table th,
#view-life .college-table th,
#view-collegeapp .college-table td,
#view-life .college-table td {
    display: table-cell;
}

#view-collegeapp .college-table thead th,
#view-life .college-table thead th {
    font-size: 0.72rem;
    letter-spacing: 0.14em;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--text-secondary);
    background: var(--workspace-table-head-bg);
    border-bottom: 1px solid var(--workspace-row-border);
    padding: 12px 10px;
    white-space: nowrap;
    position: static;
    top: auto;
}

#view-collegeapp .college-table tbody tr,
#view-life .college-table tbody tr {
    transition: background-color 140ms ease;
}

#view-collegeapp .college-table tbody tr:nth-child(even),
#view-life .college-table tbody tr:nth-child(even) {
    background: color-mix(in srgb, var(--bg-secondary) 88%, transparent);
}

#view-collegeapp .college-table tbody tr:hover,
#view-life .college-table tbody tr:hover {
    background: var(--workspace-row-hover);
}

#view-collegeapp .college-table tbody td,
#view-life .college-table tbody td {
    border-bottom: 1px solid var(--workspace-row-border);
    padding: 11px 10px;
    vertical-align: middle;
}

#view-collegeapp .college-empty-row td,
#view-life .college-empty-row td {
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.9rem;
    padding: 20px 10px;
}

#view-collegeapp .college-input,
#view-life .college-input,
#view-collegeapp .college-select,
#view-life .college-select,
#view-collegeapp .college-textarea,
#view-life .college-textarea {
    width: 100%;
    min-width: 110px;
    min-height: 36px;
    background: color-mix(in srgb, var(--bg-secondary) 88%, transparent);
    color: var(--text-primary);
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 90%, transparent);
    border-radius: 10px;
    padding: 7px 10px;
    font-size: 0.86rem;
    line-height: 1.25;
    outline: none;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
}

#view-collegeapp .college-table .nf-select,
#view-life .college-table .nf-select {
    width: 100%;
    min-width: 110px;
}

#view-collegeapp .college-table .nf-date,
#view-life .college-table .nf-date {
    width: 100%;
    min-width: 110px;
}

#view-collegeapp .college-table .nf-select-trigger,
#view-life .college-table .nf-select-trigger {
    min-height: 36px;
    border-radius: 10px;
    padding: 7px 32px 7px 10px;
    font-size: 0.86rem;
    background: color-mix(in srgb, var(--bg-secondary) 88%, transparent);
    border-color: color-mix(in srgb, var(--workspace-card-border) 90%, transparent);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
}

#view-collegeapp .college-table .nf-date-trigger,
#view-life .college-table .nf-date-trigger {
    min-height: 36px;
    border-radius: 10px;
    padding: 7px 34px 7px 10px;
    font-size: 0.86rem;
    background: color-mix(in srgb, var(--bg-secondary) 88%, transparent);
    border-color: color-mix(in srgb, var(--workspace-card-border) 90%, transparent);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
}

#view-collegeapp .college-table .nf-select:not(.is-disabled) .nf-select-trigger:hover,
#view-life .college-table .nf-select:not(.is-disabled) .nf-select-trigger:hover {
    transform: none;
    border-color: color-mix(in srgb, var(--accent) 76%, #ffffff 24%);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 18%, transparent);
}

#view-collegeapp .college-table .nf-select.open .nf-select-trigger,
#view-life .college-table .nf-select.open .nf-select-trigger {
    border-color: color-mix(in srgb, var(--accent) 76%, #ffffff 24%);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 22%, transparent);
}

#view-collegeapp .college-table .nf-date:not(.is-disabled) .nf-date-trigger:hover,
#view-life .college-table .nf-date:not(.is-disabled) .nf-date-trigger:hover {
    transform: none;
    border-color: color-mix(in srgb, var(--accent) 76%, #ffffff 24%);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 18%, transparent);
}

#view-collegeapp .college-table .nf-date.open .nf-date-trigger,
#view-life .college-table .nf-date.open .nf-date-trigger {
    border-color: color-mix(in srgb, var(--accent) 76%, #ffffff 24%);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 22%, transparent);
}

#view-collegeapp .college-table .nf-select-chevron,
#view-life .college-table .nf-select-chevron {
    right: 11px;
    width: 9px;
    height: 9px;
    border-width: 1.7px;
}

#view-collegeapp .college-table .nf-date-icon,
#view-life .college-table .nf-date-icon {
    right: 10px;
    width: 14px;
    height: 14px;
}

#view-collegeapp .college-textarea,
#view-life .college-textarea {
    resize: vertical;
    min-height: 56px;
    line-height: 1.35;
}

#view-collegeapp .college-input::placeholder,
#view-life .college-input::placeholder,
#view-collegeapp .college-textarea::placeholder,
#view-life .college-textarea::placeholder {
    color: color-mix(in srgb, var(--text-secondary) 85%, transparent);
}

#view-collegeapp .college-input:focus,
#view-life .college-input:focus,
#view-collegeapp .college-select:focus,
#view-life .college-select:focus,
#view-collegeapp .college-textarea:focus,
#view-life .college-textarea:focus {
    border-color: color-mix(in srgb, var(--accent) 76%, #ffffff 24%);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 22%, transparent);
}

#view-collegeapp .college-cell-center,
#view-life .college-cell-center {
    text-align: center;
}

#view-collegeapp .college-checkbox-input,
#view-life .college-checkbox-input {
    width: 16px;
    height: 16px;
    accent-color: var(--accent);
    margin-top: 7px;
}

#view-collegeapp .college-row-actions,
#view-life .college-row-actions {
    text-align: center;
    width: 48px;
}

#view-collegeapp .college-row-actions .icon-btn,
#view-life .college-row-actions .icon-btn {
    width: 34px;
    height: 34px;
    border-radius: 11px;
    background: color-mix(in srgb, var(--bg-secondary) 80%, transparent);
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 85%, transparent);
}

.academic-filter-grid {
    display: grid;
    grid-template-columns: repeat(5, minmax(160px, 1fr));
    gap: 12px;
    align-items: start;
    padding: 2px 0;
}

.academic-filter-field {
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 0;
}

.academic-filter-grid label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    font-weight: 700;
    color: var(--text-secondary);
}

/* ===== Decision Matrix  Card-Based Redesign ===== */

/* Hero card  top pick spotlight */
.dm-hero {
    position: relative;
    display: flex;
    align-items: center;
    gap: 18px;
    padding: 22px 26px 18px;
    border-radius: 18px;
    border: 1px solid color-mix(in srgb, var(--accent) 40%, transparent);
    background: linear-gradient(135deg, color-mix(in srgb, var(--accent) 10%, var(--bg-secondary)), color-mix(in srgb, var(--accent) 4%, var(--bg-secondary)));
    box-shadow: 0 12px 32px rgba(0,0,0,0.10), inset 0 1px 0 rgba(255,255,255,0.12);
    overflow: hidden;
}

.dm-hero-badge {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent) 70%, #fff));
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    box-shadow: 0 6px 18px rgba(210,167,77,0.30);
}

.dm-hero-badge i {
    font-size: 1.35rem;
    color: #fff;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

.dm-hero-body { flex: 1; min-width: 0; }

.dm-hero-label {
    font-size: 0.62rem;
    letter-spacing: 0.24em;
    text-transform: uppercase;
    font-weight: 800;
    color: var(--accent);
    margin-bottom: 2px;
}

.dm-hero-name {
    font-size: 1.35rem;
    font-weight: 800;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
}

.dm-hero-score {
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--text-secondary);
    font-variant-numeric: tabular-nums;
    margin-top: 1px;
}

.dm-hero-bar-wrap {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 4px;
    background: var(--surface-bg);
}

.dm-hero-bar {
    height: 100%;
    border-radius: 0 4px 0 0;
    background: linear-gradient(90deg, var(--accent), color-mix(in srgb, var(--accent) 60%, #ffdf80));
    transition: width 420ms cubic-bezier(0.22,1,0.36,1);
}

/* Actions row */
.dm-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.dm-actions .neumo-btn {
    box-shadow: none;
    border: 1px solid color-mix(in srgb, var(--accent) 35%, transparent);
    background: color-mix(in srgb, var(--accent) 8%, var(--bg-secondary));
    color: var(--accent);
    font-size: 0.82rem;
    font-weight: 700;
    padding: 8px 16px;
    border-radius: 10px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transition: background var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
}

.dm-actions .neumo-btn:hover {
    background: color-mix(in srgb, var(--accent) 16%, var(--bg-secondary));
    border-color: color-mix(in srgb, var(--accent) 55%, transparent);
    transform: translateY(-1px);
}

.dm-actions .neumo-btn:active {
    transform: translateY(0);
    box-shadow: none;
}

[data-theme="dark"] .dm-actions .neumo-btn {
    background: color-mix(in srgb, var(--accent) 10%, transparent);
    border-color: color-mix(in srgb, var(--accent) 25%, transparent);
}

[data-theme="dark"] .dm-actions .neumo-btn:hover {
    background: color-mix(in srgb, var(--accent) 18%, transparent);
    border-color: color-mix(in srgb, var(--accent) 40%, transparent);
}

/* ---- Layout: stacked ---- */
.dm-layout {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.dm-panel {
    border-radius: 16px;
    border: 1px solid var(--workspace-card-border);
    background: var(--workspace-card-bg);
    box-shadow: 0 8px 24px rgba(8,12,18,0.12);
    overflow: hidden;
}

.dm-panel-head {
    padding: 14px 18px 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.dm-panel-head h4 {
    margin: 0;
    font-size: 0.78rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    font-weight: 700;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 8px;
}

.dm-panel-head h4 i {
    color: var(--accent);
    font-size: 0.82rem;
}

/* Criteria toggle button */
.dm-criteria-toggle-btn {
    background: none;
    border: 1px solid color-mix(in srgb, var(--glass-border) 60%, transparent);
    border-radius: 8px;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text-secondary);
    font-size: 0.72rem;
    transition: transform var(--transition-fast), background var(--transition-fast);
}

.dm-criteria-toggle-btn:hover {
    background: color-mix(in srgb, var(--accent) 10%, transparent);
}

/* ---- Criteria panel: compact 2-col grid ---- */
.dm-criteria-list {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0;
    padding: 0 14px 14px;
    max-height: 420px;
    overflow-y: auto;
    scrollbar-width: thin;
    transition: max-height 0.3s ease, padding 0.3s ease, opacity 0.3s ease;
}

.dm-criteria-panel.collapsed .dm-criteria-list {
    max-height: 0;
    padding-top: 0;
    padding-bottom: 0;
    overflow: hidden;
    opacity: 0;
}

.dm-criterion-card {
    display: grid;
    grid-template-columns: 1fr auto auto;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    border-bottom: 1px solid color-mix(in srgb, var(--workspace-card-border) 40%, transparent);
    transition: background var(--transition-fast);
}

.dm-criterion-card:nth-last-child(-n+2) {
    border-bottom: none;
}

.dm-criterion-card:hover {
    background: color-mix(in srgb, var(--accent) 5%, transparent);
}

.dm-criterion-name-input {
    border: none;
    background: transparent;
    font-family: var(--font-body);
    font-size: 0.84rem;
    font-weight: 600;
    color: var(--text-primary);
    outline: none;
    width: 100%;
    min-width: 0;
}

.dm-criterion-name-input::placeholder {
    color: var(--text-muted);
}

.dm-criterion-weight {
    display: flex;
    align-items: center;
    gap: 6px;
    min-width: 90px;
}

.dm-criterion-weight-bar-wrap {
    flex: 1;
    height: 5px;
    border-radius: 5px;
    background: color-mix(in srgb, var(--bg-secondary) 80%, transparent);
    overflow: hidden;
    min-width: 36px;
}

.dm-criterion-weight-bar {
    height: 100%;
    border-radius: 5px;
    background: var(--accent);
    transition: width 280ms cubic-bezier(0.22,1,0.36,1);
}

.dm-criterion-weight-input {
    width: 40px;
    text-align: center;
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 70%, transparent);
    border-radius: 8px;
    background: transparent;
    font-family: var(--font-body);
    font-size: 0.78rem;
    font-weight: 700;
    font-variant-numeric: tabular-nums;
    color: var(--accent);
    padding: 3px 2px;
    outline: none;
    transition: border-color var(--transition-fast);
}

.dm-criterion-weight-input:focus {
    border-color: var(--accent);
}

.dm-criterion-delete {
    opacity: 0;
    transition: opacity var(--transition-fast);
}

.dm-criterion-card:hover .dm-criterion-delete {
    opacity: 1;
}

/* Empty state */
.dm-empty {
    text-align: center;
    padding: 28px 16px;
    color: var(--text-muted);
    font-size: 0.84rem;
}

.dm-empty i {
    font-size: 1.6rem;
    color: var(--accent);
    opacity: 0.4;
    display: block;
    margin-bottom: 8px;
}

/* ---- College Score Cards ---- */
.dm-college-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: 14px;
    padding: 0 14px 14px;
}

.dm-college-card {
    border-radius: 14px;
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 80%, transparent);
    background: color-mix(in srgb, var(--bg-secondary) 60%, transparent);
    overflow: hidden;
    transition: box-shadow var(--transition-fast), border-color var(--transition-fast);
}

.dm-college-card:hover {
    box-shadow: 0 6px 20px rgba(0,0,0,0.10);
    border-color: color-mix(in srgb, var(--accent) 30%, transparent);
}

.dm-college-card-head {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 14px 16px 10px;
    border-bottom: 1px solid color-mix(in srgb, var(--workspace-card-border) 50%, transparent);
}

.dm-college-name-input {
    border: none;
    background: transparent;
    font-family: var(--font-body);
    font-size: 1rem;
    font-weight: 700;
    color: var(--text-primary);
    outline: none;
    flex: 1;
    min-width: 0;
}

.dm-college-name-input::placeholder {
    color: var(--text-muted);
}

.dm-college-card-score {
    display: flex;
    align-items: baseline;
    gap: 3px;
    flex-shrink: 0;
}

.dm-weighted-total {
    font-weight: 800;
    font-variant-numeric: tabular-nums;
    color: var(--accent);
    font-size: 1.15rem;
}

.dm-weighted-sub {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text-muted);
}

.dm-college-card-delete {
    opacity: 0.3;
    transition: opacity var(--transition-fast);
}

.dm-college-card:hover .dm-college-card-delete {
    opacity: 1;
}

.dm-college-card-body {
    padding: 8px 0;
    max-height: 380px;
    overflow-y: auto;
    scrollbar-width: thin;
}

/* Individual score row inside card */
.dm-card-row {
    display: grid;
    grid-template-columns: 1fr auto auto 52px;
    align-items: center;
    gap: 8px;
    padding: 5px 16px;
    transition: background var(--transition-fast);
}

.dm-card-row:hover {
    background: color-mix(in srgb, var(--accent) 5%, transparent);
}

.dm-card-row-zero {
    opacity: 0.55;
}

.dm-card-row-zero:hover {
    opacity: 1;
}

.dm-card-criterion-name {
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.dm-card-criterion-weight {
    font-size: 0.66rem;
    font-weight: 600;
    color: var(--text-muted);
    letter-spacing: 0.04em;
    flex-shrink: 0;
}

.dm-card-score-bar-wrap {
    width: 54px;
    height: 5px;
    border-radius: 5px;
    background: color-mix(in srgb, var(--bg-secondary) 80%, transparent);
    overflow: hidden;
    flex-shrink: 0;
}

.dm-card-score-bar {
    height: 100%;
    border-radius: 5px;
    background: var(--accent);
    transition: width 280ms cubic-bezier(0.22,1,0.36,1);
}

.dm-score-input {
    width: 48px;
    text-align: center;
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 60%, transparent);
    border-radius: 8px;
    background: color-mix(in srgb, var(--bg-secondary) 50%, transparent);
    font-family: var(--font-body);
    font-size: 0.82rem;
    font-weight: 600;
    font-variant-numeric: tabular-nums;
    color: var(--text-primary);
    padding: 4px 2px;
    outline: none;
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
}

.dm-score-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 18%, transparent);
}

/* ---- Rankings ---- */
.dm-ranking-section {
    border-radius: 16px;
    border: 1px solid var(--workspace-card-border);
    background: var(--workspace-card-bg);
    box-shadow: 0 8px 24px rgba(8,12,18,0.12);
    overflow: hidden;
}

.dm-ranking-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 12px;
    padding: 0 16px 16px;
}

.dm-rank-card {
    position: relative;
    border-radius: 14px;
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 90%, transparent);
    background: color-mix(in srgb, var(--bg-secondary) 90%, transparent);
    padding: 18px 16px 14px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
}

.dm-rank-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 28px rgba(0,0,0,0.12);
}

.dm-rank-card[data-rank="1"] {
    border-color: rgba(255, 215, 0, 0.45);
    background: linear-gradient(135deg, rgba(255,215,0,0.08), rgba(255,215,0,0.02));
}

.dm-rank-card[data-rank="2"] {
    border-color: rgba(192, 192, 192, 0.35);
    background: linear-gradient(135deg, rgba(192,192,192,0.06), rgba(192,192,192,0.01));
}

.dm-rank-card[data-rank="3"] {
    border-color: rgba(205, 127, 50, 0.35);
    background: linear-gradient(135deg, rgba(205,127,50,0.06), rgba(205,127,50,0.01));
}

.dm-rank-header {
    display: flex;
    align-items: center;
    gap: 10px;
}

.dm-rank-badge {
    width: 34px;
    height: 34px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.78rem;
    font-weight: 800;
    flex-shrink: 0;
    background: color-mix(in srgb, var(--bg-secondary) 80%, transparent);
    color: var(--text-secondary);
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 70%, transparent);
}

.dm-rank-card[data-rank="1"] .dm-rank-badge {
    background: linear-gradient(135deg, #ffd700, #f0c060);
    color: #5a4200;
    border-color: transparent;
    box-shadow: 0 4px 12px rgba(255,215,0,0.35);
}

.dm-rank-card[data-rank="2"] .dm-rank-badge {
    background: linear-gradient(135deg, #c0c0c0, #e0e0e0);
    color: #444;
    border-color: transparent;
    box-shadow: 0 4px 10px rgba(192,192,192,0.35);
}

.dm-rank-card[data-rank="3"] .dm-rank-badge {
    background: linear-gradient(135deg, #cd7f32, #e0a060);
    color: #3a2200;
    border-color: transparent;
    box-shadow: 0 4px 10px rgba(205,127,50,0.35);
}

.dm-rank-name {
    font-weight: 700;
    font-size: 0.94rem;
    color: var(--text-primary);
    flex: 1;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.dm-rank-score-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}

.dm-rank-score-label {
    font-size: 0.68rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    font-weight: 600;
    color: var(--text-muted);
}

.dm-rank-score-value {
    font-size: 1.1rem;
    font-weight: 800;
    font-variant-numeric: tabular-nums;
    color: var(--accent);
}

.dm-rank-bar-wrap {
    width: 100%;
    height: 6px;
    border-radius: 6px;
    background: color-mix(in srgb, var(--bg-secondary) 80%, transparent);
    overflow: hidden;
}

.dm-rank-bar {
    height: 100%;
    border-radius: 6px;
    background: var(--accent);
    transition: width 380ms cubic-bezier(0.22,1,0.36,1);
}

.dm-rank-card[data-rank="1"] .dm-rank-bar {
    background: linear-gradient(90deg, #ffd700, #f0c060);
}

.dm-rank-card[data-rank="2"] .dm-rank-bar {
    background: linear-gradient(90deg, #b0b0b0, #d0d0d0);
}

.dm-rank-card[data-rank="3"] .dm-rank-bar {
    background: linear-gradient(90deg, #cd7f32, #dda560);
}

/* Dark mode overrides */
[data-theme="dark"] .dm-hero {
    box-shadow: 0 12px 32px rgba(0,0,0,0.36), inset 0 1px 0 rgba(255,255,255,0.04);
    border-color: color-mix(in srgb, var(--accent) 30%, transparent);
    background: linear-gradient(135deg, color-mix(in srgb, var(--accent) 12%, var(--bg-secondary)), color-mix(in srgb, var(--accent) 3%, var(--bg-secondary)));
}

[data-theme="dark"] .dm-panel,
[data-theme="dark"] .dm-ranking-section {
    box-shadow: 0 8px 24px rgba(0,0,0,0.36);
    border-color: rgba(255,255,255,0.06);
    background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.015));
}

[data-theme="dark"] .dm-criterion-card:hover,
[data-theme="dark"] .dm-card-row:hover {
    background: color-mix(in srgb, var(--accent) 6%, transparent);
}

[data-theme="dark"] .dm-criterion-weight-bar-wrap,
[data-theme="dark"] .dm-rank-bar-wrap,
[data-theme="dark"] .dm-card-score-bar-wrap {
    background: rgba(255,255,255,0.06);
}

[data-theme="dark"] .dm-score-input {
    background: rgba(255,255,255,0.04);
    border-color: rgba(255,255,255,0.08);
}

[data-theme="dark"] .dm-score-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(210,167,77,0.18);
}

[data-theme="dark"] .dm-criterion-weight-input {
    border-color: rgba(255,255,255,0.08);
}

[data-theme="dark"] .dm-college-card {
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
    border-color: rgba(255,255,255,0.07);
}

[data-theme="dark"] .dm-college-card:hover {
    border-color: color-mix(in srgb, var(--accent) 25%, transparent);
}

[data-theme="dark"] .dm-rank-card {
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
    border-color: rgba(255,255,255,0.07);
}

[data-theme="dark"] .dm-rank-card[data-rank="1"] {
    border-color: rgba(255,215,0,0.28);
    background: linear-gradient(135deg, rgba(255,215,0,0.08), rgba(255,215,0,0.02));
}

[data-theme="dark"] .dm-rank-card[data-rank="2"] {
    border-color: rgba(192,192,192,0.2);
    background: linear-gradient(135deg, rgba(192,192,192,0.06), rgba(192,192,192,0.015));
}

[data-theme="dark"] .dm-rank-card[data-rank="3"] {
    border-color: rgba(205,127,50,0.22);
    background: linear-gradient(135deg, rgba(205,127,50,0.06), rgba(205,127,50,0.015));
}

[data-theme="dark"] .dm-hero-bar-wrap {
    background: rgba(255,255,255,0.04);
}

/* Responsive */
@media (max-width: 960px) {
    .dm-criteria-list {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 600px) {
    .dm-hero {
        flex-direction: column;
        text-align: center;
        gap: 12px;
        padding: 18px 16px 14px;
    }
    .dm-ranking-grid {
        grid-template-columns: 1fr;
    }
    .dm-hero-name {
        font-size: 1.15rem;
    }
    .dm-college-cards {
        grid-template-columns: 1fr;
    }
    .dm-criteria-list {
        grid-template-columns: 1fr;
    }
}

.life-spending-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 8px;
}

.life-spending-summary-item {
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 84%, transparent);
    border-radius: 10px;
    padding: 9px 11px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    background: color-mix(in srgb, var(--bg-secondary) 82%, transparent);
}

/* ===== Spending Tracker Professional Styles ===== */
.spending-stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 14px;
    margin-bottom: 14px;
}

.spending-stat-card {
    border-radius: 14px;
    border: 1px solid var(--workspace-card-border);
    background: var(--workspace-card-bg);
    box-shadow: 0 6px 18px rgba(8, 12, 18, 0.1);
    padding: 16px 18px;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.spending-stat-label {
    font-size: 0.68rem;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    font-weight: 700;
    color: var(--text-secondary);
}

.spending-stat-value {
    font-size: 1.55rem;
    font-weight: 800;
    font-variant-numeric: tabular-nums;
    color: var(--text-primary);
    line-height: 1.15;
}

.spending-stat-value-sm {
    font-size: 1.05rem;
    font-weight: 700;
}

/* Breakdown table */
.spending-breakdown-card {
    margin-bottom: 0;
}

.spending-breakdown-table .spending-col-right,
.spending-ledger-table .spending-col-right {
    text-align: right;
    font-variant-numeric: tabular-nums;
}

.spending-breakdown-table thead th {
    font-size: 0.7rem !important;
}

.spending-breakdown-table tbody td {
    font-size: 0.88rem;
}

.spending-breakdown-table tfoot td {
    font-weight: 800;
    font-size: 0.9rem;
    border-top: 2px solid var(--accent);
    padding-top: 10px;
    padding-bottom: 10px;
}

.spending-cat-bar-wrap {
    width: 100%;
    height: 8px;
    border-radius: 8px;
    background: color-mix(in srgb, var(--bg-secondary) 80%, transparent);
    overflow: hidden;
}

.spending-cat-bar {
    height: 100%;
    border-radius: 8px;
    background: var(--accent);
    transition: width 320ms cubic-bezier(0.22, 1, 0.36, 1);
}

/* Ledger table */
.spending-ledger-table tbody td input[type="number"] {
    text-align: right;
    font-variant-numeric: tabular-nums;
}

.spending-ledger-table tbody td input[type="date"] {
    min-width: 130px;
}

.spending-period-label {
    font-size: 0.78rem;
    font-weight: 500;
    color: var(--text-secondary);
    margin-left: 6px;
}

@media (max-width: 600px) {
    .spending-stats-row {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    .spending-stat-card {
        padding: 12px 14px;
    }
    .spending-stat-value {
        font-size: 1.25rem;
    }
}

#view-today .today-academic-section {
    --workspace-card-bg: linear-gradient(
        180deg,
        color-mix(in srgb, var(--bg-secondary) 90%, transparent),
        color-mix(in srgb, var(--bg-secondary) 76%, transparent)
    );
    --workspace-card-border: color-mix(in srgb, var(--glass-border) 86%, transparent);
    --workspace-table-head-bg: color-mix(in srgb, var(--bg-secondary) 82%, transparent);
    --workspace-row-border: color-mix(in srgb, var(--glass-border) 64%, transparent);
    --workspace-row-hover: color-mix(in srgb, var(--accent) 10%, var(--bg-secondary));
    display: grid;
    grid-auto-rows: max-content;
    align-content: start;
    gap: 18px;
}

#view-today .today-academic-section .today-academic-header {
    margin-bottom: 2px;
    align-items: flex-end;
}

#view-today .today-academic-section .today-academic-summary-grid {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

#view-today .today-academic-section .summary-card {
    min-height: 138px;
    padding: 18px 18px;
    border-radius: 16px;
    border: 1px solid var(--workspace-card-border);
    background: var(--workspace-card-bg);
    box-shadow: 0 10px 26px rgba(8, 12, 18, 0.16);
}

#view-today .today-academic-section .summary-label {
    font-size: 0.69rem;
    letter-spacing: 0.18em;
}

#view-today .today-academic-section .summary-value {
    font-size: clamp(1.95rem, 3.2vw, 2.5rem);
    margin-bottom: 8px;
    line-height: 1.05;
}

#view-today .today-academic-section .summary-meta {
    font-size: 0.82rem;
}

#view-today .today-academic-section .today-academic-module-stack {
    display: grid;
    gap: 14px;
}

#view-today .today-academic-section .today-academic-add-form {
    display: grid;
    gap: 12px;
    padding: 12px;
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 92%, transparent);
    border-radius: 12px;
    background: color-mix(in srgb, var(--bg-secondary) 76%, transparent);
}

#view-today .today-academic-section .today-academic-add-grid {
    display: grid;
    grid-template-columns: repeat(4, minmax(140px, 1fr));
    gap: 10px;
}

#view-today .today-academic-section .today-academic-add-notes {
    grid-column: span 2;
}

#view-today .today-academic-section .today-academic-add-actions {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
    flex-wrap: wrap;
}

#view-today .today-academic-section #todayAcademicNewTimeWrap.is-hidden {
    display: none;
}

#view-today .today-academic-section .today-academic-add-form .college-input,
#view-today .today-academic-section .today-academic-add-form .college-select,
#view-today .today-academic-section .today-academic-add-form .college-textarea {
    min-width: 0;
}

#view-today .today-academic-section .today-academic-add-form .nf-select,
#view-today .today-academic-section .today-academic-add-form .nf-date {
    width: 100%;
    min-width: 0;
}

#view-today .today-academic-section .today-academic-add-form .nf-select-trigger,
#view-today .today-academic-section .today-academic-add-form .nf-date-trigger {
    min-height: 36px;
    border-radius: 10px;
    padding: 7px 34px 7px 10px;
    font-size: 0.86rem;
    background: color-mix(in srgb, var(--bg-secondary) 88%, transparent);
    border-color: color-mix(in srgb, var(--workspace-card-border) 90%, transparent);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
}

#view-today .today-academic-section .academic-module-card {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    justify-content: flex-start;
    min-height: 0;
    border-radius: 16px;
    border: 1px solid var(--workspace-card-border);
    background: var(--workspace-card-bg);
    box-shadow: 0 10px 24px rgba(8, 12, 18, 0.14);
}

#view-today .today-academic-section .academic-module-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
}

#view-today .today-academic-section .academic-module-head h3 {
    margin: 0;
    font-size: 1.13rem;
    font-weight: 700;
    line-height: 1.3;
    letter-spacing: -0.01em;
}

#view-today .today-academic-section .college-table-wrap {
    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 95%, transparent);
    border-radius: 13px;
    -webkit-overflow-scrolling: touch;
    max-height: none;
    background: color-mix(in srgb, var(--bg-secondary) 70%, transparent);
    scrollbar-width: thin;
}

#view-today .today-academic-section .college-table {
    width: 100%;
    min-width: 960px;
    border-collapse: collapse;
    table-layout: auto;
}

#view-today .today-academic-section .college-table thead th {
    font-size: 0.72rem;
    letter-spacing: 0.14em;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--text-secondary);
    background: var(--workspace-table-head-bg);
    border-bottom: 1px solid var(--workspace-row-border);
    padding: 12px 10px;
    white-space: nowrap;
}

#view-today .today-academic-section .college-table tbody tr {
    transition: background-color 140ms ease;
}

#view-today .today-academic-section .college-table tbody tr:nth-child(even) {
    background: color-mix(in srgb, var(--bg-secondary) 88%, transparent);
}

#view-today .today-academic-section .college-table tbody tr:hover {
    background: var(--workspace-row-hover);
}

#view-today .today-academic-section .college-table tbody td {
    border-bottom: 1px solid var(--workspace-row-border);
    padding: 11px 10px;
    vertical-align: middle;
}

#view-today .today-academic-section .college-empty-row td {
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.9rem;
    padding: 20px 10px;
}

#view-today .today-academic-section .college-input,
#view-today .today-academic-section .college-select,
#view-today .today-academic-section .college-textarea {
    width: 100%;
    min-width: 110px;
    min-height: 36px;
    background: color-mix(in srgb, var(--bg-secondary) 88%, transparent);
    color: var(--text-primary);
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 90%, transparent);
    border-radius: 10px;
    padding: 7px 10px;
    font-size: 0.86rem;
    line-height: 1.25;
    outline: none;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
}

#view-today .today-academic-section .college-textarea {
    resize: vertical;
    min-height: 56px;
    line-height: 1.35;
}

#view-today .today-academic-section .college-input::placeholder,
#view-today .today-academic-section .college-textarea::placeholder {
    color: color-mix(in srgb, var(--text-secondary) 85%, transparent);
}

#view-today .today-academic-section .college-input:focus,
#view-today .today-academic-section .college-select:focus,
#view-today .today-academic-section .college-textarea:focus {
    border-color: color-mix(in srgb, var(--accent) 76%, #ffffff 24%);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 22%, transparent);
}

#view-today .today-academic-section .college-row-actions {
    text-align: center;
    width: 48px;
}

#view-today .today-academic-section .college-row-actions .icon-btn {
    width: 34px;
    height: 34px;
    border-radius: 11px;
    background: color-mix(in srgb, var(--bg-secondary) 80%, transparent);
    border: 1px solid color-mix(in srgb, var(--workspace-card-border) 85%, transparent);
}

#view-today .today-academic-section .college-table .nf-select,
#view-today .today-academic-section .college-table .nf-date {
    width: 100%;
    min-width: 110px;
}

#view-today .today-academic-section .college-table .nf-select-trigger {
    min-height: 36px;
    border-radius: 10px;
    padding: 7px 32px 7px 10px;
    font-size: 0.86rem;
    background: color-mix(in srgb, var(--bg-secondary) 88%, transparent);
    border-color: color-mix(in srgb, var(--workspace-card-border) 90%, transparent);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
}

#view-today .today-academic-section .college-table .nf-date-trigger {
    min-height: 36px;
    border-radius: 10px;
    padding: 7px 34px 7px 10px;
    font-size: 0.86rem;
    background: color-mix(in srgb, var(--bg-secondary) 88%, transparent);
    border-color: color-mix(in srgb, var(--workspace-card-border) 90%, transparent);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
}

#view-today .today-academic-section .college-table .nf-select:not(.is-disabled) .nf-select-trigger:hover,
#view-today .today-academic-section .college-table .nf-date:not(.is-disabled) .nf-date-trigger:hover {
    transform: none;
    border-color: color-mix(in srgb, var(--accent) 76%, #ffffff 24%);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 18%, transparent);
}

#view-today .today-academic-section .college-table .nf-select.open .nf-select-trigger,
#view-today .today-academic-section .college-table .nf-date.open .nf-date-trigger {
    border-color: color-mix(in srgb, var(--accent) 76%, #ffffff 24%);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 22%, transparent);
}

#view-today .today-academic-section .college-table .nf-select-chevron {
    right: 11px;
    width: 9px;
    height: 9px;
    border-width: 1.7px;
}

#view-today .today-academic-section .college-table .nf-date-icon {
    right: 10px;
    width: 14px;
    height: 14px;
}

[data-theme="dark"] #view-collegeapp,
[data-theme="dark"] #view-life {
    --workspace-card-bg: linear-gradient(
        180deg,
        rgba(21, 20, 18, 0.86),
        rgba(16, 15, 13, 0.84)
    );
    --workspace-card-border: rgba(255, 255, 255, 0.12);
    --workspace-table-head-bg: rgba(255, 255, 255, 0.03);
    --workspace-row-border: rgba(255, 255, 255, 0.08);
    --workspace-row-hover: rgba(255, 191, 84, 0.09);
}

[data-theme="dark"] #view-today .today-academic-section {
    --workspace-card-bg: linear-gradient(
        180deg,
        rgba(21, 20, 18, 0.86),
        rgba(16, 15, 13, 0.84)
    );
    --workspace-card-border: rgba(255, 255, 255, 0.12);
    --workspace-table-head-bg: rgba(255, 255, 255, 0.03);
    --workspace-row-border: rgba(255, 255, 255, 0.08);
    --workspace-row-hover: rgba(255, 191, 84, 0.09);
}

@media (max-width: 1180px) {
    .academic-filter-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
    }

    #view-today .today-academic-section .today-academic-add-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
    }

    .dm-panels {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 840px) {
    #view-collegeapp,
    #view-life {
        padding: 14px 12px 26px;
        gap: 14px;
    }

    .academic-filter-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    #view-today .today-academic-section .today-academic-add-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    #view-today .today-academic-section .today-academic-add-notes {
        grid-column: span 2;
    }

    #view-collegeapp .college-table,
    #view-life .college-table {
        min-width: 860px;
    }

    #view-today .today-academic-section .college-table {
        min-width: 860px;
    }

    #view-collegeapp .college-table thead th,
    #view-life .college-table thead th {
        font-size: 0.69rem;
        padding: 8px 7px;
    }

    #view-today .today-academic-section .college-table thead th {
        font-size: 0.69rem;
        padding: 8px 7px;
    }

    #view-collegeapp .college-table tbody td,
    #view-life .college-table tbody td {
        padding: 7px;
    }

    #view-today .today-academic-section .college-table tbody td {
        padding: 7px;
    }

    #view-collegeapp .college-input,
    #view-life .college-input,
    #view-collegeapp .college-select,
    #view-life .college-select,
    #view-collegeapp .college-textarea,
    #view-life .college-textarea {
        min-width: 94px;
        font-size: 0.78rem;
        padding: 6px 7px;
    }

    #view-today .today-academic-section .college-input,
    #view-today .today-academic-section .college-select,
    #view-today .today-academic-section .college-textarea {
        min-width: 94px;
        font-size: 0.78rem;
        padding: 6px 7px;
    }
}

@media (max-width: 560px) {
    .academic-header-actions .neumo-btn,
    .collegeapp-header-actions .neumo-btn,
    .life-header-actions .neumo-btn,
    .academic-module-head .neumo-btn {
        width: 100%;
        justify-content: center;
    }

    .academic-filter-grid {
        grid-template-columns: 1fr;
    }

    #view-today .today-academic-section .today-academic-add-grid {
        grid-template-columns: 1fr;
    }

    #view-today .today-academic-section .today-academic-add-notes {
        grid-column: span 1;
    }

    #view-today .today-academic-section .today-academic-add-actions {
        justify-content: flex-start;
    }

    #view-today .today-academic-section .today-academic-add-actions .neumo-btn {
        width: 100%;
        justify-content: center;
    }

    #view-collegeapp .college-table,
    #view-life .college-table {
        min-width: 760px;
    }

    #view-today .today-academic-section .college-table {
        min-width: 760px;
    }
}

/* ------------------------------------------------------------------
   Mobile polish pass
   Improves settings density, touch targets, and small-screen layout flow.
------------------------------------------------------------------- */
@media (max-width: 1024px) {
    #view-settings {
        padding: 12px 12px 120px;
    }

    #view-settings .settings-grid {
        grid-template-columns: 1fr !important;
        gap: 14px;
    }

    #view-settings .settings-main-stack {
        gap: 14px;
    }

    #view-settings .settings-feature-rail {
        align-self: stretch;
    }

    #view-settings .settings-card {
        padding: 14px;
        gap: 10px;
        border-radius: 14px;
    }

    #view-settings .settings-row {
        flex-wrap: wrap;
        align-items: stretch;
        justify-content: flex-start;
        gap: 10px;
    }

    #view-settings .settings-row > .neumo-btn {
        flex: 1 1 180px;
        min-height: 42px;
        justify-content: center;
    }

    #view-settings .settings-row .modal-input {
        width: 100% !important;
        max-width: none !important;
        margin: 0 !important;
    }

    #view-settings #taskOrderStrategySelect {
        width: 100% !important;
        max-width: none !important;
    }

    #view-settings #featureToggleListSettings {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }

    #view-settings .settings-help {
        line-height: 1.45;
    }

    .chatbot-panel .chat-settings-row {
        grid-template-columns: minmax(0, 1fr) !important;
        gap: 10px;
    }

    .chatbot-panel .chat-settings-row button {
        width: 100%;
        min-height: 40px;
    }

    .chatbot-panel .chat-key-item {
        grid-template-columns: 1fr !important;
        gap: 4px;
    }

    .chatbot-panel .chat-settings-actions {
        justify-content: stretch;
    }

    .chatbot-panel .chat-settings-actions button {
        width: 100%;
    }
}

@media (max-width: 640px) {
    #view-settings {
        padding: 10px 10px 132px;
    }

    #view-settings .view-header h2 {
        font-size: clamp(1.15rem, 5.3vw, 1.45rem);
    }

    #view-settings .settings-grid,
    #view-settings .settings-main-stack {
        gap: 12px;
    }

    #view-settings .settings-card {
        padding: 12px;
    }

    #view-settings #featureToggleListSettings {
        grid-template-columns: 1fr;
        gap: 8px;
    }

    #view-settings #featureToggleListSettings .feature-toggle-card {
        min-height: 60px;
        padding: 10px;
        grid-template-columns: 30px minmax(0, 1fr) auto;
        gap: 10px;
    }

    #view-settings #featureToggleListSettings .feature-toggle-description {
        display: none;
    }

    #view-settings .settings-actions {
        width: 100%;
    }

    #view-settings .settings-actions .neumo-btn {
        flex: 1 1 auto;
        min-height: 40px;
    }

    .nf-select .nf-select-trigger {
        min-height: 42px;
        padding: 10px 12px;
    }

    .nf-select .nf-select-menu {
        max-height: min(44vh, 320px);
    }

    .nf-select .nf-select-option {
        min-height: 38px;
        font-size: 14px;
    }

    .focus-timer .timer-settings {
        gap: 10px;
    }

    .focus-timer .timer-settings .timer-field {
        padding: 8px 9px;
    }

    .timer-volume-row {
        align-items: center;
        gap: 10px;
    }

    .timer-volume-row output {
        min-width: 46px;
        font-size: 12px;
    }

    .tutorial-actions {
        flex-wrap: wrap;
        justify-content: stretch;
    }

    .tutorial-actions .neumo-btn {
        flex: 1 1 calc(50% - 8px);
        min-height: 38px;
    }

    .modal-content {
        width: min(560px, calc(100vw - 18px));
        max-height: calc(100vh - 16px);
        padding: 14px;
    }
}

/* =====================================================================
   Dark-mode overrides for new dashboard / modal / spending components
   ===================================================================== */

/* --- Nav buttons (College App + Life dashboards) --- */
[data-theme="dark"] .collegeapp-nav-btn,
[data-theme="dark"] .life-nav-btn {
    box-shadow: 4px 4px 12px rgba(0, 0, 0, 0.48), -2px -2px 8px rgba(255, 255, 255, 0.025);
    border-color: rgba(255, 255, 255, 0.07);
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
}

[data-theme="dark"] .collegeapp-nav-btn:hover,
[data-theme="dark"] .life-nav-btn:hover {
    box-shadow: 6px 6px 18px rgba(0, 0, 0, 0.56), -3px -3px 10px rgba(255, 255, 255, 0.03);
    border-color: rgba(210, 167, 77, 0.36);
}

[data-theme="dark"] .collegeapp-nav-btn:active,
[data-theme="dark"] .life-nav-btn:active {
    box-shadow: inset 3px 3px 8px rgba(0, 0, 0, 0.52), inset -2px -2px 6px rgba(255, 255, 255, 0.025);
}

/* --- Back buttons --- */
[data-theme="dark"] .collegeapp-back-btn,
[data-theme="dark"] .life-back-btn {
    box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.44), -2px -2px 8px rgba(255, 255, 255, 0.025);
    border-color: rgba(255, 255, 255, 0.08);
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
}

[data-theme="dark"] .collegeapp-back-btn:hover,
[data-theme="dark"] .life-back-btn:hover {
    box-shadow: 5px 5px 14px rgba(0, 0, 0, 0.52), -3px -3px 10px rgba(255, 255, 255, 0.03);
}

[data-theme="dark"] .collegeapp-back-btn:active,
[data-theme="dark"] .life-back-btn:active {
    box-shadow: inset 2px 2px 6px rgba(0, 0, 0, 0.5), inset -2px -2px 6px rgba(255, 255, 255, 0.02);
}

/* --- Summary cards in workspace views --- */
[data-theme="dark"] #view-collegeapp .summary-card,
[data-theme="dark"] #view-life .summary-card {
    box-shadow: 0 8px 22px rgba(0, 0, 0, 0.36);
    border-color: rgba(255, 255, 255, 0.07);
    background: linear-gradient(180deg, rgba(255,255,255,0.055), rgba(255,255,255,0.02));
}

/* --- Spending stat cards --- */
[data-theme="dark"] .spending-stat-card {
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.38);
    border-color: rgba(255, 255, 255, 0.07);
    background: linear-gradient(180deg, rgba(255,255,255,0.055), rgba(255,255,255,0.02));
}

/* --- Spending breakdown table --- */
[data-theme="dark"] .spending-breakdown-table thead th {
    color: var(--text-secondary);
}

[data-theme="dark"] .spending-breakdown-table tfoot td {
    border-color: rgba(210, 167, 77, 0.45);
}

[data-theme="dark"] .spending-cat-bar-wrap {
    background: rgba(255, 255, 255, 0.06);
}

[data-theme="dark"] .spending-cat-bar {
    background: var(--accent);
    opacity: 0.85;
}

/* --- Spending ledger inputs --- */
[data-theme="dark"] .spending-ledger-table tbody td input,
[data-theme="dark"] .spending-ledger-table tbody td select {
    background: rgba(255, 255, 255, 0.04);
    border-color: rgba(255, 255, 255, 0.08);
    color: var(--text-primary);
}

/* --- Add-Item Modal --- */
[data-theme="dark"] .add-item-modal-content {
    background: var(--bg-secondary);
    border-color: rgba(255, 255, 255, 0.08);
}

[data-theme="dark"] .add-item-field label {
    color: var(--text-muted);
}

[data-theme="dark"] .add-item-field .modal-input {
    background: rgba(255, 255, 255, 0.04);
    border-color: rgba(255, 255, 255, 0.09);
}

[data-theme="dark"] .add-item-field .modal-input:focus {
    border-color: var(--accent);
    background: rgba(255, 255, 255, 0.06);
}

[data-theme="dark"] .add-item-field select.modal-input option {
    background: var(--bg-secondary);
    color: var(--text-primary);
}

/* --- Workspace tables (College App + Life + Academic) dark rows --- */
[data-theme="dark"] .academic-module-card {
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.32);
    border-color: rgba(255, 255, 255, 0.06);
    background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.015));
}

/* --- Spending breakdown card dark --- */
[data-theme="dark"] .spending-breakdown-card {
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.32);
    border-color: rgba(255, 255, 255, 0.06);
}

/* =====================================================================
   Additional mobile optimizations for dashboard components
   ===================================================================== */

/* Tablet breakpoint for nav grids */
@media (max-width: 768px) {
    .collegeapp-nav-grid,
    .life-nav-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 14px;
    }

    .collegeapp-nav-btn,
    .life-nav-btn {
        padding: 24px 14px;
        font-size: 0.88rem;
    }

    #view-collegeapp,
    #view-life {
        padding: 16px 14px 30px;
    }

    .spending-stats-row {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* Small phone breakpoint enhancements */
@media (max-width: 480px) {
    .collegeapp-nav-grid,
    .life-nav-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }

    .collegeapp-nav-btn,
    .life-nav-btn {
        padding: 18px 10px;
        font-size: 0.82rem;
        border-radius: 14px;
    }

    .collegeapp-nav-btn i,
    .life-nav-btn i {
        font-size: 1.25rem;
    }

    .collegeapp-back-btn,
    .life-back-btn {
        font-size: 0.8rem;
        padding: 6px 12px;
    }

    .spending-stats-row {
        grid-template-columns: 1fr 1fr;
        gap: 8px;
    }

    .spending-stat-card {
        padding: 10px 12px;
    }

    .spending-stat-value {
        font-size: 1.15rem;
    }

    .spending-stat-label {
        font-size: 0.62rem;
    }

    /* Spending tables horizontal scroll on small screens */
    .spending-breakdown-card {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    .spending-breakdown-table,
    .spending-ledger-table {
        min-width: 420px;
    }

    .add-item-modal-content {
        max-width: calc(100vw - 16px);
        margin: 8px;
    }

    .add-item-row {
        grid-template-columns: 1fr;
    }

    #view-collegeapp .view-header h2,
    #view-life .view-header h2 {
        font-size: clamp(1.4rem, 5vw, 1.8rem);
    }

    .collegeapp-summary-grid,
    .life-summary-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 10px;
    }

    #view-collegeapp .summary-card,
    #view-life .summary-card {
        min-height: 100px;
        padding: 12px 14px;
    }

    #view-collegeapp .summary-value,
    #view-life .summary-value {
        font-size: 1.45rem;
    }
}

/* ------------------------------------------------------------------
   Improved Sidebar Scrollbar
------------------------------------------------------------------- */
.pages-list {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
    transition: scrollbar-color 0.3s ease;
}
.pages-list:hover {
    scrollbar-color: var(--scrollbar-thumb) transparent;
}
.pages-list::-webkit-scrollbar {
    width: 6px;
}
.pages-list::-webkit-scrollbar-track {
    background: transparent;
    margin: 4px 0;
}
.pages-list::-webkit-scrollbar-thumb {
    background: transparent;
    border-radius: 999px;
    transition: background 0.3s ease;
}
.pages-list:hover::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
}
.pages-list::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
}

/* ------------------------------------------------------------------
   Page Link Picker Modal
------------------------------------------------------------------- */
.page-link-modal-content {
    max-width: 480px;
    max-height: 70vh;
    display: flex;
    flex-direction: column;
}

.page-link-search-wrap {
    position: relative;
    margin-bottom: 12px;
}

.page-link-search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    font-size: 13px;
    pointer-events: none;
}

.page-link-search {
    padding-left: 38px !important;
}

.page-link-list {
    flex: 1;
    overflow-y: auto;
    max-height: 340px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: 2px;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb) transparent;
}

.page-link-list::-webkit-scrollbar {
    width: 5px;
}
.page-link-list::-webkit-scrollbar-track {
    background: transparent;
}
.page-link-list::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 999px;
}

.page-link-option {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    border-radius: 10px;
    cursor: pointer;
    transition: background var(--transition-fast), transform var(--transition-fast);
    border: 1px solid transparent;
}

.page-link-option:hover {
    background: var(--bg-hover);
    border-color: var(--glass-border);
    transform: translateX(2px);
}

.page-link-option:active {
    transform: scale(0.985);
}

.page-link-option-icon {
    font-size: 20px;
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    background: var(--accent-soft);
}

.page-link-option-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 0;
}

.page-link-option-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.page-link-option-path {
    font-size: 11px;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.page-link-empty {
    text-align: center;
    padding: 24px;
    color: var(--text-muted);
    font-size: 13px;
}

/* Page link chip in editor  improved look */
.editor .page-link {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 10px 3px 8px;
    background: var(--accent-soft);
    border: 1px solid rgba(var(--accent-rgb), 0.18);
    border-radius: 8px;
    color: var(--accent);
    font-size: 13px;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    user-select: none;
    -webkit-user-modify: read-only;
    transition: background var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
    vertical-align: baseline;
}

.editor .page-link:hover {
    background: rgba(var(--accent-rgb), 0.18);
    border-color: rgba(var(--accent-rgb), 0.3);
    transform: translateY(-1px);
}
